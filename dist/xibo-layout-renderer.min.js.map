{"version":3,"file":"xibo-layout-renderer.min.js","sources":["../node_modules/nanoevents/index.js","../../src/Modules/Platform/Platform.ts","../../src/Types/Layout/Layout.types.ts","../../src/Modules/Generators/Generators.ts","../../src/Types/Region/Region.types.ts","../../src/Types/Media/Media.types.ts","../../src/Modules/Transitions/Transitions.ts","../../src/Modules/Media/Media.ts","../../src/Modules/Media/VideoMedia.ts","../../src/Modules/Media/AudioMedia.ts","../../src/Modules/Layout/Layout.ts","../../src/Types/XLR/XLR.types.ts","../../src/Modules/Region/Region.ts","../../src/xibo-layout-renderer.ts","../../src/Modules/SplashScreen/SplashScreen.ts"],"sourcesContent":["export let createNanoEvents = () => ({\n  emit(event, ...args) {\n    for (\n      let i = 0,\n        callbacks = this.events[event] || [],\n        length = callbacks.length;\n      i < length;\n      i++\n    ) {\n      callbacks[i](...args)\n    }\n  },\n  events: {},\n  on(event, cb) {\n    ;(this.events[event] ||= []).push(cb)\n    return () => {\n      this.events[event] = this.events[event]?.filter(i => cb !== i)\n    }\n  }\n})\n","/*\r\n * Copyright (C) 2024 Xibo Signage Ltd\r\n *\r\n * Xibo - Digital Signage - https://www.xibosignage.com\r\n *\r\n * This file is part of Xibo.\r\n *\r\n * Xibo is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Lesser General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * any later version.\r\n *\r\n * Xibo is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU Lesser General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Lesser General Public License\r\n * along with Xibo.  If not, see <http://www.gnu.org/licenses/>.\r\n */\r\nimport {OptionsType} from \"../../Types/Layout\";\r\n\r\nconst RESOURCE_URL = '/playlist/widget/resource/:regionId/:id';\r\nconst XLF_URL = '/layout/xlf/:layoutId';\r\nconst LAYOUT_BACKGROUND_DOWNLOAD_URL = '/layout/background/:id';\r\nconst LAYOUT_PREVIEW_URL = '/layout/preview/[layoutCode]';\r\nconst LIBRARY_DOWNLOAD_URL = '/library/download/:id';\r\nconst LOADER_URL = '/theme/default/img/loader.gif';\r\n\r\nexport const platform: OptionsType = {\r\n    getResourceUrl: RESOURCE_URL,\r\n    xlfUrl: XLF_URL,\r\n    layoutBackgroundDownloadUrl: LAYOUT_BACKGROUND_DOWNLOAD_URL,\r\n    layoutPreviewUrl: LAYOUT_PREVIEW_URL,\r\n    libraryDownloadUrl: LIBRARY_DOWNLOAD_URL,\r\n    loaderUrl: LOADER_URL,\r\n    idCounter: 0,\r\n    inPreview: true,\r\n    appHost: null,\r\n    platform: 'CMS',\r\n};\r\n","/*\r\n * Copyright (C) 2024 Xibo Signage Ltd\r\n *\r\n * Xibo - Digital Signage - https://www.xibosignage.com\r\n *\r\n * This file is part of Xibo.\r\n *\r\n * Xibo is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Lesser General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * any later version.\r\n *\r\n * Xibo is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU Lesser General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Lesser General Public License\r\n * along with Xibo.  If not, see <http://www.gnu.org/licenses/>.\r\n */\r\nimport {DefaultEvents, Emitter, Unsubscribe} from 'nanoevents';\r\nimport {IRegion} from '../Region';\r\nimport {platform} from '../../Modules/Platform';\r\nimport {ILayoutEvents} from '../../Modules/Layout';\r\nimport {IXlr} from '../XLR';\r\n\r\nexport type InputLayoutType = {\r\n    layoutId: number | null;\r\n    path?: string;\r\n};\r\n\r\nexport type OptionsType = {\r\n    xlfUrl: string;\r\n    getResourceUrl: string;\r\n    layoutBackgroundDownloadUrl: string;\r\n    layoutPreviewUrl: string;\r\n    libraryDownloadUrl: string;\r\n    loaderUrl: string;\r\n    idCounter: number;\r\n    inPreview: boolean;\r\n    appHost?: string | null;\r\n    platform: 'CMS' | 'chromeOS';\r\n    config?: {\r\n        cmsUrl: string | null;\r\n        schemaVersion: number;\r\n        cmsKey: string | null;\r\n        hardwareKey: string | null;\r\n    };\r\n};\r\n\r\nexport interface ILayout {\r\n    id: number | null;\r\n    layoutId: number | null;\r\n    sw: number | null;\r\n    sh: number | null;\r\n    xw: number | null;\r\n    xh: number | null;\r\n    zIndex: number | null;\r\n    scaleFactor: number;\r\n    sWidth: number;\r\n    sHeight: number;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    bgColor: string;\r\n    bgImage: string;\r\n    bgId: string;\r\n    containerName: string;\r\n    layoutNode: Document | null;\r\n    regionMaxZIndex: number;\r\n    ready: boolean;\r\n    regionObjects: IRegion[];\r\n    drawer: String[];\r\n    allExpired: boolean;\r\n    regions: IRegion[];\r\n    actions: String[];\r\n    options: OptionsType;\r\n    done: boolean;\r\n    allEnded: boolean;\r\n    path?: string;\r\n    prepareLayout(): void;\r\n    parseXlf(): void;\r\n    run(): void;\r\n    emitter?: Emitter<DefaultEvents>;\r\n    on<E extends keyof ILayoutEvents>(event: E, callback: ILayoutEvents[E]): Unsubscribe;\r\n    regionExpired(): void;\r\n    end(): void;\r\n    regionEnded(): void;\r\n    stopAllMedia(): Promise<void>;\r\n}\r\n\r\nexport const initialLayout: ILayout = {\r\n    id: null,\r\n    layoutId: null,\r\n    sw: 0,\r\n    sh: 0,\r\n    xw: 0,\r\n    xh: 0,\r\n    zIndex: 0,\r\n    scaleFactor: 1,\r\n    sWidth: 0,\r\n    sHeight: 0,\r\n    offsetX: 0,\r\n    offsetY: 0,\r\n    bgColor: '',\r\n    bgImage: '',\r\n    bgId: '',\r\n    containerName: '',\r\n    layoutNode: null,\r\n    regionMaxZIndex: 0,\r\n    ready: false,\r\n    regionObjects: [],\r\n    drawer: [],\r\n    allExpired: false,\r\n    regions: [],\r\n    actions: [],\r\n    options: platform,\r\n    done: false,\r\n    allEnded: false,\r\n    path: '',\r\n    prepareLayout() {\r\n    },\r\n    parseXlf() {\r\n    },\r\n    run() {\r\n    },\r\n    on<E extends keyof ILayoutEvents>(event: E, callback: ILayoutEvents[E]): Unsubscribe {\r\n        return <Unsubscribe>{};\r\n    },\r\n    regionExpired() {\r\n    },\r\n    end() {\r\n    },\r\n    regionEnded() {\r\n    },\r\n    stopAllMedia() {\r\n        return Promise.resolve();\r\n    },\r\n};\r\n\r\nexport type GetLayoutParamType = {\r\n    xlr: IXlr;\r\n    moveNext?: boolean;\r\n}\r\n\r\nexport type GetLayoutType = {\r\n    currentLayoutIndex: number;\r\n    inputLayouts: InputLayoutType[];\r\n    current: ILayout | undefined;\r\n    next: ILayout | undefined;\r\n}\r\n","/*\r\n * Copyright (C) 2024 Xibo Signage Ltd\r\n *\r\n * Xibo - Digital Signage - https://www.xibosignage.com\r\n *\r\n * This file is part of Xibo.\r\n *\r\n * Xibo is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Lesser General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * any later version.\r\n *\r\n * Xibo is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU Lesser General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Lesser General Public License\r\n * along with Xibo.  If not, see <http://www.gnu.org/licenses/>.\r\n */\r\nimport { IMedia } from '../../Types/Media';\r\nimport {InputLayoutType, OptionsType} from '../../Types/Layout';\r\n\r\nexport function nextId(options: { idCounter: number; }) {\r\n    if (options.idCounter > 500) {\r\n        options.idCounter = 0;\r\n    }\r\n\r\n    options.idCounter = options.idCounter + 1;\r\n    return options.idCounter;\r\n}\r\n\r\nexport const getMediaId = ({mediaType, containerName}: IMedia) => {\r\n    let mediaId = containerName;\r\n\r\n    if (mediaType === 'video') {\r\n        mediaId = mediaId + '-vid';\r\n    } else if (mediaType === 'audio') {\r\n        mediaId = mediaId + '-aud';\r\n    }\r\n\r\n    return mediaId;\r\n};\r\n\r\nexport const capitalizeStr = (inputStr: string) => {\r\n    if (inputStr === null) {\r\n        return '';\r\n    }\r\n\r\n    return String(inputStr).charAt(0).toUpperCase() + String(inputStr).substring(1);\r\n};\r\n\r\nexport async function getDataBlob(src: string) {\r\n    return fetch(src, {mode: 'no-cors'})\r\n        .then((res) => res.blob())\r\n        .then((blob) => new Promise((res, rej) => {\r\n            const reader = new FileReader();\r\n\r\n            reader.onloadend = () => res(reader.result);\r\n            reader.onerror = rej;\r\n            reader.readAsDataURL(blob);\r\n        }));\r\n}\r\n\r\nexport async function preloadMediaBlob(src: string, type: 'video' | 'audio' | 'image') {\r\n    const res = await fetch(src, {mode: 'no-cors'});\r\n    let blob: Blob | MediaSource = new Blob();\r\n\r\n    if (type === 'image') {\r\n        blob = new Blob()\r\n    } else if (type === 'video') {\r\n        blob = await res.blob();\r\n    } else if (type === 'audio') {\r\n        const data = await res.arrayBuffer();\r\n        blob = new Blob([data], { type: audioFileType(getFileExt(src)) })\r\n    }\r\n\r\n    return URL.createObjectURL(blob);\r\n}\r\n\r\nexport async function fetchJSON(url: string) {\r\n    return fetch(url)\r\n        .then(res => res.json())\r\n        .catch(err => {\r\n            console.debug(err);\r\n        });\r\n}\r\n\r\nexport function getFileExt(filename: string) {\r\n    const filenameArr = String(filename).split('.');\r\n\r\n    return filenameArr[filenameArr.length - 1];\r\n}\r\n\r\nexport function audioFileType(str: string) {\r\n    const validAudioTypes = {\r\n        'mp3': 'audio/mp3',\r\n        'wav': 'audio/wav',\r\n        'ogg': 'audio/ogg',\r\n    };\r\n\r\n    if (Boolean(validAudioTypes[str as 'mp3' | 'wav' | 'ogg'])) {\r\n        return validAudioTypes[str as 'mp3' | 'wav' | 'ogg'];\r\n    }\r\n\r\n    return undefined;\r\n}\r\n\r\nexport function composeResourceUrlByPlatform(platform: OptionsType['platform'], params: any) {\r\n    let resourceUrl = params.regionOptions.getResourceUrl\r\n        .replace(\":regionId\", params.regionId)\r\n        .replace(\":id\", params.mediaId) +\r\n        '?preview=1&layoutPreview=1';\r\n\r\n    if (platform === 'chromeOS') {\r\n        resourceUrl = params.cmsUrl +\r\n            '/chromeOS/resource/' +\r\n            params.fileId +\r\n            '?saveAs=' + params.uri;\r\n    } else if (!Boolean(params['mediaType'])) {\r\n        resourceUrl += '&scale_override=' + params.scaleFactor;\r\n    }\r\n\r\n    return resourceUrl;\r\n}\r\n\r\nexport function composeBgUrlByPlatform(\r\n    platform: OptionsType['platform'],\r\n    params: any\r\n) {\r\n    let bgImageUrl = params.layoutBackgroundDownloadUrl.replace(\":id\", (params.layout.id as unknown) as string) +\r\n        '?preview=1&width=' + params.layout.sWidth +\r\n        '&height=' + params.layout.sHeight +\r\n        '&dynamic&proportional=0';\r\n\r\n    if (platform === 'chromeOS') {\r\n        bgImageUrl = params.cmsUrl +\r\n            '/chromeOS/resource/' + params.layout.id +\r\n            '?saveAs=' + params.layout.bgImage;\r\n    }\r\n\r\n    return bgImageUrl;\r\n}\r\n\r\ntype LayoutIndexType = {\r\n    [k: string]: InputLayoutType & {\r\n        index: number;\r\n    }\r\n}\r\n\r\nexport function getIndexByLayoutId(layoutsInput: InputLayoutType[], layoutId?: number | null) {\r\n    let layoutIndexes = layoutsInput.reduce((a: LayoutIndexType, b, indx) => {\r\n        a[Number(b.layoutId)] = {\r\n            ...b,\r\n            index: indx\r\n        };\r\n\r\n        return a;\r\n    }, {});\r\n\r\n    if (layoutId === null || !layoutId) {\r\n        return layoutIndexes;\r\n    }\r\n\r\n    return layoutIndexes[layoutId];\r\n}\r\n\r\nexport function isEmpty(input: any) {\r\n    return !Boolean(input) || String(input).length === 0;\r\n}\r\n\r\nexport const splashScreenLayoutObj: InputLayoutType = {\r\n    layoutId: 0,\r\n    path: '',\r\n};\r\n\r\nexport function splashScreenDOM() {\r\n    const mediaItem = document.querySelector('.media--item');\r\n    const newImg = document.createElement('img');\r\n\r\n    newImg.src = new URL('./logo.png', import.meta.url).href;\r\n\r\n    if (mediaItem !== null) {\r\n        mediaItem.insertBefore(newImg, mediaItem.lastElementChild);\r\n    }\r\n\r\n    return newImg;\r\n}\r\n","/*\r\n * Copyright (C) 2024 Xibo Signage Ltd\r\n *\r\n * Xibo - Digital Signage - https://www.xibosignage.com\r\n *\r\n * This file is part of Xibo.\r\n *\r\n * Xibo is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Lesser General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * any later version.\r\n *\r\n * Xibo is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU Lesser General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Lesser General Public License\r\n * along with Xibo.  If not, see <http://www.gnu.org/licenses/>.\r\n */\r\nimport { DefaultEvents, Emitter, Unsubscribe } from 'nanoevents';\r\nimport {ILayout, initialLayout} from '../Layout';\r\nimport {IMedia} from '../Media';\r\n\r\nexport interface IRegionEvents {\r\n    start: (layout: IRegion) => void;\r\n    end: (layout: IRegion) => void;\r\n}\r\n\r\nexport interface IRegion {\r\n    layout: ILayout;\r\n    id: string;\r\n    regionId: string;\r\n    xml: null | Element;\r\n    mediaObjects: IMedia[];\r\n    mediaObjectsActions: String[];\r\n    currentMedia: number;\r\n    complete: boolean;\r\n    containerName: string;\r\n    ending: boolean;\r\n    ended: boolean;\r\n    oneMedia: boolean;\r\n    oldMedia: IMedia | undefined;\r\n    curMedia: IMedia | undefined;\r\n    nxtMedia: IMedia | undefined;\r\n    currentMediaIndex: number;\r\n    totalMediaObjects: number;\r\n    ready: boolean;\r\n    options: {\r\n        [k: string]: any;\r\n    };\r\n    sWidth: number;\r\n    sHeight: number;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    zIndex: number;\r\n    index: number;\r\n    emitter?: Emitter<DefaultEvents>;\r\n    prepareRegion(): void;\r\n    playNextMedia(): void;\r\n    transitionNodes(oldMedia: IMedia | undefined, newMedia: IMedia | undefined): void;\r\n    finished(): void;\r\n    run(): void;\r\n    end(): void;\r\n    exitTransition(): void;\r\n    exitTransitionComplete(): void;\r\n    on<E extends keyof IRegionEvents>(event: E, callback: IRegionEvents[E]): Unsubscribe;\r\n    prepareMediaObjects(): void;\r\n}\r\n\r\nexport const initialRegion: IRegion = {\r\n    layout: initialLayout,\r\n    id: '',\r\n    regionId: '',\r\n    xml: null,\r\n    mediaObjects: [],\r\n    mediaObjectsActions: [],\r\n    currentMedia: -1,\r\n    complete: false,\r\n    containerName: '',\r\n    ending: false,\r\n    ended: false,\r\n    oneMedia: false,\r\n    oldMedia: undefined,\r\n    curMedia: undefined,\r\n    nxtMedia: undefined,\r\n    currentMediaIndex: 0,\r\n    totalMediaObjects: 0,\r\n    ready: false,\r\n    options: {},\r\n    sWidth: 0,\r\n    sHeight: 0,\r\n    offsetX: 0,\r\n    offsetY: 0,\r\n    zIndex: 0,\r\n    index: -1,\r\n    prepareRegion() {\r\n    },\r\n    playNextMedia() {\r\n    },\r\n    transitionNodes() {\r\n    },\r\n    finished() {\r\n    },\r\n    run() {\r\n    },\r\n    end() {\r\n    },\r\n    exitTransition() {},\r\n    exitTransitionComplete() {},\r\n    on<E extends keyof IRegionEvents>(event: E, callback: IRegionEvents[E]): Unsubscribe {\r\n        return <Unsubscribe>{};\r\n    },\r\n    prepareMediaObjects() {\r\n    },\r\n};\r\n","/*\r\n * Copyright (C) 2024 Xibo Signage Ltd\r\n *\r\n * Xibo - Digital Signage - https://www.xibosignage.com\r\n *\r\n * This file is part of Xibo.\r\n *\r\n * Xibo is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Lesser General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * any later version.\r\n *\r\n * Xibo is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU Lesser General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Lesser General Public License\r\n * along with Xibo.  If not, see <http://www.gnu.org/licenses/>.\r\n */\r\nimport { DefaultEvents, Emitter, Unsubscribe } from 'nanoevents';\r\nimport { IMediaEvents } from '../../Modules/Media/Media';\r\nimport {initialRegion, IRegion} from '../Region';\r\n\r\nexport interface IMedia {\r\n    region: IRegion;\r\n    xml: null | Element;\r\n    id: string;\r\n    idCounter: number;\r\n    index: number;\r\n    containerName: string;\r\n    html: null | HTMLElement;\r\n    iframe: null | HTMLIFrameElement;\r\n    iframeName: string;\r\n    mediaType: string;\r\n    render: string;\r\n    attachedAudio: boolean;\r\n    singlePlay: boolean;\r\n    timeoutId: ReturnType<typeof setTimeout>;\r\n    ready: boolean;\r\n    checkIframeStatus: boolean;\r\n    loadIframeOnRun: boolean;\r\n    tempSrc: string;\r\n    finished: boolean;\r\n    schemaVersion: string;\r\n    type: string;\r\n    duration: number;\r\n    useDuration: boolean;\r\n    fileId: string;\r\n    uri: string;\r\n    options: {\r\n        [k: string]: any;\r\n    };\r\n    divWidth: number;\r\n    divHeight: number;\r\n    url: string | null;\r\n    loop: boolean;\r\n    emitter?: Emitter<DefaultEvents>;\r\n    run(): void;\r\n    init(): void;\r\n    stop(): Promise<void>;\r\n    on<E extends keyof IMediaEvents>(event: E, callback: IMediaEvents[E]): Unsubscribe;\r\n}\r\n\r\nexport const initialMedia: IMedia = {\r\n    region: initialRegion,\r\n    xml: null,\r\n    id: '',\r\n    index: 0,\r\n    idCounter: 0,\r\n    containerName: '',\r\n    html: null,\r\n    iframe: null,\r\n    iframeName: '',\r\n    mediaType: '',\r\n    render: 'html',\r\n    attachedAudio: false,\r\n    singlePlay: false,\r\n    timeoutId: setTimeout(() => {}, 100),\r\n    ready: true,\r\n    checkIframeStatus: false,\r\n    loadIframeOnRun: false,\r\n    tempSrc: '',\r\n    finished: false,\r\n    schemaVersion: '1',\r\n    type: '',\r\n    duration: 0,\r\n    useDuration: Boolean(0),\r\n    fileId: '',\r\n    uri: '',\r\n    options: {},\r\n    divWidth: 0,\r\n    divHeight: 0,\r\n    url: null,\r\n    loop: false,\r\n    run() {},\r\n    init() {},\r\n    stop() {\r\n        return Promise.resolve();\r\n    },\r\n    on<E extends keyof IMediaEvents>(event: E, callback: IMediaEvents[E]): Unsubscribe {\r\n        return <Unsubscribe>{};\r\n    },\r\n}\r\n","/*\n * Copyright (C) 2024 Xibo Signage Ltd\n *\n * Xibo - Digital Signage - https://www.xibosignage.com\n *\n * This file is part of Xibo.\n *\n * Xibo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * any later version.\n *\n * Xibo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with Xibo.  If not, see <http://www.gnu.org/licenses/>.\n */\nexport const defaultTrans = (duration: number, trans: 'in' | 'out') => {\n    const defaultKeyframes = [\n        { display: trans === 'in' ? 'none' : 'block' },\n        { display: trans === 'out' ? 'none' : 'block' },\n    ];\n    const defaultTiming: number | KeyframeAnimationOptions | undefined = {\n        duration,\n    };\n\n    return {\n        keyframes: defaultKeyframes,\n        timing: defaultTiming,\n    };\n};\n\nexport const fadeInElem = (duration: number) => {\n    const fadeInKeyframes = [\n        { opacity: 0 },\n        { opacity: 1 },\n    ];\n    const fadeInTiming: number | KeyframeAnimationOptions | undefined = {\n        duration,\n        fill: 'forwards',\n    };\n\n    return {\n        keyframes: fadeInKeyframes,\n        timing: fadeInTiming,\n    }\n};\n\nexport const fadeOutElem = (duration: number) => {\n    const fadeOutKeyframes = [\n        { opacity: 1 },\n        { opacity: 0, zIndex: -1 },\n    ];\n    const fadeOutTiming: number | KeyframeAnimationOptions | undefined = {\n        duration,\n        fill: 'forwards',\n    };\n\n    return {\n        keyframes: fadeOutKeyframes,\n        timing: fadeOutTiming,\n    }\n};\n\nexport type KeyframeOptionsType = {\n    from: {\n        [k: string]: any,\n    },\n    to: {\n        [k: string]: any,\n    },\n}\n\nexport const flyInElem = (duration: number, keyframeOptions: KeyframeOptionsType | undefined, direction?: string) => {\n    const flyInKeyframes = [\n        {opacity: 0},\n        {opacity: 1, zIndex: 1},\n    ];\n    const flyInTiming: number | KeyframeAnimationOptions | undefined = {\n        duration,\n        fill: 'forwards',\n    };\n\n    if (keyframeOptions && Boolean(keyframeOptions.from)) {\n        flyInKeyframes[0] = {...keyframeOptions.from, ...flyInKeyframes[0]};\n    }\n\n    if (keyframeOptions && Boolean(keyframeOptions.to)) {\n        flyInKeyframes[1] = {...keyframeOptions.to, ...flyInKeyframes[1]};\n    }\n\n    return {\n        keyframes: flyInKeyframes,\n        timing: flyInTiming,\n    };\n};\n\nexport const flyOutElem = (duration: number, keyframeOptions: KeyframeOptionsType | undefined, direction?: string) => {\n    const flyOutKeyframes: Keyframe[] = [\n        {opacity: 1},\n        {opacity: 0, zIndex: -1},\n    ];\n    const flyOutTiming: number | KeyframeAnimationOptions | undefined = {\n        duration,\n        fill: 'forwards',\n    };\n\n    if (keyframeOptions && Boolean(keyframeOptions.from)) {\n        flyOutKeyframes[0] = {...keyframeOptions.from, ...flyOutKeyframes[0]};\n    }\n\n    if (keyframeOptions && Boolean(keyframeOptions.to)) {\n        flyOutKeyframes[1] = {...keyframeOptions.to, ...flyOutKeyframes[1]};\n    }\n\n    return {\n        keyframes: flyOutKeyframes,\n        timing: flyOutTiming,\n    };\n};\n\nexport type TransitionNameType = 'fadeIn' | 'fadeOut' | 'flyIn' | 'flyOut' | 'defaultIn' | 'defaultOut';\n\nexport type TransitionElementOptions = {\n    duration: number;\n    keyframes?: KeyframeOptionsType;\n    direction?: string;\n};\n\nexport const transitionElement = (transition: TransitionNameType, options: TransitionElementOptions) => {\n    const transitions = {\n        fadeIn: fadeInElem(options.duration),\n        fadeOut: fadeOutElem(options.duration),\n        flyIn: flyInElem(options.duration, options.keyframes, options.direction),\n        flyOut: flyOutElem(options.duration, options.keyframes, options.direction),\n        defaultIn: defaultTrans(options.duration, 'in'),\n        defaultOut: defaultTrans(options.duration, 'out'),\n    };\n\n    return transitions[transition];\n};\n\nexport type compassPoints = 'N' | 'NE' | 'E' | 'SE' | 'S' | 'SW' | 'W' | 'NW';\n\nexport type flyTransitionParams = {\n    trans: 'in' | 'out';\n    direction: compassPoints;\n    height: string | number;\n    width: string | number;\n};\n\nexport const flyTransitionKeyframes = (params: flyTransitionParams): KeyframeOptionsType => {\n    const keyframes = {\n        from: {},\n        to: {},\n    };\n    const opacityAttr = (source: 'from' | 'to') => {\n        if (source === 'from') {\n            return params.trans === 'in' ? 0 : 1;\n        }\n        \n        return params.trans === 'out' ? 1 : 0;\n    };\n\n    switch (params.direction) {\n        case 'N':\n            keyframes.from = {\n                opacity: opacityAttr('from'),\n                top: params.trans === 'in' ? `${params.height}px` : 0,\n            };\n            keyframes.to = {\n                opacity: opacityAttr('to'),\n                top: params.trans === 'in' ? 0 : `-${params.height}px`,\n            };\n            break;\n        case 'NE':\n            keyframes.from = {\n                opacity: opacityAttr('from'),\n                top: params.trans === 'in' ? `${params.height}px` : 0,\n                left: params.trans === 'in' ? `-${params.width}px` : 0,\n            };\n            keyframes.to = {\n                opacity: opacityAttr('to'),\n                top: params.trans === 'in' ? 0 : `-${params.height}px`,\n                left: params.trans === 'in' ? 0 : `${params.width}px`,\n            };\n            break;\n        case 'E':\n            keyframes.from = {\n                opacity: opacityAttr('from'),\n                left: params.trans === 'in' ? `-${params.width}px` : 0,\n            };\n            keyframes.to = {\n                opacity: opacityAttr('to'),\n                left: params.trans === 'in' ? 0 : `${params.width}px`,\n            };\n            break;\n        case 'SE':\n            keyframes.from = {\n                opacity: opacityAttr('from'),\n                top: params.trans === 'in' ? `-${params.height}px` : 0,\n                left: params.trans === 'in' ? `-${params.width}px` : 0,\n            };\n            keyframes.to = {\n                opacity: opacityAttr('to'),\n                top: params.trans === 'in' ? 0 : `${params.height}px`,\n                left: params.trans === 'in' ? 0 : `${params.width}px`,\n            };\n            break;\n        case 'S':\n            keyframes.from = {\n                opacity: opacityAttr('from'),\n                top: params.trans === 'in' ? `-${params.height}px` : 0,\n            };\n            keyframes.to = {\n                opacity: opacityAttr('to'),\n                top: params.trans === 'in' ? 0 : `${params.height}px`,\n            };\n            break;\n        case 'SW':\n            keyframes.from = {\n                opacity: opacityAttr('from'),\n                top: params.trans === 'in' ? `-${params.height}px` : 0,\n                left: params.trans === 'in' ? `${params.width}px` : 0,\n            };\n            keyframes.to = {\n                opacity: opacityAttr('to'),\n                top: params.trans === 'in' ? 0 : `${params.height}px`,\n                left: params.trans === 'in' ? 0 : `-${params.width}px`,\n            };\n            break;\n        case 'W':\n            keyframes.from = {\n                opacity: opacityAttr('from'),\n                left: params.trans === 'in' ? `${params.width}px` : 0,\n            };\n            keyframes.to = {\n                opacity: opacityAttr('to'),\n                left: params.trans === 'in' ? 0 : `-${params.width}px`,\n            };\n            break;\n        case 'NW':\n            keyframes.from = {\n                opacity: opacityAttr('from'),\n                top: params.trans === 'in' ? `${params.height}px` : 0,\n                left: params.trans === 'in' ? `${params.width}px` : 0,\n            };\n            keyframes.to = {\n                opacity: opacityAttr('to'),\n                top: params.trans === 'in' ? 0 : `-${params.height}px`,\n                left: params.trans === 'in' ? 0 : `-${params.width}px`,\n            };\n            break;\n        default:\n            keyframes.from = {\n                opacity: opacityAttr('from'),\n                top: params.trans === 'in' ? `${params.height}px` : 0,\n            };\n            keyframes.to = {\n                opacity: opacityAttr('to'),\n                top: params.trans === 'in' ? 0 : `-${params.height}px`,\n            };\n            break;\n    }\n\n    return keyframes;\n};\n","/*\r\n * Copyright (C) 2024 Xibo Signage Ltd\r\n *\r\n * Xibo - Digital Signage - https://www.xibosignage.com\r\n *\r\n * This file is part of Xibo.\r\n *\r\n * Xibo is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Lesser General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * any later version.\r\n *\r\n * Xibo is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU Lesser General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Lesser General Public License\r\n * along with Xibo.  If not, see <http://www.gnu.org/licenses/>.\r\n */\r\nimport { createNanoEvents } from 'nanoevents';\r\nimport { OptionsType } from '../../Types/Layout';\r\nimport { IRegion } from '../../Types/Region';\r\nimport { IMedia, initialMedia } from '../../Types/Media';\r\nimport { fetchJSON, getMediaId, nextId, preloadMediaBlob } from '../Generators';\r\nimport { TransitionElementOptions, compassPoints, flyTransitionKeyframes, transitionElement } from '../Transitions';\r\nimport VideoMedia from './VideoMedia';\r\nimport AudioMedia from './AudioMedia';\r\nimport {composeResourceUrlByPlatform, getDataBlob} from '../Generators/Generators';\r\nimport {IXlr} from '../../Types/XLR';\r\nimport {PreviewSplashElement} from '../SplashScreen/SplashScreen';\r\n\r\nexport interface IMediaEvents {\r\n    start: (media: IMedia) => void;\r\n    end: (media: IMedia) => void;\r\n}\r\n\r\nexport default function Media(\r\n    region: IRegion,\r\n    mediaId: string,\r\n    xml: Element,\r\n    options: OptionsType,\r\n    xlr: IXlr,\r\n) {\r\n    const props = {\r\n        region: region,\r\n        mediaId: mediaId,\r\n        xml: xml,\r\n        options: options,\r\n    };\r\n    let mediaTimer: string | number | NodeJS.Timeout | null | undefined = null;\r\n    let mediaTimeCount = 0;\r\n    const emitter = createNanoEvents<IMediaEvents>();\r\n    const mediaObject: IMedia = {\r\n        ...initialMedia,\r\n        ...props,\r\n    };\r\n    const startMediaTimer = (media: IMedia) => {\r\n        mediaTimer = setInterval(() => {\r\n            mediaTimeCount++;\r\n            if (mediaTimeCount > media.duration) {\r\n                media.emitter?.emit('end', media);\r\n            }\r\n        }, 1000);\r\n        const $splashScreen = document.querySelector('.preview-splash') as PreviewSplashElement;\r\n        if ($splashScreen !== null && $splashScreen.style.display === 'block') {\r\n            $splashScreen?.hide();\r\n        }\r\n\r\n        console.debug('Showing Media ' + media.id + ' for ' + media.duration + 's of Region ' + media.region.regionId);\r\n    };\r\n\r\n    emitter.on('start', function(media) {\r\n        if (media.mediaType === 'video') {\r\n            VideoMedia(media).init();\r\n\r\n            if (media.duration > 0) {\r\n                startMediaTimer(media);\r\n            }\r\n        } else if (media.mediaType === 'audio') {\r\n            AudioMedia(media).init();\r\n            if (media.duration > 0) {\r\n                startMediaTimer(media);\r\n            }\r\n        } else {\r\n            startMediaTimer(media);\r\n        }\r\n    });\r\n\r\n    emitter.on('end', function(media) {\r\n        if (mediaTimer) {\r\n            clearInterval(mediaTimer);\r\n            mediaTimeCount = 0;\r\n        }\r\n\r\n        media.region.playNextMedia();\r\n    });\r\n\r\n    mediaObject.init = function() {\r\n        const self = mediaObject;\r\n        self.id = props.mediaId;\r\n        self.fileId = self.xml?.getAttribute('fileId') || '';\r\n        self.idCounter = nextId(props.options);\r\n        self.containerName = `M-${self.id}-${self.idCounter}`;\r\n        self.iframeName = `${self.containerName}-iframe`;\r\n        self.mediaType = self.xml?.getAttribute('type') || '';\r\n        self.render = self.xml?.getAttribute('render') || '';\r\n        self.duration = parseInt(self.xml?.getAttribute('duration') as string) || 0;\r\n        self.options = { ...props.options, mediaId };\r\n\r\n        const $mediaIframe = document.createElement('iframe');\r\n        const mediaOptions = self.xml?.getElementsByTagName('options');\r\n\r\n        if (mediaOptions) {\r\n            for (let _options of Array.from(mediaOptions)) {\r\n                // Get options\r\n                const _mediaOptions = _options.children;\r\n                for (let mediaOption of Array.from(_mediaOptions)) {\r\n                    self.options[mediaOption.nodeName.toLowerCase()] = mediaOption.textContent;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Check for options.uri and add it to media\r\n        if (Boolean(self.options['uri'])) {\r\n            self.uri = self.options['uri'];\r\n        }\r\n\r\n        // Show in fullscreen?\r\n        if(self.options.showfullscreen === \"1\") {\r\n            // Set dimensions as the layout ones\r\n            self.divWidth = self.region.layout.sWidth;\r\n            self.divHeight = self.region.layout.sHeight;\r\n        } else {\r\n            // Set dimensions as the region ones\r\n            self.divWidth = self.region.sWidth;\r\n            self.divHeight = self.region.sHeight;\r\n        }\r\n\r\n        $mediaIframe.scrolling = 'no';\r\n        $mediaIframe.id = self.iframeName;\r\n        $mediaIframe.width = `${self.divWidth}px`;\r\n        $mediaIframe.height = `${self.divHeight}px`;\r\n        $mediaIframe.style.cssText = `border: 0; visibility: hidden;`;\r\n\r\n        const $mediaId = getMediaId(self);\r\n        let $media = document.getElementById($mediaId);\r\n\r\n        if ($media === null) {\r\n            if (self.mediaType === 'video') {\r\n                $media = document.createElement('video');\r\n            } else if (self.mediaType === 'audio') {\r\n                $media = new Audio();\r\n            } else {\r\n                $media = document.createElement('div');\r\n            }\r\n        \r\n            $media.id = $mediaId;\r\n        }\r\n\r\n        $media.className = 'media--item';\r\n\r\n        /* Scale the Content Container */\r\n        $media.style.cssText = `\r\n            display: none;\r\n            width: ${self.divWidth}px;\r\n            height: ${self.divHeight}px;\r\n            position: absolute;\r\n            background-size: contain;\r\n            background-repeat: no-repeat;\r\n            background-position: center;\r\n        `;\r\n\r\n        const $region = document.getElementById(`${self.region.containerName}`);\r\n\r\n        const resourceUrlParams: any = {\r\n            ...xlr.config.config,\r\n            regionOptions: self.region.options,\r\n            layoutId: self.region.layout.layoutId,\r\n            regionId: self.region.id,\r\n            mediaId: self.id,\r\n            fileId: self.fileId,\r\n            scaleFactor: self.region.layout.scaleFactor,\r\n            uri: self.uri,\r\n        };\r\n\r\n        if (self.mediaType === 'image' || self.mediaType === 'video') {\r\n            resourceUrlParams.mediaType = self.mediaType;\r\n        }\r\n\r\n        const tmpUrl = composeResourceUrlByPlatform(xlr.config.platform, resourceUrlParams);\r\n\r\n        self.url = tmpUrl;\r\n\r\n        // Loop if media has loop, or if region has loop and a single media\r\n        self.loop =\r\n            self.options['loop'] == '1' ||\r\n            (self.region.options['loop'] == '1' && self.region.totalMediaObjects == 1);\r\n\r\n        $mediaIframe.src = `${tmpUrl}&width=${self.divWidth}&height=${self.divHeight}`;\r\n\r\n        if (self.render === 'html' || self.mediaType === 'ticker' || self.mediaType === 'webpage') {\r\n            self.checkIframeStatus = true;\r\n            self.iframe = $mediaIframe;\r\n        }  else if (self.mediaType === \"image\") {\r\n            // preload.addFiles(tmpUrl);\r\n            // $media.style.cssText = $media.style.cssText.concat(`background-image: url('${tmpUrl}');`);\r\n            if (self.options['scaletype'] === 'stretch') {\r\n                $media.style.cssText = $media.style.cssText.concat(`background-size: 100% 100%;`);\r\n            } else if (self.options['scaletype'] === 'fit') {\r\n                $media.style.cssText = $media.style.cssText.concat(`background-size: cover;`);\r\n            } else {\r\n                // Center scale type, do we have align or valign?\r\n                const align = (self.options['align'] == \"\") ? \"center\" : self.options['align'];\r\n                const valign = (self.options['valign'] == \"\" || self.options['valign'] == \"middle\") ? \"center\" : self.options['valign'];\r\n                $media.style.cssText = $media.style.cssText.concat(`background-position: ${align} ${valign}`);\r\n            }\r\n        } else if (self.mediaType === 'video') {\r\n            const $videoMedia = $media as HTMLVideoElement;\r\n\r\n            $videoMedia.preload = 'auto';\r\n            $videoMedia.textContent = 'Unsupported Video';\r\n\r\n            if (Boolean(self.options['mute'])) {\r\n                $videoMedia.muted = self.options.mute === '1';\r\n            }\r\n\r\n            if (Boolean(self.options['scaletype'])) {\r\n                if (self.options.scaletype === 'stretch') {\r\n                    $videoMedia.style.objectFit = 'fill';\r\n                }\r\n            }\r\n            $videoMedia.playsInline = true;\r\n\r\n            if (self.loop) {\r\n                $videoMedia.loop = true;\r\n            }\r\n\r\n            $media = $videoMedia;\r\n        } else if (self.mediaType === 'audio') {\r\n            const $audioMedia = $media as HTMLAudioElement;\r\n\r\n            $audioMedia.preload = 'auto';\r\n            $audioMedia.textContent = 'Unsupported Audio';\r\n            $audioMedia.autoplay = true;\r\n\r\n            if (self.loop) {\r\n                $audioMedia.loop = true;\r\n            }\r\n\r\n            $media = $audioMedia;\r\n        }\r\n\r\n        // Duration is per item condition\r\n        if (self.render === 'html' || self.mediaType === 'ticker') {\r\n            /* Check if the ticker duration is based on the number of items in the feed */\r\n            if (self.options['durationisperitem'] === '1') {\r\n                const regex = new RegExp('<!-- NUMITEMS=(.*?) -->');\r\n\r\n                (async () => {\r\n                    let html = await fetchJSON(`${tmpUrl}&width=${self.divWidth}&height=${self.divHeight}`);\r\n                    console.debug({html});\r\n                    const res = regex.exec(html);\r\n\r\n                    if (res !== null) {\r\n                        self.duration = parseInt(String(self.duration)) * parseInt(res[1]);\r\n                    }\r\n                })();\r\n            }\r\n        }\r\n\r\n        // Check if the media has fade-in/out transitions\r\n        if (Boolean(self.options['transin']) && Boolean(self.options['transinduration'])) {\r\n            const transInDuration = Number(self.options.transinduration);\r\n            const fadeInTrans = transitionElement('fadeIn', { duration: transInDuration });\r\n            $media.animate(fadeInTrans.keyframes, fadeInTrans.timing);\r\n        }\r\n\r\n        // Add media to the region\r\n        // Second media if exists, will be off-canvas\r\n        // All added media will be hidden by default\r\n        // It will start showing when region.nextMedia() function is called\r\n\r\n        // When there's only 1 item and loop = false, don't remove the item but leave it at its last state\r\n        // For image, and only 1 item, it should still have the transition for next state\r\n        // Add conditions for video duration being 0 or 1 and also the loop property\r\n        // For video url, we have to create a URL out of the XLF video URL\r\n\r\n        /**\r\n         * @DONE\r\n         * Case 1: Video duration = 0, this will play the video for its entire duration\r\n         * Case 2: Video duration is set > 0 and loop = false\r\n         * E.g. Set duration = 100s, video duration = 62s\r\n         * the video will play until 62s and will stop to its last frame until 100s\r\n         * After 100s, it will expire\r\n         * Case 3: Video duration is set > 0 and loop = true\r\n         * E.g. Set duration = 100s, video duration = 62s, loop = true\r\n         * the video will play until 62s and will loop through until the remaining 38s\r\n         * to complete the 100s set duration\r\n         */\r\n\r\n        // Add html node to media for\r\n        self.html = $media;\r\n        // Check/set iframe based widgets play status\r\n    };\r\n\r\n    mediaObject.run = function() {\r\n        const self = mediaObject;\r\n        let transInDuration = 1;\r\n        let transInDirection: compassPoints = 'E';\r\n\r\n        if (Boolean(self.options['transinduration'])) {\r\n            transInDuration = Number(self.options.transinduration);\r\n        }\r\n\r\n        if (Boolean(self.options['transindirection'])) {\r\n            transInDirection = self.options.transindirection;\r\n        }\r\n\r\n        let defaultTransInOptions: TransitionElementOptions = {duration: transInDuration};\r\n        let transIn = transitionElement('defaultIn', {duration: defaultTransInOptions.duration});\r\n        \r\n        if (Boolean(self.options['transin'])) {\r\n            let transInName = self.options['transin'];\r\n\r\n            if (transInName === 'fly') {\r\n                transInName = `${transInName}In`;\r\n                defaultTransInOptions.keyframes = flyTransitionKeyframes({\r\n                    trans: 'in',\r\n                    direction: transInDirection,\r\n                    height: self.divHeight,\r\n                    width: self.divWidth,\r\n                });\r\n            }\r\n\r\n            transIn = transitionElement(transInName, defaultTransInOptions);\r\n        }\r\n\r\n        const showCurrentMedia = async () => {\r\n            let $mediaId = getMediaId(self);\r\n            let $media = document.getElementById($mediaId);\r\n            const isCMS = xlr.config.platform === 'CMS';\r\n\r\n            if ($media === null) {\r\n                $media = getNewMedia();\r\n            }\r\n\r\n            if ($media !== null) {\r\n                $media.style.setProperty('display', 'block');\r\n\r\n                if (Boolean(self.options['transin'])) {\r\n                    $media.animate(transIn.keyframes, transIn.timing);\r\n                }\r\n\r\n                if (self.mediaType === 'image' && self.url !== null) {\r\n                    ($media as HTMLImageElement).style\r\n                        .setProperty(\r\n                            'background-image',\r\n                            `url(${!isCMS ? self.url : await getDataBlob(self.url)}`\r\n                        );\r\n                } else if (self.mediaType === 'video' && self.url !== null) {\r\n                    ($media as HTMLVideoElement).src =\r\n                        isCMS ? await preloadMediaBlob(self.url, self.mediaType) : self.url;\r\n                } else if (self.mediaType === 'audio' && self.url !== null) {\r\n                    ($media as HTMLAudioElement).src =\r\n                        isCMS ? await preloadMediaBlob(self.url, self.mediaType) : self.url;\r\n                } else if ((self.render === 'html' || self.mediaType === 'webpage') &&\r\n                    self.iframe && self.checkIframeStatus\r\n                ) {\r\n                    // Set state as false ( for now )\r\n                    self.ready = false;\r\n\r\n                    // Append iframe\r\n                    $media.innerHTML = '';\r\n                    $media.appendChild(self.iframe as Node);\r\n\r\n                    // On iframe load, set state as ready to play full preview\r\n                    (self.iframe) && self.iframe.addEventListener('load', function(){\r\n                        self.ready = true;\r\n                        if (self.iframe) {\r\n                            const iframeStyles = self.iframe.style.cssText;\r\n                            self.iframe.style.cssText = iframeStyles?.concat('visibility: visible;');\r\n                        }\r\n                    });\r\n                }\r\n\r\n                self.emitter?.emit('start', self);\r\n            }\r\n        };\r\n        const getNewMedia = (): HTMLElement | null => {\r\n            const $region = document.getElementById(`${self.region.containerName}`);\r\n            // This function is for checking whether\r\n            // the region still has to show a media item\r\n            // when another region is not finished yet\r\n            if (self.region.complete && !self.region.layout.allEnded) {\r\n                // Add currentMedia to the region\r\n\r\n                ($region) && $region.insertBefore(self.html as Node, $region.lastElementChild);\r\n\r\n                return self.html as HTMLElement;\r\n            }\r\n\r\n            return null;\r\n        };\r\n\r\n        showCurrentMedia();\r\n    };\r\n\r\n    mediaObject.stop = async function() {\r\n        const self = mediaObject;\r\n        const $media = document.getElementById(getMediaId(self));\r\n\r\n        if ($media) {\r\n            $media.style.display = 'none';\r\n            $media.remove();\r\n        }\r\n    };\r\n\r\n    \r\n    mediaObject.on = function<E extends keyof IMediaEvents>(event: E, callback: IMediaEvents[E]) {\r\n        return emitter.on(event, callback);\r\n    };\r\n\r\n    mediaObject.emitter = emitter;\r\n\r\n    mediaObject.init();\r\n\r\n    return mediaObject;\r\n}","/*\n * Copyright (C) 2024 Xibo Signage Ltd\n *\n * Xibo - Digital Signage - https://www.xibosignage.com\n *\n * This file is part of Xibo.\n *\n * Xibo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * any later version.\n *\n * Xibo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with Xibo.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { IMedia } from '../../Types/Media';\nimport { capitalizeStr, getMediaId } from '../Generators';\n\nexport default function VideoMedia(media: IMedia) {\n    const videoMediaObject = {\n        init() {\n            const $videoMedia = document.getElementById(getMediaId(media)) as HTMLVideoElement;\n\n            if ($videoMedia) {\n                $videoMedia.onloadstart = () => {\n                    console.debug(`${capitalizeStr(media.mediaType)} for media > ${media.id} has started loading data . . .`);\n                };\n                $videoMedia.onloadeddata = () => {\n                    if ($videoMedia.readyState >= 2) {\n                        console.debug(`${capitalizeStr(media.mediaType)} data for media > ${media.id} has been fully loaded . . .`);\n                    }\n                };\n                $videoMedia.oncanplay = () => {\n                    console.debug(`${capitalizeStr(media.mediaType)} for media > ${media.id} can be played . . .`);\n        \n                    const videoPlayPromise = $videoMedia.play();\n        \n                    if (videoPlayPromise !== undefined) {\n                        videoPlayPromise.then(() => {\n                            console.debug('autoplay started . . .');\n                            // Autoplay restarted\n                        }).catch(error => {\n                            $videoMedia.muted = true;\n                            $videoMedia.play();\n                        });\n                    }\n                };\n                $videoMedia.onplaying = () => {\n                    console.debug(`${capitalizeStr(media.mediaType)} for media > ${media.id} is now playing . . .`);\n                };\n\n                if (media.duration === 0) {\n                    $videoMedia.ondurationchange = () => {\n                        console.debug('Showing Media ' + media.id + ' for ' + $videoMedia.duration + 's of Region ' + media.region.regionId);\n                    };\n                    $videoMedia.onended = () => {\n                        console.debug(`${capitalizeStr(media.mediaType)} for media > ${media.id} has ended playing . . .`);\n                        media.emitter?.emit('end', media);\n                    };\n                }\n            }\n        }\n    }\n\n    return videoMediaObject;\n}\n","/*\n * Copyright (C) 2024 Xibo Signage Ltd\n *\n * Xibo - Digital Signage - https://www.xibosignage.com\n *\n * This file is part of Xibo.\n *\n * Xibo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * any later version.\n *\n * Xibo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with Xibo.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { IMedia } from '../../Types/Media';\nimport { capitalizeStr, getMediaId } from '../Generators';\n\nimport './media.css';\n\nexport default function AudioMedia(media: IMedia) {\n    const audioMediaObject = {\n        init() {\n            const $audioMedia = document.getElementById(getMediaId(media)) as HTMLAudioElement;\n            let $playBtn: HTMLButtonElement | null = null;\n\n            if ($audioMedia) {\n                $audioMedia.onloadstart = () => {\n                    console.debug(`${capitalizeStr(media.mediaType)} for media > ${media.id} has started loading data . . .`);\n                };\n                $audioMedia.onloadeddata = () => {\n                    if ($audioMedia.readyState >= 2) {\n                        console.debug(`${capitalizeStr(media.mediaType)} data for media > ${media.id} has been fully loaded . . .`);\n                    }\n                };\n                $audioMedia.oncanplay = () => {\n                    console.debug(`${capitalizeStr(media.mediaType)} for media > ${media.id} can be played . . .`);\n                };\n                $audioMedia.onplaying = () => {\n                    console.debug(`${capitalizeStr(media.mediaType)} for media > ${media.id} is now playing . . .`);\n\n                    if ($playBtn !== null) {\n                        $playBtn.remove();\n                    }\n                };\n\n                const audioPlayPromise = $audioMedia.play();\n    \n                if (audioPlayPromise !== undefined) {\n                    audioPlayPromise.then(() => {\n                        console.debug('autoplay started . . .');\n                        // Autoplay restarted\n                    }).catch(error => {\n                        if (error.name === 'NotAllowedError') {\n                            // Let's show a play audio button\n                            $playBtn = document.createElement('button');\n\n                            $playBtn.classList.add('play-audio-btn');\n                            $playBtn.textContent = 'Play Audio';\n                            $playBtn.addEventListener('click', () => {\n                                $audioMedia.muted = false;\n                                $audioMedia.play();\n                            });\n                            $audioMedia.parentNode?.insertBefore($playBtn, $audioMedia.nextSibling);\n                        }\n                    });\n                }\n                if (media.duration === 0) {\n                    $audioMedia.ondurationchange = () => {\n                        console.debug('Showing Media ' + media.id + ' for ' + $audioMedia.duration + 's of Region ' + media.region.regionId);\n                    };\n                    $audioMedia.onended = () => {\n                        console.debug(`${capitalizeStr(media.mediaType)} for media > ${media.id} has ended playing . . .`);\n                        media.emitter?.emit('end', media);\n                    };\n                }\n            }\n        },\n    };\n\n    return audioMediaObject;\n}\n","/*\r\n * Copyright (C) 2024 Xibo Signage Ltd\r\n *\r\n * Xibo - Digital Signage - https://www.xibosignage.com\r\n *\r\n * This file is part of Xibo.\r\n *\r\n * Xibo is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Lesser General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * any later version.\r\n *\r\n * Xibo is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU Lesser General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Lesser General Public License\r\n * along with Xibo.  If not, see <http://www.gnu.org/licenses/>.\r\n */\r\nimport {createNanoEvents} from 'nanoevents';\r\nimport {\r\n    GetLayoutParamType,\r\n    GetLayoutType,\r\n    ILayout,\r\n    initialLayout,\r\n    OptionsType,\r\n} from '../../Types/Layout';\r\nimport { IXlr } from '../../Types/XLR';\r\nimport { nextId } from '../Generators';\r\nimport { Region } from '../Region';\r\n\r\nimport './layout.css';\r\nimport {composeBgUrlByPlatform, getIndexByLayoutId} from '../Generators/Generators';\r\n\r\nconst playAgainClickHandle = function(ev: { preventDefault: () => void; }) {\r\n    ev.preventDefault();\r\n    history.go(0);\r\n};\r\n\r\nexport function initRenderingDOM(targetContainer: Element | null) {\r\n    let _targetContainer = targetContainer;\r\n    const previewPlayer = document.createElement('div');\r\n    const previewScreen = document.createElement('div');\r\n    const endPlay = document.createElement('div');\r\n    const playAgainLink = document.createElement('a');\r\n\r\n    // Preview player\r\n    previewPlayer.className = 'player-preview';\r\n    previewPlayer.id = 'player_container';\r\n\r\n    // Preview screen\r\n    previewScreen.className = 'screen-preview';\r\n    previewScreen.id = 'screen_container';\r\n\r\n    // Ended play\r\n    endPlay.className = 'preview-ended';\r\n    endPlay.id = 'play_ended';\r\n    endPlay.style.display = 'none';\r\n\r\n    // Play again link\r\n    playAgainLink.id = 'play_back_preview';\r\n    playAgainLink.className = 'play-back-preview';\r\n    playAgainLink.style.cssText = 'text-decoration: none; color: #ffffff;';\r\n    playAgainLink.innerHTML = 'Play again?';\r\n    playAgainLink.removeEventListener('click', playAgainClickHandle);\r\n    playAgainLink.addEventListener('click', playAgainClickHandle);\r\n\r\n    if (!_targetContainer) {\r\n        _targetContainer = document.body;\r\n    }\r\n\r\n    if (_targetContainer) {\r\n        if (_targetContainer.querySelector('#player_container') === null) {\r\n            _targetContainer.insertBefore(previewPlayer, _targetContainer.firstChild);\r\n\r\n            if (previewPlayer.querySelector('#screen_container') === null) {\r\n                previewPlayer.appendChild(previewScreen);\r\n            }\r\n\r\n            if (previewPlayer.querySelector('#play_ended') === null) {\r\n                previewPlayer.appendChild(endPlay);\r\n\r\n                if (endPlay.querySelector('a') === null) {\r\n                    endPlay.appendChild(playAgainLink);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport async function getXlf(layoutOptions: OptionsType) {\r\n    let apiHost = window.location.origin;\r\n\r\n    let xlfUrl = apiHost + layoutOptions.xlfUrl;\r\n    let fetchOptions: RequestInit = {};\r\n\r\n    if (layoutOptions.platform === 'CMS') {\r\n        xlfUrl = apiHost + layoutOptions.xlfUrl;\r\n        fetchOptions.mode = 'no-cors';\r\n    } else if (layoutOptions.platform === 'chromeOS') {\r\n        xlfUrl = layoutOptions.xlfUrl;\r\n        fetchOptions.mode = 'cors';\r\n        fetchOptions.headers = {\r\n            'Content-Type': 'text/xml',\r\n        };\r\n    } else if (layoutOptions.platform !== 'CMS' && layoutOptions.appHost !== null) {\r\n        xlfUrl = layoutOptions.appHost + layoutOptions.xlfUrl;\r\n    }\r\n\r\n    const res = await fetch(xlfUrl);\r\n\r\n    return await res.text();\r\n}\r\n\r\nexport function handleAxiosError(error: any, message?: string) {\r\n    console.error(error);\r\n    if (error.response.status == 500) {\r\n        // SOAP responses are always 500's\r\n        // Return the body\r\n        throw new Error(error.response.data);\r\n    } else {\r\n        throw new Error(message || 'Unknown Error');\r\n    }\r\n}\r\n\r\nexport function getLayout(params: GetLayoutParamType): GetLayoutType {\r\n    let _currentLayout = undefined;\r\n    let _nextLayout = undefined;\r\n    let {\r\n        inputLayouts,\r\n        currentLayout,\r\n        nextLayout,\r\n        currentLayoutIndex: currLayoutIndx\r\n    } = params.xlr;\r\n    const hasLayout = inputLayouts.length > 0;\r\n    let currentLayoutIndex = currLayoutIndx;\r\n    let nextLayoutIndex = currentLayoutIndex + 1;\r\n\r\n    if (currentLayout === undefined && nextLayout === undefined) {\r\n        let activeLayout;\r\n        // Preview just got started\r\n        if (hasLayout) {\r\n            let nextLayoutTemp = {...initialLayout};\r\n            activeLayout = inputLayouts[currentLayoutIndex];\r\n            _currentLayout = {...initialLayout, ...activeLayout};\r\n\r\n            if (inputLayouts.length > 1) {\r\n                nextLayoutTemp = {...nextLayoutTemp, ...inputLayouts[nextLayoutIndex]};\r\n                _nextLayout = nextLayoutTemp;\r\n            } else {\r\n                _nextLayout = _currentLayout;\r\n            }\r\n\r\n            _currentLayout.id = activeLayout.layoutId;\r\n\r\n            if (nextLayoutTemp) {\r\n                _nextLayout.id = nextLayoutTemp.layoutId;\r\n            }\r\n        }\r\n    } else {\r\n        if (hasLayout) {\r\n            _currentLayout = nextLayout;\r\n\r\n            currentLayoutIndex = getIndexByLayoutId(inputLayouts, _currentLayout?.layoutId).index as number;\r\n            nextLayoutIndex = currentLayoutIndex + 1;\r\n\r\n            if (inputLayouts.length > 1 && nextLayoutIndex < inputLayouts.length) {\r\n                if (Boolean(params.xlr.layouts[nextLayoutIndex])) {\r\n                    _nextLayout = params.xlr.layouts[nextLayoutIndex];\r\n                } else {\r\n                    _nextLayout = {...initialLayout, ...inputLayouts[nextLayoutIndex]};\r\n                }\r\n            }\r\n\r\n            // If _nextLayout is undefined, then we go back to first layout\r\n            if (_nextLayout === undefined) {\r\n                _nextLayout = params.xlr.layouts[0];\r\n            }\r\n        }\r\n    }\r\n\r\n    return {\r\n        currentLayoutIndex,\r\n        inputLayouts: params.xlr.inputLayouts,\r\n        current: _currentLayout,\r\n        next: _nextLayout,\r\n    }\r\n}\r\n\r\nexport interface ILayoutEvents {\r\n    start: (layout: ILayout) => void;\r\n    end: (layout: ILayout) => void;\r\n}\r\n\r\nexport default function Layout(\r\n    data: Document | null,\r\n    options: OptionsType,\r\n    xlr: IXlr,\r\n    layout?: ILayout\r\n) {\r\n    const props = {\r\n        data: data,\r\n        options: options,\r\n        layout: layout || initialLayout,\r\n    }\r\n    const emitter = createNanoEvents<ILayoutEvents>();\r\n\r\n    emitter.on('start', (layout) => {\r\n        layout.done = false;\r\n        console.debug('Layout start emitted > Layout ID > ', layout.id);\r\n    });\r\n\r\n    emitter.on('end', (layout) => {\r\n        console.debug('Ending layout with ID of > ', layout.layoutId);\r\n        layout.done = true;\r\n        /* Remove layout that has ended */\r\n        const $layout = document.getElementById(layout.containerName);\r\n\r\n        console.debug({$layout});\r\n\r\n        if ($layout !== null) {\r\n            $layout.remove();\r\n        }\r\n\r\n        if (xlr.config.platform !== 'CMS') {\r\n            // Transition next layout to current layout and prepare next layout if exist\r\n            xlr.prepareLayouts().then((parent) => {\r\n                xlr.playSchedules(parent);\r\n            });\r\n        }\r\n    });\r\n\r\n    const layoutObject: ILayout = {\r\n        ...props.layout,\r\n        options: props.options,\r\n        emitter,\r\n    };\r\n\r\n    layoutObject.on = function<E extends keyof ILayoutEvents>(event: E, callback: ILayoutEvents[E]) {\r\n        return emitter.on(event, callback);\r\n    };\r\n    layoutObject.run = function() {\r\n        const layout = layoutObject;\r\n        const $layoutContainer = document.getElementById(`${layout.containerName}`);\r\n        const $splashScreen = document.getElementById(`splash_${layout.id}`);\r\n\r\n        if ($layoutContainer) {\r\n            $layoutContainer.style.display = 'block';\r\n        }\r\n\r\n        if ($splashScreen) {\r\n            $splashScreen.style.display = 'none';\r\n        }\r\n\r\n        console.debug('Layout running > Layout ID > ', layout.id);\r\n        console.debug('Layout Regions > ', layout.regions);\r\n        for (let i = 0; i < layout.regions.length; i++) {\r\n            // playLog(4, \"debug\", \"Running region \" + self.regions[i].id, false);\r\n            layout.regions[i].run();\r\n        }\r\n    };\r\n\r\n    layoutObject.parseXlf = function() {\r\n        const layout = layoutObject;\r\n        const {data, options} = props;\r\n        layout.containerName = \"L\" + layout.id + \"-\" + nextId(options);\r\n        layout.regions = [];\r\n\r\n        /* Create a hidden div to show the layout in */\r\n        let $layout = document.getElementById(layout.containerName);\r\n\r\n        if ($layout === null) {\r\n            $layout = document.createElement('div');\r\n            $layout.id = layout.containerName;\r\n        }\r\n\r\n        let $screen = document.getElementById('screen_container');\r\n        ($screen) && $screen.appendChild($layout);\r\n\r\n        if ($layout) {\r\n            $layout.style.display = 'none';\r\n            $layout.style.outline = 'red solid thin';\r\n        }\r\n\r\n        layout.layoutNode = data;\r\n\r\n        /* Calculate the screen size */\r\n        layout.sw = $screen?.offsetWidth || 0;\r\n        layout.sh = $screen?.offsetHeight || 0;\r\n\r\n        layout.xw = Number(layout.layoutNode?.firstElementChild?.getAttribute('width'));\r\n        layout.xh = Number(layout.layoutNode?.firstElementChild?.getAttribute('height'));\r\n        layout.zIndex = Number(layout.layoutNode?.firstElementChild?.getAttribute('zindex')) || 0;\r\n\r\n        /* Calculate Scale Factor */\r\n        layout.scaleFactor = Math.min((layout.sw / layout.xw), (layout.sh / layout.xh));\r\n        layout.sWidth = Math.round(layout.xw * layout.scaleFactor);\r\n        layout.sHeight = Math.round(layout.xh * layout.scaleFactor);\r\n        layout.offsetX = Math.abs(layout.sw - layout.sWidth) / 2;\r\n        layout.offsetY = Math.abs(layout.sh - layout.sHeight) / 2;\r\n\r\n        /* Scale the Layout Container */\r\n        if ($layout) {\r\n            $layout.style.width = `${layout.sWidth}px`;\r\n            $layout.style.height = `${layout.sHeight}px`;\r\n            $layout.style.position = 'absolute';\r\n            $layout.style.left = `${layout.offsetX}px`;\r\n            $layout.style.top = `${layout.offsetY}px`;\r\n        }\r\n\r\n        if ($layout && layout.zIndex !== null) {\r\n            $layout.style.zIndex = `${layout.zIndex}`;\r\n        }\r\n\r\n        /* Set the layout background */\r\n        layout.bgColor = layout.layoutNode?.firstElementChild?.getAttribute('bgcolor') || '';\r\n        layout.bgImage = layout.layoutNode?.firstElementChild?.getAttribute('background') || '';\r\n\r\n        if (!(layout.bgImage === \"\" || typeof layout.bgImage === 'undefined')) {\r\n            /* Extract the image ID from the filename */\r\n            layout.bgId = layout.bgImage.substring(0, layout.bgImage.indexOf('.'));\r\n\r\n            const bgImageUrl = composeBgUrlByPlatform(\r\n                xlr.config.platform,\r\n                {\r\n                    ...options,\r\n                    layout,\r\n                }\r\n            );\r\n\r\n            if ($layout) {\r\n                $layout.style.backgroundImage = `url(\"${bgImageUrl}\")`;\r\n                $layout.style.backgroundRepeat = 'no-repeat';\r\n                $layout.style.backgroundSize = `${layout.sWidth}px ${layout.sHeight}px`;\r\n                $layout.style.backgroundPosition = '0px 0px';\r\n            }\r\n        }\r\n\r\n        // Set the background color\r\n        if ($layout && layout.bgColor) {\r\n            $layout.style.backgroundColor = `${layout.bgColor}`;\r\n        }\r\n\r\n        // Hide if layout is not the currentLayout\r\n        if ($layout && xlr.currentLayoutId !== undefined && xlr.currentLayoutId !== layout.id) {\r\n            $layout.style.display = 'none';\r\n        }\r\n\r\n        // Create regions\r\n        const layoutRegions = Array.from(layout?.layoutNode?.getElementsByTagName('region') || []);\r\n\r\n        Array.from(layoutRegions).forEach((regionXml, indx) => {\r\n            const regionObj = Region(\r\n                layout,\r\n                regionXml,\r\n                regionXml?.getAttribute('id') || '',\r\n                options,\r\n                xlr,\r\n            );\r\n\r\n            regionObj.index = indx;\r\n            layout.regions.push(regionObj);\r\n        });\r\n    };\r\n\r\n    layoutObject.prepareLayout = function() {\r\n        layoutObject.parseXlf();\r\n    };\r\n\r\n    layoutObject.regionExpired = function() {\r\n        const self = layoutObject;\r\n        self.allExpired = true;\r\n\r\n        for (let layoutRegion of self.regions) {\r\n            if (!layoutRegion.complete) {\r\n                self.allExpired = false;\r\n            }\r\n        }\r\n\r\n        if (self.allExpired) {\r\n            self.end();\r\n        }\r\n    };\r\n\r\n    layoutObject.regionEnded = function() {\r\n        const self = layoutObject;\r\n        self.allEnded = true;\r\n        \r\n        for (var i = 0; i < self.regions.length; i++) {\r\n            if (! self.regions[i].ended) {\r\n                self.allEnded = false;\r\n            }\r\n        }\r\n        \r\n        if (self.allEnded) {\r\n            self.stopAllMedia().then(() => {\r\n                console.debug('starting to end layout . . .');\r\n                if (xlr.config.platform === 'CMS') {\r\n                    const $end = document.getElementById('play_ended');\r\n                    const $preview = document.getElementById('screen_container');\r\n        \r\n                    if ($preview) {\r\n                        while($preview.firstChild) {\r\n                            $preview.removeChild($preview.firstChild);\r\n                        }\r\n        \r\n                        $preview.style.display = 'none';\r\n                    }\r\n        \r\n                    if ($end) {\r\n                        $end.style.display = 'block';\r\n                    }\r\n                }\r\n                \r\n                self.emitter?.emit('end', self);\r\n            });\r\n\r\n        }\r\n    };\r\n\r\n    layoutObject.end = function() {\r\n        console.debug('Executing Layout::end and Calling Region::end ', layoutObject);\r\n\r\n        /* Ask the layout to gracefully stop running now */\r\n        for (let layoutRegion of layoutObject.regions) {\r\n            layoutRegion.end();\r\n        }\r\n    };\r\n\r\n    layoutObject.stopAllMedia = function() {\r\n        console.debug('Stopping all media . . .');\r\n        return new Promise(async (resolve) => {\r\n            for(var i = 0;i < layoutObject.regions.length;i++) {\r\n                var region = layoutObject.regions[i];\r\n                for(var j = 0;j < region.mediaObjects.length;j++) {\r\n                    var media = region.mediaObjects[j];\r\n                    await media.stop();\r\n                }\r\n            }\r\n\r\n            resolve();\r\n        });\r\n    };\r\n\r\n    layoutObject.prepareLayout();\r\n\r\n    return layoutObject;\r\n}\r\n","/*\r\n * Copyright (C) 2024 Xibo Signage Ltd\r\n *\r\n * Xibo - Digital Signage - https://www.xibosignage.com\r\n *\r\n * This file is part of Xibo.\r\n *\r\n * Xibo is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Lesser General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * any later version.\r\n *\r\n * Xibo is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU Lesser General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Lesser General Public License\r\n * along with Xibo.  If not, see <http://www.gnu.org/licenses/>.\r\n */\r\nimport {ILayout, InputLayoutType, OptionsType} from '../Layout';\r\nimport {platform} from '../../Modules/Platform';\r\n\r\nexport type PrepareLayoutsType = {\r\n    moveNext?: boolean;\r\n};\r\n\r\nexport enum ELayoutType {\r\n    CURRENT,\r\n    NEXT,\r\n}\r\n\r\nexport interface IXlr {\r\n    inputLayouts: InputLayoutType[],\r\n    config: OptionsType,\r\n    layouts: ILayout[],\r\n    currentLayoutIndex: number;\r\n    currentLayoutId: number | null;\r\n    currentLayout: ILayout | undefined;\r\n    nextLayout: ILayout | undefined;\r\n    bootstrap(): void;\r\n    init(): Promise<IXlr>;\r\n    playSchedules(xlr: IXlr): void;\r\n    prepareLayoutXlf(inputLayout: ILayout | undefined): Promise<ILayout>;\r\n    prepareLayouts(): Promise<IXlr>;\r\n    updateLayouts(inputLayouts: InputLayoutType[]): void;\r\n}\r\n\r\nexport const initialXlr: IXlr = {\r\n    inputLayouts: [],\r\n    config: platform,\r\n    layouts: [],\r\n    currentLayoutIndex: 0,\r\n    currentLayoutId: null,\r\n    currentLayout: undefined,\r\n    nextLayout: undefined,\r\n    bootstrap() {\r\n    },\r\n    init() {\r\n        return Promise.resolve(<IXlr>{});\r\n    },\r\n    playSchedules() {\r\n    },\r\n    prepareLayoutXlf(inputLayout: ILayout | undefined): Promise<ILayout> {\r\n        return Promise.resolve(<ILayout>{});\r\n    },\r\n    prepareLayouts(): Promise<IXlr> {\r\n        return Promise.resolve(<IXlr>{});\r\n    },\r\n    updateLayouts(inputLayouts: InputLayoutType[]) {\r\n    }\r\n};\r\n","/*\r\n * Copyright (C) 2024 Xibo Signage Ltd\r\n *\r\n * Xibo - Digital Signage - https://www.xibosignage.com\r\n *\r\n * This file is part of Xibo.\r\n *\r\n * Xibo is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Lesser General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * any later version.\r\n *\r\n * Xibo is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU Lesser General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Lesser General Public License\r\n * along with Xibo.  If not, see <http://www.gnu.org/licenses/>.\r\n */\r\nimport { createNanoEvents } from 'nanoevents';\r\nimport { ILayout, OptionsType } from '../../Types/Layout';\r\nimport { initialRegion, IRegion, IRegionEvents } from '../../Types/Region';\r\nimport { IMedia } from '../../Types/Media';\r\nimport { getMediaId, nextId } from '../Generators';\r\nimport { platform } from '../Platform';\r\nimport { Media } from '../Media';\r\nimport {\r\n    TransitionElementOptions,\r\n    TransitionNameType,\r\n    compassPoints,\r\n    flyTransitionKeyframes,\r\n    transitionElement,\r\n} from '../Transitions';\r\nimport {IXlr} from '../../Types/XLR';\r\n\r\nexport default function Region(\r\n    layout: ILayout,\r\n    xml: Element,\r\n    regionId: string,\r\n    options: OptionsType,\r\n    xlr: IXlr,\r\n) {\r\n    const props = {\r\n        layout: layout,\r\n        xml: xml,\r\n        regionId: regionId,\r\n        options: options,\r\n    }\r\n    const emitter = createNanoEvents<IRegionEvents>();\r\n    let regionObject: IRegion = {\r\n        ...initialRegion,\r\n        ...props,\r\n    };\r\n\r\n    regionObject.prepareRegion = function() {\r\n        const self = regionObject;\r\n        const {layout, options} = self;\r\n        self.id = props.regionId;\r\n        self.options = {...platform, ...props.options};\r\n        self.containerName = `R-${self.id}-${nextId(self.options as OptionsType & IRegion[\"options\"])}`;\r\n        self.xml = props.xml;\r\n        self.mediaObjects = [];\r\n\r\n        self.sWidth = (self.xml) && Number(self.xml?.getAttribute('width')) * layout.scaleFactor;\r\n        self.sHeight = (self.xml) && Number(self.xml?.getAttribute('height')) * layout.scaleFactor;\r\n        self.offsetX = (self.xml) && Number(self.xml?.getAttribute('left')) * layout.scaleFactor;\r\n        self.offsetY = (self.xml) && Number(self.xml?.getAttribute('top')) * layout.scaleFactor;\r\n        self.zIndex = (self.xml) && Number(self.xml?.getAttribute('zindex'));\r\n        \r\n        const regionOptions = self.xml?.getElementsByTagName('options');\r\n\r\n        if (regionOptions) {\r\n            for (let _options of Array.from(regionOptions)) {\r\n                // Get options\r\n                const _regionOptions = _options.children;\r\n                for (let regionOption of Array.from(_regionOptions)) {\r\n                    self.options[regionOption.nodeName.toLowerCase()] = regionOption.textContent;\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        let $region = document.getElementById(self.containerName);\r\n        const $layout = document.getElementById(`${self.layout.containerName}`);\r\n\r\n        if ($region === null) {\r\n            $region = document.createElement('div');\r\n            $region.id = self.containerName;\r\n        }\r\n\r\n        ($layout) && $layout.appendChild($region);\r\n\r\n        /* Scale the Layout Container */\r\n        /* Add region styles */\r\n        $region.style.cssText = `\r\n            width: ${self.sWidth}px;\r\n            height: ${self.sHeight}px;\r\n            position: absolute;\r\n            left: ${self.offsetX}px;\r\n            top: ${self.offsetY}px;\r\n            z-index: ${Math.round(self.zIndex)};\r\n        `;\r\n        $region.className = 'region--item';\r\n\r\n        /* Parse region media objects */\r\n        const regionMediaItems = Array.from(self.xml.getElementsByTagName('media'));\r\n        self.totalMediaObjects = regionMediaItems.length;\r\n\r\n        Array.from(regionMediaItems).forEach((mediaXml, indx) => {\r\n            const mediaObj = Media(\r\n                self,\r\n                mediaXml?.getAttribute('id') || '',\r\n                mediaXml,\r\n                options as OptionsType & IRegion[\"options\"],\r\n                xlr,\r\n            );\r\n\r\n            mediaObj.index = indx;\r\n            self.mediaObjects.push(mediaObj);\r\n        });\r\n\r\n        self.prepareMediaObjects();\r\n    };\r\n\r\n    regionObject.finished = function() {\r\n        const self = regionObject;\r\n        console.debug('Region::finished called . . . ', self.id);\r\n        // Mark as complete\r\n        self.complete = true;\r\n        self.layout.regions[regionObject.index] = regionObject;\r\n        self.layout.regionExpired();\r\n    };\r\n\r\n    regionObject.prepareMediaObjects = function() {\r\n        const self = regionObject;\r\n        let nextMediaIndex;\r\n\r\n        if (self.mediaObjects.length > 0) {\r\n\r\n            if (self.curMedia) {\r\n                self.oldMedia = self.curMedia;\r\n            } else {\r\n                self.oldMedia = undefined;\r\n            }\r\n\r\n            if (self.currentMediaIndex >= self.mediaObjects.length) {\r\n                self.currentMediaIndex = 0;\r\n            }\r\n\r\n            self.curMedia = self.mediaObjects[self.currentMediaIndex];\r\n\r\n            nextMediaIndex = self.currentMediaIndex + 1;\r\n\r\n            if (nextMediaIndex >= self.mediaObjects.length ||\r\n                (\r\n                    !Boolean(self.mediaObjects[nextMediaIndex]) &&\r\n                    self.mediaObjects.length === 1\r\n                )\r\n            ) {\r\n                nextMediaIndex = 0;\r\n            }\r\n\r\n            if (Boolean(self.mediaObjects[nextMediaIndex])) {\r\n                self.nxtMedia = self.mediaObjects[nextMediaIndex];\r\n            }\r\n\r\n            const $region = document.getElementById(`${self.containerName}`);\r\n            // Append available media to region DOM\r\n            if (self.curMedia) {\r\n                ($region) && $region.insertBefore(self.curMedia.html as Node, $region.lastElementChild);\r\n            }\r\n\r\n            if (self.nxtMedia) {\r\n                ($region) && $region.insertBefore(self.nxtMedia.html as Node, $region.lastElementChild);\r\n            }\r\n        }\r\n    };\r\n\r\n    regionObject.run = function() {\r\n        console.debug('Called Region::run > ', regionObject.id);\r\n\r\n        if (regionObject.curMedia) {\r\n            regionObject.transitionNodes(regionObject.oldMedia, regionObject.curMedia);\r\n        }\r\n    };\r\n\r\n    regionObject.transitionNodes = function(oldMedia: IMedia | undefined, newMedia: IMedia | undefined) {\r\n        const self = regionObject;\r\n        let transOutDuration = 1;\r\n        let transOutDirection: compassPoints = 'E';\r\n\r\n        if (newMedia) {\r\n            if (oldMedia && Boolean(oldMedia.options['transoutduration'])) {\r\n                transOutDuration = Number(oldMedia.options.transoutduration);\r\n            }\r\n\r\n            if (oldMedia && Boolean(oldMedia.options['transoutdirection'])) {\r\n                transOutDirection = oldMedia.options.transoutdirection;\r\n            }\r\n    \r\n            let defaultTransOutOptions: TransitionElementOptions = {duration: transOutDuration};\r\n            let transOut = transitionElement('defaultOut', {duration: defaultTransOutOptions.duration});\r\n    \r\n            let transOutName: TransitionNameType | string;\r\n            if (oldMedia && Boolean(oldMedia.options['transout'])) {\r\n                transOutName = oldMedia.options['transout'];\r\n    \r\n                if (transOutName === 'fly') {\r\n                    transOutName = `${transOutName}Out`;\r\n                    defaultTransOutOptions.keyframes = flyTransitionKeyframes({\r\n                        trans: 'out',\r\n                        direction: transOutDirection,\r\n                        height: oldMedia.divHeight,\r\n                        width: oldMedia.divWidth,\r\n                    });\r\n                }\r\n                \r\n                transOut = transitionElement(transOutName as TransitionNameType, defaultTransOutOptions);\r\n            }\r\n            \r\n            const hideOldMedia = new Promise((resolve) => {\r\n                // Hide oldMedia\r\n                if (oldMedia) {\r\n                    const $oldMedia = document.getElementById(getMediaId(oldMedia));\r\n                    if ($oldMedia) {\r\n                        const removeOldMedia = () => {\r\n                            $oldMedia.style.setProperty('display', 'none');\r\n                            $oldMedia.remove();\r\n                        };\r\n\r\n                        let oldMediaAnimate: any;\r\n                        if (Boolean(oldMedia.options['transout'])) {\r\n                            oldMediaAnimate = $oldMedia.animate(transOut.keyframes, transOut.timing);\r\n                        }\r\n\r\n                        if (Boolean(oldMedia.options['transout']) && self.totalMediaObjects > 1) {\r\n                            if (transOutName === 'flyOut') {\r\n                                // Reset last item to original position and state\r\n                                oldMediaAnimate ? oldMediaAnimate.finished\r\n                                    .then(() => {\r\n                                        resolve(true);\r\n                                        oldMediaAnimate?.effect?.updateTiming({fill: 'none'});\r\n                                        removeOldMedia();\r\n                                    }) : undefined;\r\n                            } else {\r\n                                setTimeout(removeOldMedia, transOutDuration / 2);\r\n                                resolve(true);\r\n                            }\r\n                        } else {\r\n                            removeOldMedia();\r\n                            // Resolve this right away\r\n                            // As a result, the transition between two media object\r\n                            // seems like a cross-over\r\n                            resolve(true);\r\n\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n    \r\n            if (oldMedia) {\r\n                hideOldMedia.then((isDone) => {\r\n                    if (isDone) {\r\n                        newMedia.run();\r\n                    }\r\n                });\r\n            } else {\r\n                newMedia.run();\r\n            }\r\n        }\r\n    };\r\n\r\n    regionObject.playNextMedia = function() {\r\n        const self = regionObject;\r\n\r\n        /* The current media has finished running */\r\n        if (self.ended) {\r\n            return;\r\n        }\r\n\r\n        if (self.currentMediaIndex === self.mediaObjects.length - 1) {\r\n            self.finished();\r\n\r\n            if (self.layout.allEnded) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        // When the region has completed and when currentMedia is html\r\n        // Then, preserve the currentMedia state\r\n        if (self.complete &&\r\n            self.curMedia?.render === 'html'\r\n        ) {\r\n            return;\r\n        }\r\n\r\n        // When the region has completed and mediaObjects.length = 1\r\n        // and curMedia.loop = false, then put the media on\r\n        // its current state\r\n        if (self.complete && self.mediaObjects.length === 1 &&\r\n            self.curMedia?.render !== 'html' &&\r\n            self.curMedia?.mediaType === 'image' &&\r\n            !self.curMedia?.loop\r\n        ) {\r\n            return;\r\n        }\r\n\r\n        self.currentMediaIndex = self.currentMediaIndex + 1;\r\n        self.prepareMediaObjects();\r\n\r\n        self.transitionNodes(self.oldMedia, self.curMedia);\r\n    };\r\n    \r\n    regionObject.end = function() {\r\n        const self = regionObject;\r\n        self.ending = true;\r\n        /* The Layout has finished running */\r\n        /* Do any region exit transition then clean up */\r\n        self.layout.regions[self.index] = self;\r\n\r\n        console.debug('Calling Region::end ', self);\r\n        self.exitTransition();\r\n    };\r\n\r\n    regionObject.exitTransition = function() {\r\n        const self = regionObject;\r\n        /* TODO: Actually implement region exit transitions */\r\n        const $region = document.getElementById(`${self.containerName}`);\r\n\r\n        if ($region) {\r\n            $region.style.display = 'none';\r\n        }\r\n\r\n        console.debug('Called Region::exitTransition ', self.id);\r\n\r\n        self.exitTransitionComplete();\r\n    };\r\n\r\n    regionObject.exitTransitionComplete = function() {\r\n        const self = regionObject;\r\n        console.debug('Called Region::exitTransitionComplete ', self.id);\r\n        self.ended = true;\r\n        self.layout.regions[self.index] = self;\r\n        self.layout.regionEnded();\r\n    };\r\n\r\n    regionObject.on = function<E extends keyof IRegionEvents>(event: E, callback: IRegionEvents[E]) {\r\n        return emitter.on(event, callback);\r\n    };\r\n\r\n    regionObject.emitter = emitter;\r\n\r\n    regionObject.prepareRegion();\r\n\r\n    return regionObject;\r\n}","/*\r\n * Copyright (C) 2024 Xibo Signage Ltd\r\n *\r\n * Xibo - Digital Signage - https://www.xibosignage.com\r\n *\r\n * This file is part of Xibo.\r\n *\r\n * Xibo is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Lesser General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * any later version.\r\n *\r\n * Xibo is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU Lesser General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Lesser General Public License\r\n * along with Xibo.  If not, see <http://www.gnu.org/licenses/>.\r\n */\r\nimport {\r\n    Layout, getLayout, getXlf, initRenderingDOM\r\n} from './Modules/Layout';\r\nimport { platform } from './Modules/Platform';\r\nimport {\r\n    ILayout, initialLayout, InputLayoutType, OptionsType,\r\n} from './Types/Layout';\r\nimport { initialXlr, IXlr } from './Types/XLR';\r\nimport {SplashScreen, ISplashScreen} from './Modules/SplashScreen';\r\n\r\nexport default function XiboLayoutRenderer(\r\n    inputLayouts: InputLayoutType[],\r\n    options?: OptionsType,\r\n) {\r\n    const props = {\r\n        inputLayouts,\r\n        options,\r\n    }\r\n\r\n    const xlrObject: IXlr = {\r\n        ...initialXlr,\r\n        bootstrap() {\r\n            // Place to set configurations and initialize required props\r\n            const self = this;\r\n            self.inputLayouts = !Array.isArray(props.inputLayouts) ?\r\n                [props.inputLayouts] : props.inputLayouts;\r\n            self.config = JSON.parse(JSON.stringify({...platform, ...props.options}));\r\n\r\n            // Prepare rendering DOM\r\n            const previewCanvas = document.querySelector('.preview-canvas');\r\n\r\n            initRenderingDOM(previewCanvas);\r\n\r\n            // Prepare splash screen\r\n            const splashScreen = SplashScreen(document.querySelector('.player-preview'));\r\n\r\n            splashScreen.show();\r\n\r\n        },\r\n        init() {\r\n            return new Promise<IXlr>((resolve) => {\r\n                const self = this;\r\n\r\n                self.prepareLayouts().then((xlr) => {\r\n                    resolve(xlr);\r\n                });\r\n            });\r\n        },\r\n\r\n        playSchedules(xlr: IXlr) {\r\n            // Check if there's a current layout\r\n            if (xlr.currentLayout !== undefined) {\r\n                xlr.currentLayout.emitter?.emit('start', xlr.currentLayout);\r\n                xlr.currentLayout.run();\r\n            }\r\n        },\r\n\r\n        updateLayouts(inputLayouts: InputLayoutType[]) {\r\n            /**\r\n             * @TODO\r\n             * Case 1: If currentLayout in inputLayouts and in the same sequence,\r\n             * Then, continue playing currentLayout.\r\n             * Check nextLayout in inputLayouts. If in inputLayouts and same sequence, then don't change.\r\n             * If not in inputLayouts, then replace and prepare nextLayout.\r\n             *\r\n             * Case 2: If currentLayout in inputLayouts but not in the same sequence,\r\n             * Then, replace loop, prepare layouts and start currentLayout\r\n             *\r\n             * Case 3: If currentLayout not in inputLayouts,\r\n             * Then, replace everything and start from first layout in sequence.\r\n             */\r\n            const self = this;\r\n\r\n            self.inputLayouts = inputLayouts;\r\n\r\n            const xlrLayouts = getLayout({xlr: self});\r\n\r\n            console.log({xlrLayouts});\r\n        },\r\n\r\n        async prepareLayouts() {\r\n            const self = this;\r\n            // Get layouts\r\n            const xlrLayouts = getLayout({xlr: self});\r\n\r\n            self.currentLayoutId = xlrLayouts.current?.layoutId as ILayout['layoutId'];\r\n\r\n            const layoutsXlf = () => {\r\n                let xlf = [];\r\n\r\n                xlf.push(xlrLayouts.current);\r\n\r\n                if (xlrLayouts.current?.layoutId !== xlrLayouts.next?.layoutId) {\r\n                    xlf.push(xlrLayouts.next);\r\n                }\r\n\r\n                return xlf.reduce((coll: Promise<ILayout>[], item) => {\r\n                    return [\r\n                        ...coll,\r\n                        self.prepareLayoutXlf(item),\r\n                    ];\r\n                }, []);\r\n            };\r\n            const layouts = await Promise.all<Array<Promise<ILayout>>>(layoutsXlf());\r\n\r\n            return new Promise<IXlr>((resolve) => {\r\n                self.layouts = layouts;\r\n                self.currentLayout = self.layouts[0];\r\n\r\n                if (Boolean(self.layouts[1])) {\r\n                    self.nextLayout = self.layouts[1];\r\n                } else {\r\n                    // Use current layout as next layout if only one layout is available\r\n                    self.nextLayout = self.layouts[0];\r\n                }\r\n\r\n                self.currentLayoutIndex = xlrLayouts.currentLayoutIndex;\r\n                self.layouts[self.currentLayoutIndex] = self.currentLayout;\r\n\r\n                resolve(self);\r\n            });\r\n        },\r\n\r\n        async prepareLayoutXlf(inputLayout: ILayout) {\r\n            const self = this;\r\n            // Compose layout props first\r\n            let newOptions: OptionsType = Object.assign({}, platform);\r\n\r\n            newOptions = {\r\n                ...newOptions,\r\n                ...props.options,\r\n            };\r\n\r\n            if (self.config.platform ==='CMS' &&\r\n                inputLayout && Boolean(inputLayout.layoutId)\r\n            ) {\r\n                newOptions.xlfUrl =\r\n                    newOptions.xlfUrl.replace(':layoutId', String(inputLayout.layoutId));\r\n            } else if (self.config.platform === 'chromeOS') {\r\n                newOptions.xlfUrl = inputLayout.path as string;\r\n            }\r\n\r\n            let layoutXlf: string;\r\n            let layoutXlfNode: Document | null;\r\n            if (inputLayout && inputLayout.layoutNode === null) {\r\n                layoutXlf = await getXlf(newOptions);\r\n\r\n                const parser = new window.DOMParser();\r\n                layoutXlfNode = parser.parseFromString(layoutXlf as string, 'text/xml');\r\n            } else {\r\n                layoutXlfNode = inputLayout && inputLayout.layoutNode;\r\n            }\r\n\r\n            return new Promise<ILayout>((resolve) => {\r\n                const xlrLayoutObj = initialLayout;\r\n                \r\n                xlrLayoutObj.id = Number(inputLayout.layoutId);\r\n                xlrLayoutObj.layoutId = Number(inputLayout.layoutId);\r\n                xlrLayoutObj.options = newOptions;\r\n\r\n                resolve(Layout(layoutXlfNode, newOptions, self, xlrLayoutObj));\r\n            });\r\n        },\r\n    }\r\n\r\n    xlrObject.bootstrap();\r\n\r\n    return xlrObject;\r\n}\r\n","/*\r\n * Copyright (C) 2024 Xibo Signage Ltd\r\n *\r\n * Xibo - Digital Signage - https://www.xibosignage.com\r\n *\r\n * This file is part of Xibo.\r\n *\r\n * Xibo is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Lesser General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * any later version.\r\n *\r\n * Xibo is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU Lesser General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Lesser General Public License\r\n * along with Xibo.  If not, see <http://www.gnu.org/licenses/>.\r\n */\r\nimport './splash-screen.css';\r\nimport xiboLogoImg from './img/logo.png';\r\nimport loaderImg from './img/loader.gif';\r\nimport {OptionsType} from '../../Types/Layout';\r\n\r\nexport interface ISplashScreen {\r\n    init: () => void;\r\n    show: () => void;\r\n    hide: () => void;\r\n}\r\n\r\nexport interface PreviewSplashElement extends HTMLDivElement {\r\n    hide: () => void;\r\n}\r\n\r\nexport default function SplashScreen($parent: Element | null, config?: OptionsType): ISplashScreen {\r\n    const $previewSplash = document.createElement('div') as PreviewSplashElement;\r\n    const $previewLoader = document.createElement('div');\r\n    const $previewLoaderCaption = document.createElement('div');\r\n    const $defaultNoLayout = document.createElement('div');\r\n\r\n     const splashScreenObj = {\r\n         init() {\r\n             $previewSplash.classList.add('preview-splash');\r\n\r\n             // Don't show Xibo logo on CMS Preview\r\n             if (config && config.platform !== 'CMS') {\r\n                 $previewSplash.style.setProperty(\r\n                     'background-image',\r\n                     `url(${xiboLogoImg})`,\r\n                 );\r\n                 $previewSplash.style.setProperty(\r\n                     'background-size',\r\n                     '200px 120px',\r\n                 );\r\n                 $previewSplash.style.setProperty(\r\n                     'background-position',\r\n                     'bottom right',\r\n                 );\r\n             }\r\n\r\n             $previewSplash.constructor.prototype.hide = () => {\r\n                 this.hide();\r\n             };\r\n\r\n             $previewLoader.classList.add('preview-loader');\r\n             $previewLoaderCaption.classList.add('preview-loaderCaption');\r\n\r\n             // Show loader bar and text on CMS Preview\r\n             if (config && config.platform === 'CMS') {\r\n                 $previewLoader.style.setProperty(\r\n                     'background-image',\r\n                     `url(${loaderImg})`,\r\n                 );\r\n                 $previewLoaderCaption.innerHTML = '<p>Loading Layout...</p>';\r\n             }\r\n\r\n             $previewSplash.insertBefore($previewLoader, $previewSplash.lastElementChild);\r\n             $previewSplash.insertBefore($previewLoaderCaption, null);\r\n\r\n             this.hide();\r\n         },\r\n         show() {\r\n             if ($parent) {\r\n                 $parent.insertBefore($previewSplash, $parent.firstElementChild);\r\n                 $previewSplash.style.setProperty('display', 'block');\r\n             }\r\n         },\r\n         hide() {\r\n             $previewSplash.style.setProperty('display', 'none');\r\n         },\r\n    };\r\n\r\n     splashScreenObj.init();\r\n\r\n     return splashScreenObj;\r\n}\r\n"],"names":["createNanoEvents","emit","event","_len","arguments","length","args","Array","_key","i","callbacks","this","events","apply","on","cb","_this$events","_this","push","_this$events$event","filter","platform","getResourceUrl","xlfUrl","layoutBackgroundDownloadUrl","layoutPreviewUrl","libraryDownloadUrl","loaderUrl","idCounter","inPreview","appHost","initialLayout","id","layoutId","sw","sh","xw","xh","zIndex","scaleFactor","sWidth","sHeight","offsetX","offsetY","bgColor","bgImage","bgId","containerName","layoutNode","regionMaxZIndex","ready","regionObjects","drawer","allExpired","regions","actions","options","done","allEnded","path","prepareLayout","parseXlf","run","callback","regionExpired","end","regionEnded","stopAllMedia","Promise","resolve","nextId","getMediaId","_ref","mediaType","mediaId","capitalizeStr","inputStr","String","charAt","toUpperCase","substring","getDataBlob","_x","_getDataBlob","_asyncToGenerator","_regeneratorRuntime","mark","_callee","src","wrap","_context","prev","next","abrupt","fetch","mode","then","res","blob","rej","reader","FileReader","onloadend","result","onerror","readAsDataURL","stop","preloadMediaBlob","_x2","_x3","_preloadMediaBlob","_callee2","type","data","_context2","sent","Blob","arrayBuffer","audioFileType","filename","filenameArr","split","URL","createObjectURL","fetchJSON","_x4","_fetchJSON","_callee3","url","_context3","json","err","console","debug","str","validAudioTypes","mp3","wav","ogg","Boolean","initialRegion","layout","regionId","xml","mediaObjects","mediaObjectsActions","currentMedia","complete","ending","ended","oneMedia","oldMedia","undefined","curMedia","nxtMedia","currentMediaIndex","totalMediaObjects","index","prepareRegion","playNextMedia","transitionNodes","finished","exitTransition","exitTransitionComplete","prepareMediaObjects","initialMedia","region","html","iframe","iframeName","render","attachedAudio","singlePlay","timeoutId","setTimeout","checkIframeStatus","loadIframeOnRun","tempSrc","schemaVersion","duration","useDuration","fileId","uri","divWidth","divHeight","loop","init","defaultTrans","trans","keyframes","display","timing","fadeOutElem","opacity","fill","flyInElem","keyframeOptions","direction","flyInKeyframes","flyInTiming","from","_objectSpread","to","flyOutElem","flyOutKeyframes","flyOutTiming","transitionElement","transition","fadeIn","fadeOut","flyIn","flyOut","defaultIn","defaultOut","flyTransitionKeyframes","params","opacityAttr","source","top","concat","height","left","width","Media","xlr","props","mediaTimer","mediaTimeCount","emitter","mediaObject","startMediaTimer","media","setInterval","_media$emitter","$splashScreen","document","querySelector","style","hide","$videoMedia","getElementById","onloadstart","onloadeddata","readyState","oncanplay","videoPlayPromise","play","error","muted","onplaying","ondurationchange","onended","VideoMedia","$audioMedia","$playBtn","remove","audioPlayPromise","_$audioMedia$parentNo","name","createElement","classList","add","textContent","addEventListener","parentNode","insertBefore","nextSibling","AudioMedia","clearInterval","_self$xml","_self$xml2","_self$xml3","_self$xml4","_self$xml5","self","getAttribute","parseInt","$mediaIframe","mediaOptions","getElementsByTagName","_i","_Array$from","_mediaOptions","children","_i2","_Array$from2","mediaOption","nodeName","toLowerCase","showfullscreen","scrolling","cssText","$mediaId","$media","Audio","className","resourceUrlParams","config","regionOptions","tmpUrl","resourceUrl","replace","cmsUrl","composeResourceUrlByPlatform","align","valign","preload","mute","scaletype","objectFit","playsInline","autoplay","regex","RegExp","exec","transInDuration","Number","transinduration","fadeInTrans","animate","transInDirection","transindirection","defaultTransInOptions","transIn","transInName","showCurrentMedia","_ref2","isCMS","_self$emitter","getNewMedia","setProperty","t0","t1","t2","t3","t4","call","t5","t6","innerHTML","appendChild","iframeStyles","$region","lastElementChild","ELayoutType","playAgainClickHandle","ev","preventDefault","history","go","getXlf","_getXlf","layoutOptions","apiHost","fetchOptions","window","location","origin","headers","text","getLayout","activeLayout","_currentLayout2","layoutsInput","layoutIndexes","_currentLayout","_nextLayout","_params$xlr","inputLayouts","currentLayout","nextLayout","currLayoutIndx","currentLayoutIndex","hasLayout","nextLayoutIndex","nextLayoutTemp","reduce","a","b","indx","layouts","current","Layout","$layout","prepareLayouts","parent","playSchedules","layoutObject","$layoutContainer","_layout$layoutNode","_layout$layoutNode2","_layout$layoutNode3","_layout$layoutNode4","_layout$layoutNode5","_layout$layoutNode6","$screen","outline","offsetWidth","offsetHeight","firstElementChild","Math","min","round","abs","position","indexOf","bgImageUrl","composeBgUrlByPlatform","backgroundImage","backgroundRepeat","backgroundSize","backgroundPosition","backgroundColor","currentLayoutId","layoutRegions","forEach","regionXml","regionObj","regionObject","_self$xml6","_regionOptions","regionOption","regionMediaItems","mediaXml","mediaObj","nextMediaIndex","newMedia","transOutDuration","transOutDirection","transoutduration","transoutdirection","transOutName","defaultTransOutOptions","transOut","hideOldMedia","$oldMedia","oldMediaAnimate","removeOldMedia","_oldMediaAnimate","effect","updateTiming","isDone","_self$curMedia","_self$curMedia2","_self$curMedia3","_self$curMedia4","Region","_step","_iterator","_createForOfIteratorHelper","s","n","value","e","f","$end","$preview","firstChild","removeChild","_step2","_iterator2","j","exports","initialXlr","bootstrap","prepareLayoutXlf","inputLayout","updateLayouts","xlrObject","isArray","JSON","parse","stringify","_targetContainer","previewPlayer","previewScreen","endPlay","playAgainLink","previewCanvas","removeEventListener","body","$parent","$previewSplash","$previewLoader","$previewLoaderCaption","splashScreenObj","constructor","prototype","show","SplashScreen","_xlr$currentLayout$em","xlrLayouts","log","_this2","_xlrLayouts$current","layoutsXlf","_xlrLayouts$current2","_xlrLayouts$next","xlf","coll","item","_toConsumableArray","all","_this3","newOptions","layoutXlf","layoutXlfNode","parser","Object","assign","DOMParser","parseFromString","xlrLayoutObj"],"mappings":"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","x_google_ignoreList":[0]}