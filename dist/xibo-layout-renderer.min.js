function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
var XiboLayoutRenderer = function () {
  "use strict";

  function t(t, e) {
    var n = Object.keys(t);
    if (Object.getOwnPropertySymbols) {
      var o = Object.getOwnPropertySymbols(t);
      e && (o = o.filter(function (e) {
        return Object.getOwnPropertyDescriptor(t, e).enumerable;
      })), n.push.apply(n, o);
    }
    return n;
  }
  function e(e) {
    for (var n = 1; n < arguments.length; n++) {
      var o = null != arguments[n] ? arguments[n] : {};
      n % 2 ? t(Object(o), !0).forEach(function (t) {
        a(e, t, o[t]);
      }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(o)) : t(Object(o)).forEach(function (t) {
        Object.defineProperty(e, t, Object.getOwnPropertyDescriptor(o, t));
      });
    }
    return e;
  }
  function n() {
    n = function n() {
      return e;
    };
    var t,
      e = {},
      o = Object.prototype,
      r = o.hasOwnProperty,
      i = Object.defineProperty || function (t, e, n) {
        t[e] = n.value;
      },
      a = "function" == typeof Symbol ? Symbol : {},
      c = a.iterator || "@@iterator",
      l = a.asyncIterator || "@@asyncIterator",
      u = a.toStringTag || "@@toStringTag";
    function d(t, e, n) {
      return Object.defineProperty(t, e, {
        value: n,
        enumerable: !0,
        configurable: !0,
        writable: !0
      }), t[e];
    }
    try {
      d({}, "");
    } catch (t) {
      d = function d(t, e, n) {
        return t[e] = n;
      };
    }
    function s(t, e, n, o) {
      var r = e && e.prototype instanceof v ? e : v,
        a = Object.create(r.prototype),
        c = new C(o || []);
      return i(a, "_invoke", {
        value: O(t, n, c)
      }), a;
    }
    function f(t, e, n) {
      try {
        return {
          type: "normal",
          arg: t.call(e, n)
        };
      } catch (t) {
        return {
          type: "throw",
          arg: t
        };
      }
    }
    e.wrap = s;
    var p = "suspendedStart",
      y = "suspendedYield",
      m = "executing",
      h = "completed",
      g = {};
    function v() {}
    function x() {}
    function b() {}
    var w = {};
    d(w, c, function () {
      return this;
    });
    var I = Object.getPrototypeOf,
      E = I && I(I(j([])));
    E && E !== o && r.call(E, c) && (w = E);
    var k = b.prototype = v.prototype = Object.create(w);
    function L(t) {
      ["next", "throw", "return"].forEach(function (e) {
        d(t, e, function (t) {
          return this._invoke(e, t);
        });
      });
    }
    function N(t, e) {
      function n(o, i, a, c) {
        var l = f(t[o], t, i);
        if ("throw" !== l.type) {
          var u = l.arg,
            d = u.value;
          return d && "object" == _typeof(d) && r.call(d, "__await") ? e.resolve(d.__await).then(function (t) {
            n("next", t, a, c);
          }, function (t) {
            n("throw", t, a, c);
          }) : e.resolve(d).then(function (t) {
            u.value = t, a(u);
          }, function (t) {
            return n("throw", t, a, c);
          });
        }
        c(l.arg);
      }
      var o;
      i(this, "_invoke", {
        value: function value(t, r) {
          function i() {
            return new e(function (e, o) {
              n(t, r, e, o);
            });
          }
          return o = o ? o.then(i, i) : i();
        }
      });
    }
    function O(e, n, o) {
      var r = p;
      return function (i, a) {
        if (r === m) throw Error("Generator is already running");
        if (r === h) {
          if ("throw" === i) throw a;
          return {
            value: t,
            done: !0
          };
        }
        for (o.method = i, o.arg = a;;) {
          var c = o.delegate;
          if (c) {
            var l = T(c, o);
            if (l) {
              if (l === g) continue;
              return l;
            }
          }
          if ("next" === o.method) o.sent = o._sent = o.arg;else if ("throw" === o.method) {
            if (r === p) throw r = h, o.arg;
            o.dispatchException(o.arg);
          } else "return" === o.method && o.abrupt("return", o.arg);
          r = m;
          var u = f(e, n, o);
          if ("normal" === u.type) {
            if (r = o.done ? h : y, u.arg === g) continue;
            return {
              value: u.arg,
              done: o.done
            };
          }
          "throw" === u.type && (r = h, o.method = "throw", o.arg = u.arg);
        }
      };
    }
    function T(e, n) {
      var o = n.method,
        r = e.iterator[o];
      if (r === t) return n.delegate = null, "throw" === o && e.iterator["return"] && (n.method = "return", n.arg = t, T(e, n), "throw" === n.method) || "return" !== o && (n.method = "throw", n.arg = new TypeError("The iterator does not provide a '" + o + "' method")), g;
      var i = f(r, e.iterator, n.arg);
      if ("throw" === i.type) return n.method = "throw", n.arg = i.arg, n.delegate = null, g;
      var a = i.arg;
      return a ? a.done ? (n[e.resultName] = a.value, n.next = e.nextLoc, "return" !== n.method && (n.method = "next", n.arg = t), n.delegate = null, g) : a : (n.method = "throw", n.arg = new TypeError("iterator result is not an object"), n.delegate = null, g);
    }
    function M(t) {
      var e = {
        tryLoc: t[0]
      };
      1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e);
    }
    function S(t) {
      var e = t.completion || {};
      e.type = "normal", delete e.arg, t.completion = e;
    }
    function C(t) {
      this.tryEntries = [{
        tryLoc: "root"
      }], t.forEach(M, this), this.reset(!0);
    }
    function j(e) {
      if (e || "" === e) {
        var n = e[c];
        if (n) return n.call(e);
        if ("function" == typeof e.next) return e;
        if (!isNaN(e.length)) {
          var o = -1,
            i = function n() {
              for (; ++o < e.length;) if (r.call(e, o)) return n.value = e[o], n.done = !1, n;
              return n.value = t, n.done = !0, n;
            };
          return i.next = i;
        }
      }
      throw new TypeError(_typeof(e) + " is not iterable");
    }
    return x.prototype = b, i(k, "constructor", {
      value: b,
      configurable: !0
    }), i(b, "constructor", {
      value: x,
      configurable: !0
    }), x.displayName = d(b, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) {
      var e = "function" == typeof t && t.constructor;
      return !!e && (e === x || "GeneratorFunction" === (e.displayName || e.name));
    }, e.mark = function (t) {
      return Object.setPrototypeOf ? Object.setPrototypeOf(t, b) : (t.__proto__ = b, d(t, u, "GeneratorFunction")), t.prototype = Object.create(k), t;
    }, e.awrap = function (t) {
      return {
        __await: t
      };
    }, L(N.prototype), d(N.prototype, l, function () {
      return this;
    }), e.AsyncIterator = N, e.async = function (t, n, o, r, i) {
      void 0 === i && (i = Promise);
      var a = new N(s(t, n, o, r), i);
      return e.isGeneratorFunction(n) ? a : a.next().then(function (t) {
        return t.done ? t.value : a.next();
      });
    }, L(k), d(k, u, "Generator"), d(k, c, function () {
      return this;
    }), d(k, "toString", function () {
      return "[object Generator]";
    }), e.keys = function (t) {
      var e = Object(t),
        n = [];
      for (var o in e) n.push(o);
      return n.reverse(), function t() {
        for (; n.length;) {
          var o = n.pop();
          if (o in e) return t.value = o, t.done = !1, t;
        }
        return t.done = !0, t;
      };
    }, e.values = j, C.prototype = {
      constructor: C,
      reset: function reset(e) {
        if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(S), !e) for (var n in this) "t" === n.charAt(0) && r.call(this, n) && !isNaN(+n.slice(1)) && (this[n] = t);
      },
      stop: function stop() {
        this.done = !0;
        var t = this.tryEntries[0].completion;
        if ("throw" === t.type) throw t.arg;
        return this.rval;
      },
      dispatchException: function dispatchException(e) {
        if (this.done) throw e;
        var n = this;
        function o(o, r) {
          return c.type = "throw", c.arg = e, n.next = o, r && (n.method = "next", n.arg = t), !!r;
        }
        for (var i = this.tryEntries.length - 1; i >= 0; --i) {
          var a = this.tryEntries[i],
            c = a.completion;
          if ("root" === a.tryLoc) return o("end");
          if (a.tryLoc <= this.prev) {
            var l = r.call(a, "catchLoc"),
              u = r.call(a, "finallyLoc");
            if (l && u) {
              if (this.prev < a.catchLoc) return o(a.catchLoc, !0);
              if (this.prev < a.finallyLoc) return o(a.finallyLoc);
            } else if (l) {
              if (this.prev < a.catchLoc) return o(a.catchLoc, !0);
            } else {
              if (!u) throw Error("try statement without catch or finally");
              if (this.prev < a.finallyLoc) return o(a.finallyLoc);
            }
          }
        }
      },
      abrupt: function abrupt(t, e) {
        for (var n = this.tryEntries.length - 1; n >= 0; --n) {
          var o = this.tryEntries[n];
          if (o.tryLoc <= this.prev && r.call(o, "finallyLoc") && this.prev < o.finallyLoc) {
            var i = o;
            break;
          }
        }
        i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null);
        var a = i ? i.completion : {};
        return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, g) : this.complete(a);
      },
      complete: function complete(t, e) {
        if ("throw" === t.type) throw t.arg;
        return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), g;
      },
      finish: function finish(t) {
        for (var e = this.tryEntries.length - 1; e >= 0; --e) {
          var n = this.tryEntries[e];
          if (n.finallyLoc === t) return this.complete(n.completion, n.afterLoc), S(n), g;
        }
      },
      "catch": function _catch(t) {
        for (var e = this.tryEntries.length - 1; e >= 0; --e) {
          var n = this.tryEntries[e];
          if (n.tryLoc === t) {
            var o = n.completion;
            if ("throw" === o.type) {
              var r = o.arg;
              S(n);
            }
            return r;
          }
        }
        throw Error("illegal catch attempt");
      },
      delegateYield: function delegateYield(e, n, o) {
        return this.delegate = {
          iterator: j(e),
          resultName: n,
          nextLoc: o
        }, "next" === this.method && (this.arg = t), g;
      }
    }, e;
  }
  function o(t) {
    var e = function (t, e) {
      if ("object" != _typeof(t) || !t) return t;
      var n = t[Symbol.toPrimitive];
      if (void 0 !== n) {
        var o = n.call(t, e || "default");
        if ("object" != _typeof(o)) return o;
        throw new TypeError("@@toPrimitive must return a primitive value.");
      }
      return ("string" === e ? String : Number)(t);
    }(t, "string");
    return "symbol" == _typeof(e) ? e : e + "";
  }
  function r(t, e, n, o, r, i, a) {
    try {
      var c = t[i](a),
        l = c.value;
    } catch (t) {
      return void n(t);
    }
    c.done ? e(l) : Promise.resolve(l).then(o, r);
  }
  function i(t) {
    return function () {
      var e = this,
        n = arguments;
      return new Promise(function (o, i) {
        var a = t.apply(e, n);
        function c(t) {
          r(a, o, i, c, l, "next", t);
        }
        function l(t) {
          r(a, o, i, c, l, "throw", t);
        }
        c(void 0);
      });
    };
  }
  function a(t, e, n) {
    return (e = o(e)) in t ? Object.defineProperty(t, e, {
      value: n,
      enumerable: !0,
      configurable: !0,
      writable: !0
    }) : t[e] = n, t;
  }
  function c(t) {
    return function (t) {
      if (Array.isArray(t)) return u(t);
    }(t) || function (t) {
      if ("undefined" != typeof Symbol && null != t[Symbol.iterator] || null != t["@@iterator"]) return Array.from(t);
    }(t) || l(t) || function () {
      throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
    }();
  }
  function l(t, e) {
    if (t) {
      if ("string" == typeof t) return u(t, e);
      var n = Object.prototype.toString.call(t).slice(8, -1);
      return "Object" === n && t.constructor && (n = t.constructor.name), "Map" === n || "Set" === n ? Array.from(t) : "Arguments" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n) ? u(t, e) : void 0;
    }
  }
  function u(t, e) {
    (null == e || e > t.length) && (e = t.length);
    for (var n = 0, o = new Array(e); n < e; n++) o[n] = t[n];
    return o;
  }
  function d(t, e) {
    var _n = "undefined" != typeof Symbol && t[Symbol.iterator] || t["@@iterator"];
    if (!_n) {
      if (Array.isArray(t) || (_n = l(t)) || e) {
        _n && (t = _n);
        var o = 0,
          r = function r() {};
        return {
          s: r,
          n: function n() {
            return o >= t.length ? {
              done: !0
            } : {
              done: !1,
              value: t[o++]
            };
          },
          e: function e(t) {
            throw t;
          },
          f: r
        };
      }
      throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
    }
    var i,
      a = !0,
      c = !1;
    return {
      s: function s() {
        _n = _n.call(t);
      },
      n: function n() {
        var t = _n.next();
        return a = t.done, t;
      },
      e: function e(t) {
        c = !0, i = t;
      },
      f: function f() {
        try {
          a || null == _n["return"] || _n["return"]();
        } finally {
          if (c) throw i;
        }
      }
    };
  }
  var s = function s() {
      return {
        emit: function emit(t) {
          for (var e = arguments.length, n = new Array(e > 1 ? e - 1 : 0), o = 1; o < e; o++) n[o - 1] = arguments[o];
          for (var r = 0, i = this.events[t] || [], a = i.length; r < a; r++) i[r].apply(i, n);
        },
        events: {},
        on: function on(t, e) {
          var n,
            o = this;
          return ((n = this.events)[t] || (n[t] = [])).push(e), function () {
            var n;
            o.events[t] = null === (n = o.events[t]) || void 0 === n ? void 0 : n.filter(function (t) {
              return e !== t;
            });
          };
        }
      };
    },
    f = {
      getResourceUrl: "/playlist/widget/resource/:regionId/:id",
      xlfUrl: "/layout/xlf/:layoutId",
      layoutBackgroundDownloadUrl: "/layout/background/:id",
      layoutPreviewUrl: "/layout/preview/[layoutCode]",
      libraryDownloadUrl: "/library/download/:id",
      loaderUrl: "/theme/default/img/loader.gif",
      idCounter: 0,
      inPreview: !0,
      appHost: null,
      platform: "CMS"
    },
    p = {
      id: null,
      layoutId: null,
      sw: 0,
      sh: 0,
      xw: 0,
      xh: 0,
      zIndex: 0,
      scaleFactor: 1,
      sWidth: 0,
      sHeight: 0,
      offsetX: 0,
      offsetY: 0,
      bgColor: "",
      bgImage: "",
      bgId: "",
      containerName: "",
      layoutNode: null,
      regionMaxZIndex: 0,
      ready: !1,
      regionObjects: [],
      drawer: [],
      allExpired: !1,
      regions: [],
      actions: [],
      options: f,
      done: !1,
      allEnded: !1,
      path: "",
      prepareLayout: function prepareLayout() {},
      parseXlf: function parseXlf() {},
      run: function run() {},
      on: function on(t, e) {
        return {};
      },
      regionExpired: function regionExpired() {},
      end: function end() {},
      regionEnded: function regionEnded() {},
      stopAllMedia: function stopAllMedia() {
        return Promise.resolve();
      }
    };
  function y(t) {
    return t.idCounter > 500 && (t.idCounter = 0), t.idCounter = t.idCounter + 1, t.idCounter;
  }
  var m = function m(t) {
      var e = t.mediaType,
        n = t.containerName;
      return "video" === e ? n += "-vid" : "audio" === e && (n += "-aud"), n;
    },
    h = function h(t) {
      return null === t ? "" : String(t).charAt(0).toUpperCase() + String(t).substring(1);
    };
  function g(t) {
    return v.apply(this, arguments);
  }
  function v() {
    return (v = i(n().mark(function t(e) {
      return n().wrap(function (t) {
        for (;;) switch (t.prev = t.next) {
          case 0:
            return t.abrupt("return", fetch(e, {
              mode: "no-cors"
            }).then(function (t) {
              return t.blob();
            }).then(function (t) {
              return new Promise(function (e, n) {
                var o = new FileReader();
                o.onloadend = function () {
                  return e(o.result);
                }, o.onerror = n, o.readAsDataURL(t);
              });
            }));
          case 1:
          case "end":
            return t.stop();
        }
      }, t);
    }))).apply(this, arguments);
  }
  function x(t, e) {
    return b.apply(this, arguments);
  }
  function b() {
    return (b = i(n().mark(function t(e, o) {
      var r, i, a;
      return n().wrap(function (t) {
        for (;;) switch (t.prev = t.next) {
          case 0:
            return t.next = 2, fetch(e, {
              mode: "no-cors"
            });
          case 2:
            if (r = t.sent, i = new Blob(), "image" !== o) {
              t.next = 8;
              break;
            }
            i = new Blob(), t.next = 19;
            break;
          case 8:
            if ("video" !== o) {
              t.next = 14;
              break;
            }
            return t.next = 11, r.blob();
          case 11:
            i = t.sent, t.next = 19;
            break;
          case 14:
            if ("audio" !== o) {
              t.next = 19;
              break;
            }
            return t.next = 17, r.arrayBuffer();
          case 17:
            a = t.sent, i = new Blob([a], {
              type: E((n = e, c = void 0, c = String(n).split("."), c[c.length - 1]))
            });
          case 19:
            return console.log({
              blob: i
            }), t.abrupt("return", URL.createObjectURL(i));
          case 21:
          case "end":
            return t.stop();
        }
        var n, c;
      }, t);
    }))).apply(this, arguments);
  }
  function w(t) {
    return I.apply(this, arguments);
  }
  function I() {
    return (I = i(n().mark(function t(e) {
      return n().wrap(function (t) {
        for (;;) switch (t.prev = t.next) {
          case 0:
            return t.abrupt("return", fetch(e).then(function (t) {
              return t.json();
            })["catch"](function (t) {
              console.log(t);
            }));
          case 1:
          case "end":
            return t.stop();
        }
      }, t);
    }))).apply(this, arguments);
  }
  function E(t) {
    var e = {
      mp3: "audio/mp3",
      wav: "audio/wav",
      ogg: "audio/ogg"
    };
    if (Boolean(e[t])) return e[t];
  }
  var k = {
      layout: p,
      id: "",
      regionId: "",
      xml: null,
      mediaObjects: [],
      mediaObjectsActions: [],
      currentMedia: -1,
      complete: !1,
      containerName: "",
      ending: !1,
      ended: !1,
      oneMedia: !1,
      oldMedia: void 0,
      curMedia: void 0,
      nxtMedia: void 0,
      currentMediaIndex: 0,
      totalMediaObjects: 0,
      ready: !1,
      options: {},
      sWidth: 0,
      sHeight: 0,
      offsetX: 0,
      offsetY: 0,
      zIndex: 0,
      index: -1,
      prepareRegion: function prepareRegion() {},
      playNextMedia: function playNextMedia() {},
      transitionNodes: function transitionNodes() {},
      finished: function finished() {},
      run: function run() {},
      end: function end() {},
      exitTransition: function exitTransition() {},
      exitTransitionComplete: function exitTransitionComplete() {},
      on: function on(t, e) {
        return {};
      },
      prepareMediaObjects: function prepareMediaObjects() {}
    },
    L = {
      region: k,
      xml: null,
      id: "",
      index: 0,
      idCounter: 0,
      containerName: "",
      html: null,
      iframe: null,
      iframeName: "",
      mediaType: "",
      render: "html",
      attachedAudio: !1,
      singlePlay: !1,
      timeoutId: setTimeout(function () {}, 100),
      ready: !0,
      checkIframeStatus: !1,
      loadIframeOnRun: !1,
      tempSrc: "",
      finished: !1,
      schemaVersion: "1",
      type: "",
      duration: 0,
      useDuration: Boolean(0),
      fileId: "",
      uri: "",
      options: {},
      divWidth: 0,
      divHeight: 0,
      url: null,
      loop: !1,
      run: function run() {},
      init: function init() {},
      stop: function stop() {
        return Promise.resolve();
      },
      on: function on(t, e) {
        return {};
      }
    },
    N = function N(t, e) {
      return {
        keyframes: [{
          display: "in" === e ? "none" : "block"
        }, {
          display: "out" === e ? "none" : "block"
        }],
        timing: {
          duration: t
        }
      };
    },
    O = function O(t) {
      return {
        keyframes: [{
          opacity: 1
        }, {
          opacity: 0,
          zIndex: -1
        }],
        timing: {
          duration: t,
          fill: "forwards"
        }
      };
    },
    T = function T(t, n, o) {
      var r = [{
          opacity: 0
        }, {
          opacity: 1,
          zIndex: 1
        }],
        i = {
          duration: t,
          fill: "forwards"
        };
      return n && Boolean(n.from) && (r[0] = e(e({}, n.from), r[0])), n && Boolean(n.to) && (r[1] = e(e({}, n.to), r[1])), {
        keyframes: r,
        timing: i
      };
    },
    M = function M(t, n, o) {
      var r = [{
          opacity: 1
        }, {
          opacity: 0,
          zIndex: -1
        }],
        i = {
          duration: t,
          fill: "forwards"
        };
      return n && Boolean(n.from) && (r[0] = e(e({}, n.from), r[0])), n && Boolean(n.to) && (r[1] = e(e({}, n.to), r[1])), {
        keyframes: r,
        timing: i
      };
    },
    S = function S(t, e) {
      var n;
      return {
        fadeIn: (n = e.duration, {
          keyframes: [{
            opacity: 0
          }, {
            opacity: 1
          }],
          timing: {
            duration: n,
            fill: "forwards"
          }
        }),
        fadeOut: O(e.duration),
        flyIn: T(e.duration, e.keyframes, e.direction),
        flyOut: M(e.duration, e.keyframes, e.direction),
        defaultIn: N(e.duration, "in"),
        defaultOut: N(e.duration, "out")
      }[t];
    },
    C = function C(t) {
      var e = {
          from: {},
          to: {}
        },
        n = function n(e) {
          return "from" === e ? "in" === t.trans ? 0 : 1 : "out" === t.trans ? 1 : 0;
        };
      switch (t.direction) {
        case "N":
        default:
          e.from = {
            opacity: n("from"),
            top: "in" === t.trans ? "".concat(t.height, "px") : 0
          }, e.to = {
            opacity: n("to"),
            top: "in" === t.trans ? 0 : "-".concat(t.height, "px")
          };
          break;
        case "NE":
          e.from = {
            opacity: n("from"),
            top: "in" === t.trans ? "".concat(t.height, "px") : 0,
            left: "in" === t.trans ? "-".concat(t.width, "px") : 0
          }, e.to = {
            opacity: n("to"),
            top: "in" === t.trans ? 0 : "-".concat(t.height, "px"),
            left: "in" === t.trans ? 0 : "".concat(t.width, "px")
          };
          break;
        case "E":
          e.from = {
            opacity: n("from"),
            left: "in" === t.trans ? "-".concat(t.width, "px") : 0
          }, e.to = {
            opacity: n("to"),
            left: "in" === t.trans ? 0 : "".concat(t.width, "px")
          };
          break;
        case "SE":
          e.from = {
            opacity: n("from"),
            top: "in" === t.trans ? "-".concat(t.height, "px") : 0,
            left: "in" === t.trans ? "-".concat(t.width, "px") : 0
          }, e.to = {
            opacity: n("to"),
            top: "in" === t.trans ? 0 : "".concat(t.height, "px"),
            left: "in" === t.trans ? 0 : "".concat(t.width, "px")
          };
          break;
        case "S":
          e.from = {
            opacity: n("from"),
            top: "in" === t.trans ? "-".concat(t.height, "px") : 0
          }, e.to = {
            opacity: n("to"),
            top: "in" === t.trans ? 0 : "".concat(t.height, "px")
          };
          break;
        case "SW":
          e.from = {
            opacity: n("from"),
            top: "in" === t.trans ? "-".concat(t.height, "px") : 0,
            left: "in" === t.trans ? "".concat(t.width, "px") : 0
          }, e.to = {
            opacity: n("to"),
            top: "in" === t.trans ? 0 : "".concat(t.height, "px"),
            left: "in" === t.trans ? 0 : "-".concat(t.width, "px")
          };
          break;
        case "W":
          e.from = {
            opacity: n("from"),
            left: "in" === t.trans ? "".concat(t.width, "px") : 0
          }, e.to = {
            opacity: n("to"),
            left: "in" === t.trans ? 0 : "-".concat(t.width, "px")
          };
          break;
        case "NW":
          e.from = {
            opacity: n("from"),
            top: "in" === t.trans ? "".concat(t.height, "px") : 0,
            left: "in" === t.trans ? "".concat(t.width, "px") : 0
          }, e.to = {
            opacity: n("to"),
            top: "in" === t.trans ? 0 : "-".concat(t.height, "px"),
            left: "in" === t.trans ? 0 : "-".concat(t.width, "px")
          };
      }
      return e;
    };
  function j(t, o, r, a, c) {
    var l = {
        region: t,
        mediaId: o,
        xml: r,
        options: a
      },
      u = null,
      d = 0,
      f = s(),
      p = e(e({}, L), l),
      v = function v(t) {
        u = setInterval(function () {
          var e;
          ++d > t.duration && (null === (e = t.emitter) || void 0 === e || e.emit("end", t));
        }, 1e3), console.log("Showing Media " + t.id + " for " + t.duration + "s of Region " + t.region.regionId);
      };
    return f.on("start", function (t) {
      "video" === t.mediaType ? (function (t) {
        return {
          init: function init() {
            var e = document.getElementById(m(t));
            e && (e.onloadstart = function () {
              console.log("".concat(h(t.mediaType), " for media > ").concat(t.id, " has started loading data . . ."));
            }, e.onloadeddata = function () {
              e.readyState >= 2 && console.log("".concat(h(t.mediaType), " data for media > ").concat(t.id, " has been fully loaded . . ."));
            }, e.oncanplay = function () {
              console.log("".concat(h(t.mediaType), " for media > ").concat(t.id, " can be played . . ."));
              var n = e.play();
              void 0 !== n && n.then(function () {
                console.log("autoplay started . . .");
              })["catch"](function (t) {
                e.muted = !0, e.play();
              });
            }, e.onplaying = function () {
              console.log("".concat(h(t.mediaType), " for media > ").concat(t.id, " is now playing . . ."));
            }, 0 === t.duration && (e.ondurationchange = function () {
              console.log("Showing Media " + t.id + " for " + e.duration + "s of Region " + t.region.regionId);
            }, e.onended = function () {
              var e;
              console.log("".concat(h(t.mediaType), " for media > ").concat(t.id, " has ended playing . . .")), null === (e = t.emitter) || void 0 === e || e.emit("end", t);
            }));
          }
        };
      }(t).init(), t.duration > 0 && v(t)) : "audio" === t.mediaType ? (function (t) {
        return {
          init: function init() {
            var e = document.getElementById(m(t)),
              n = null;
            if (e) {
              e.onloadstart = function () {
                console.log("".concat(h(t.mediaType), " for media > ").concat(t.id, " has started loading data . . ."));
              }, e.onloadeddata = function () {
                e.readyState >= 2 && console.log("".concat(h(t.mediaType), " data for media > ").concat(t.id, " has been fully loaded . . ."));
              }, e.oncanplay = function () {
                console.log("".concat(h(t.mediaType), " for media > ").concat(t.id, " can be played . . ."));
              }, e.onplaying = function () {
                console.log("".concat(h(t.mediaType), " for media > ").concat(t.id, " is now playing . . .")), null !== n && n.remove();
              };
              var o = e.play();
              void 0 !== o && o.then(function () {
                console.log("autoplay started . . .");
              })["catch"](function (t) {
                var o;
                "NotAllowedError" === t.name && ((n = document.createElement("button")).classList.add("play-audio-btn"), n.textContent = "Play Audio", n.addEventListener("click", function () {
                  e.muted = !1, e.play();
                }), null === (o = e.parentNode) || void 0 === o || o.insertBefore(n, e.nextSibling));
              }), 0 === t.duration && (e.ondurationchange = function () {
                console.log("Showing Media " + t.id + " for " + e.duration + "s of Region " + t.region.regionId);
              }, e.onended = function () {
                var e;
                console.log("".concat(h(t.mediaType), " for media > ").concat(t.id, " has ended playing . . .")), null === (e = t.emitter) || void 0 === e || e.emit("end", t);
              });
            }
          }
        };
      }(t).init(), t.duration > 0 && v(t)) : v(t);
    }), f.on("end", function (t) {
      u && (clearInterval(u), d = 0), t.region.playNextMedia();
    }), p.init = function () {
      var t,
        r,
        a,
        u,
        d,
        s = p;
      s.id = l.mediaId, s.fileId = (null === (t = s.xml) || void 0 === t ? void 0 : t.getAttribute("fileId")) || "", s.idCounter = y(l.options), s.containerName = "M-".concat(s.id, "-").concat(s.idCounter), s.iframeName = "".concat(s.containerName, "-iframe"), s.mediaType = (null === (r = s.xml) || void 0 === r ? void 0 : r.getAttribute("type")) || "", s.render = (null === (a = s.xml) || void 0 === a ? void 0 : a.getAttribute("render")) || "", s.duration = parseInt(null === (u = s.xml) || void 0 === u ? void 0 : u.getAttribute("duration")) || 0, s.options = e(e({}, l.options), {}, {
        mediaId: o
      });
      var f = document.createElement("iframe"),
        h = null === (d = s.xml) || void 0 === d ? void 0 : d.getElementsByTagName("options");
      if (h) for (var g = 0, v = Array.from(h); g < v.length; g++) for (var x = v[g].children, b = 0, I = Array.from(x); b < I.length; b++) {
        var E = I[b];
        s.options[E.nodeName.toLowerCase()] = E.textContent;
      }
      Boolean(s.options.uri) && (s.uri = s.options.uri), "1" === s.options.showfullscreen ? (s.divWidth = s.region.layout.sWidth, s.divHeight = s.region.layout.sHeight) : (s.divWidth = s.region.sWidth, s.divHeight = s.region.sHeight), f.scrolling = "no", f.id = s.iframeName, f.width = "".concat(s.divWidth, "px"), f.height = "".concat(s.divHeight, "px"), f.style.cssText = "border: 0; visibility: hidden;";
      var k = m(s),
        L = document.getElementById(k);
      null === L && ((L = "video" === s.mediaType ? document.createElement("video") : "audio" === s.mediaType ? new Audio() : document.createElement("div")).id = k), L.className = "media--item", L.style.cssText = "\n            display: none;\n            width: ".concat(s.divWidth, "px;\n            height: ").concat(s.divHeight, "px;\n            position: absolute;\n            background-size: contain;\n            background-repeat: no-repeat;\n            background-position: center;\n        "), document.getElementById("".concat(s.region.containerName));
      var N = e(e({}, c.config.config), {}, {
        regionOptions: s.region.options,
        layoutId: s.region.layout.layoutId,
        regionId: s.region.id,
        mediaId: s.id,
        fileId: s.fileId,
        scaleFactor: s.region.layout.scaleFactor,
        uri: s.uri
      });
      "image" !== s.mediaType && "video" !== s.mediaType || (N.mediaType = s.mediaType);
      var O = function (t, e) {
        var n = e.regionOptions.getResourceUrl.replace(":regionId", e.regionId).replace(":id", e.mediaId) + "?preview=1&layoutPreview=1";
        return "chromeOS" === t ? n = e.cmsUrl + "/chromeOS/resource/" + e.fileId + "?saveAs=" + e.uri : Boolean(e.mediaType) || (n += "&scale_override=" + e.scaleFactor), n;
      }(c.config.platform, N);
      if (s.url = O, s.loop = "1" == s.options.loop || "1" == s.region.options.loop && 1 == s.region.totalMediaObjects, f.src = "".concat(O, "&width=").concat(s.divWidth, "&height=").concat(s.divHeight), "html" === s.render || "ticker" === s.mediaType || "webpage" === s.mediaType) s.checkIframeStatus = !0, s.iframe = f;else if ("image" === s.mediaType) {
        if ("stretch" === s.options.scaletype) L.style.cssText = L.style.cssText.concat("background-size: 100% 100%;");else if ("fit" === s.options.scaletype) L.style.cssText = L.style.cssText.concat("background-size: cover;");else {
          var T = "" == s.options.align ? "center" : s.options.align,
            M = "" == s.options.valign || "middle" == s.options.valign ? "center" : s.options.valign;
          L.style.cssText = L.style.cssText.concat("background-position: ".concat(T, " ").concat(M));
        }
      } else if ("video" === s.mediaType) {
        var C = L;
        C.preload = "auto", C.textContent = "Unsupported Video", Boolean(s.options.mute) && (C.muted = "1" === s.options.mute), Boolean(s.options.scaletype) && "stretch" === s.options.scaletype && (C.style.objectFit = "fill"), C.playsInline = !0, s.loop && (C.loop = !0), L = C;
      } else if ("audio" === s.mediaType) {
        var j = L;
        j.preload = "auto", j.textContent = "Unsupported Audio", j.autoplay = !0, s.loop && (j.loop = !0), L = j;
      }
      if (("html" === s.render || "ticker" === s.mediaType) && "1" === s.options.durationisperitem) {
        var B = new RegExp("\x3c!-- NUMITEMS=(.*?) --\x3e");
        i(n().mark(function t() {
          var e, o;
          return n().wrap(function (t) {
            for (;;) switch (t.prev = t.next) {
              case 0:
                return t.next = 2, w("".concat(O, "&width=").concat(s.divWidth, "&height=").concat(s.divHeight));
              case 2:
                e = t.sent, console.log({
                  html: e
                }), null !== (o = B.exec(e)) && (s.duration = parseInt(String(s.duration)) * parseInt(o[1]));
              case 6:
              case "end":
                return t.stop();
            }
          }, t);
        }))();
      }
      if (Boolean(s.options.transin) && Boolean(s.options.transinduration)) {
        var A = Number(s.options.transinduration),
          P = S("fadeIn", {
            duration: A
          });
        L.animate(P.keyframes, P.timing);
      }
      s.html = L;
    }, p.run = function () {
      var t = p,
        e = 1,
        o = "E";
      Boolean(t.options.transinduration) && (e = Number(t.options.transinduration)), Boolean(t.options.transindirection) && (o = t.options.transindirection);
      var r = {
          duration: e
        },
        a = S("defaultIn", {
          duration: r.duration
        });
      if (Boolean(t.options.transin)) {
        var l = t.options.transin;
        "fly" === l && (l = "".concat(l, "In"), r.keyframes = C({
          trans: "in",
          direction: o,
          height: t.divHeight,
          width: t.divWidth
        })), a = S(l, r);
      }
      var u = function () {
          var e = i(n().mark(function e() {
            var o, r, i, l;
            return n().wrap(function (e) {
              for (;;) switch (e.prev = e.next) {
                case 0:
                  if (o = m(t), r = document.getElementById(o), i = "CMS" === c.config.platform, null === r && (r = d()), null === r) {
                    e.next = 46;
                    break;
                  }
                  if (r.style.setProperty("display", "block"), Boolean(t.options.transin) && r.animate(a.keyframes, a.timing), "image" !== t.mediaType || null === t.url) {
                    e.next = 22;
                    break;
                  }
                  if (e.t0 = r.style, e.t1 = "url(", i) {
                    e.next = 14;
                    break;
                  }
                  e.t2 = t.url, e.next = 17;
                  break;
                case 14:
                  return e.next = 16, g(t.url);
                case 16:
                  e.t2 = e.sent;
                case 17:
                  e.t3 = e.t2, e.t4 = e.t1.concat.call(e.t1, e.t3), e.t0.setProperty.call(e.t0, "background-image", e.t4), e.next = 45;
                  break;
                case 22:
                  if ("video" !== t.mediaType || null === t.url) {
                    e.next = 33;
                    break;
                  }
                  if (!i) {
                    e.next = 29;
                    break;
                  }
                  return e.next = 26, x(t.url, t.mediaType);
                case 26:
                  e.t5 = e.sent, e.next = 30;
                  break;
                case 29:
                  e.t5 = t.url;
                case 30:
                  r.src = e.t5, e.next = 45;
                  break;
                case 33:
                  if ("audio" !== t.mediaType || null === t.url) {
                    e.next = 44;
                    break;
                  }
                  if (!i) {
                    e.next = 40;
                    break;
                  }
                  return e.next = 37, x(t.url, t.mediaType);
                case 37:
                  e.t6 = e.sent, e.next = 41;
                  break;
                case 40:
                  e.t6 = t.url;
                case 41:
                  r.src = e.t6, e.next = 45;
                  break;
                case 44:
                  ("html" === t.render || "webpage" === t.mediaType) && t.iframe && t.checkIframeStatus && (t.ready = !1, r.innerHTML = "", r.appendChild(t.iframe), t.iframe && t.iframe.addEventListener("load", function () {
                    if (t.ready = !0, t.iframe) {
                      var e = t.iframe.style.cssText;
                      t.iframe.style.cssText = null == e ? void 0 : e.concat("visibility: visible;");
                    }
                  }));
                case 45:
                  null === (l = t.emitter) || void 0 === l || l.emit("start", t);
                case 46:
                case "end":
                  return e.stop();
              }
            }, e);
          }));
          return function () {
            return e.apply(this, arguments);
          };
        }(),
        d = function d() {
          var e = document.getElementById("".concat(t.region.containerName));
          return t.region.complete && !t.region.layout.allEnded ? (e && e.insertBefore(t.html, e.lastElementChild), t.html) : null;
        };
      u();
    }, p.stop = i(n().mark(function t() {
      var e, o;
      return n().wrap(function (t) {
        for (;;) switch (t.prev = t.next) {
          case 0:
            e = p, (o = document.getElementById(m(e))) && (o.style.display = "none", o.remove());
          case 3:
          case "end":
            return t.stop();
        }
      }, t);
    })), p.on = function (t, e) {
      return f.on(t, e);
    }, p.emitter = f, p.init(), p;
  }
  var B,
    A = function A(t) {
      t.preventDefault(), history.go(0);
    };
  function P(t) {
    return R.apply(this, arguments);
  }
  function R() {
    return (R = i(n().mark(function t(e) {
      var o, r, i, a;
      return n().wrap(function (t) {
        for (;;) switch (t.prev = t.next) {
          case 0:
            return o = window.location.origin, r = o + e.xlfUrl, i = {}, "CMS" === e.platform ? (r = o + e.xlfUrl, i.mode = "no-cors") : "chromeOS" === e.platform ? (r = e.xlfUrl, i.mode = "cors", i.headers = {
              "Content-Type": "text/xml"
            }) : "CMS" !== e.platform && null !== e.appHost && (r = e.appHost + e.xlfUrl), t.next = 6, fetch(r);
          case 6:
            return a = t.sent, t.next = 9, a.text();
          case 9:
            return t.abrupt("return", t.sent);
          case 10:
          case "end":
            return t.stop();
        }
      }, t);
    }))).apply(this, arguments);
  }
  function _(t) {
    var n,
      o,
      r,
      i,
      a,
      c = void 0,
      l = void 0,
      u = t.xlr,
      d = u.inputLayouts,
      s = u.currentLayout,
      f = u.nextLayout,
      y = u.currentLayoutIndex,
      m = d.length > 0,
      h = y,
      g = h + 1;
    if (void 0 === s && void 0 === f) {
      if (m) {
        var v = e({}, p);
        n = d[h], c = e(e({}, p), n), l = d.length > 1 ? v = e(e({}, v), d[g]) : c, c.id = n.layoutId, v && (l.id = v.layoutId);
      }
    } else m && (g = (h = (r = d, i = null === (o = c = f) || void 0 === o ? void 0 : o.layoutId, a = r.reduce(function (t, n, o) {
      return t[Number(n.layoutId)] = e(e({}, n), {}, {
        index: o
      }), t;
    }, {}), null !== i && i ? a[i] : a).index) + 1, d.length > 1 && g < d.length && (l = Boolean(t.xlr.layouts[g]) ? t.xlr.layouts[g] : e(e({}, p), d[g])), void 0 === l && (l = t.xlr.layouts[0]));
    return {
      currentLayoutIndex: h,
      inputLayouts: t.xlr.inputLayouts,
      current: c,
      next: l
    };
  }
  function U(t, o, r, a) {
    var c = {
        data: t,
        options: o,
        layout: a || p
      },
      l = s();
    l.on("start", function (t) {
      t.done = !1, console.log("Layout start emitted > Layout ID > ", t.id);
    }), l.on("end", function (t) {
      console.log("Ending layout with ID of > ", t.layoutId), t.done = !0;
      var e = document.getElementById(t.containerName);
      console.log({
        $layout: e
      }), null !== e && e.remove(), "CMS" !== r.config.platform && r.prepareLayouts().then(function (t) {
        r.playSchedules(t);
      });
    });
    var u = e(e({}, c.layout), {}, {
      options: c.options,
      emitter: l
    });
    return u.on = function (t, e) {
      return l.on(t, e);
    }, u.run = function () {
      var t = u,
        e = document.getElementById("".concat(t.containerName)),
        n = document.getElementById("splash_".concat(t.id));
      e && (e.style.display = "block"), n && (n.style.display = "none"), console.log("Layout running > Layout ID > ", t.id), console.log("Layout Regions > ", t.regions);
      for (var o = 0; o < t.regions.length; o++) t.regions[o].run();
    }, u.parseXlf = function () {
      var t,
        n,
        o,
        i,
        a,
        l,
        d = u,
        p = c.data,
        h = c.options;
      d.containerName = "L" + d.id + "-" + y(h), d.regions = [];
      var g = document.getElementById(d.containerName);
      null === g && ((g = document.createElement("div")).id = d.containerName);
      var v = document.getElementById("screen_container");
      if (v && v.appendChild(g), g && (g.style.display = "none", g.style.outline = "red solid thin"), d.layoutNode = p, d.sw = (null == v ? void 0 : v.offsetWidth) || 0, d.sh = (null == v ? void 0 : v.offsetHeight) || 0, d.xw = Number(null === (t = d.layoutNode) || void 0 === t || null === (t = t.firstElementChild) || void 0 === t ? void 0 : t.getAttribute("width")), d.xh = Number(null === (n = d.layoutNode) || void 0 === n || null === (n = n.firstElementChild) || void 0 === n ? void 0 : n.getAttribute("height")), d.zIndex = Number(null === (o = d.layoutNode) || void 0 === o || null === (o = o.firstElementChild) || void 0 === o ? void 0 : o.getAttribute("zindex")) || 0, d.scaleFactor = Math.min(d.sw / d.xw, d.sh / d.xh), d.sWidth = Math.round(d.xw * d.scaleFactor), d.sHeight = Math.round(d.xh * d.scaleFactor), d.offsetX = Math.abs(d.sw - d.sWidth) / 2, d.offsetY = Math.abs(d.sh - d.sHeight) / 2, g && (g.style.width = "".concat(d.sWidth, "px"), g.style.height = "".concat(d.sHeight, "px"), g.style.position = "absolute", g.style.left = "".concat(d.offsetX, "px"), g.style.top = "".concat(d.offsetY, "px")), g && null !== d.zIndex && (g.style.zIndex = "".concat(d.zIndex)), d.bgColor = (null === (i = d.layoutNode) || void 0 === i || null === (i = i.firstElementChild) || void 0 === i ? void 0 : i.getAttribute("bgcolor")) || "", d.bgImage = (null === (a = d.layoutNode) || void 0 === a || null === (a = a.firstElementChild) || void 0 === a ? void 0 : a.getAttribute("background")) || "", "" !== d.bgImage && void 0 !== d.bgImage) {
        d.bgId = d.bgImage.substring(0, d.bgImage.indexOf("."));
        var x = function (t, e) {
          var n = e.layoutBackgroundDownloadUrl.replace(":id", e.layout.id) + "?preview=1&width=" + e.layout.sWidth + "&height=" + e.layout.sHeight + "&dynamic&proportional=0";
          return "chromeOS" === t && (n = e.cmsUrl + "/chromeOS/resource/" + e.layout.id + "?saveAs=" + e.layout.bgImage), n;
        }(r.config.platform, e(e({}, h), {}, {
          layout: d
        }));
        g && (g.style.backgroundImage = 'url("'.concat(x, '")'), g.style.backgroundRepeat = "no-repeat", g.style.backgroundSize = "".concat(d.sWidth, "px ").concat(d.sHeight, "px"), g.style.backgroundPosition = "0px 0px");
      }
      g && d.bgColor && (g.style.backgroundColor = "".concat(d.bgColor)), g && void 0 !== r.currentLayoutId && r.currentLayoutId !== d.id && (g.style.display = "none");
      var b = Array.from((null == d || null === (l = d.layoutNode) || void 0 === l ? void 0 : l.getElementsByTagName("region")) || []);
      Array.from(b).forEach(function (t, n) {
        var o = function (t, n, o, r, i) {
          var a = {
              layout: t,
              xml: n,
              regionId: o,
              options: r
            },
            c = s(),
            l = e(e({}, k), a);
          return l.prepareRegion = function () {
            var t,
              n,
              o,
              r,
              c,
              u,
              d = l,
              s = d.layout,
              p = d.options;
            d.id = a.regionId, d.options = e(e({}, f), a.options), d.containerName = "R-".concat(d.id, "-").concat(y(d.options)), d.xml = a.xml, d.mediaObjects = [], d.sWidth = d.xml && Number(null === (t = d.xml) || void 0 === t ? void 0 : t.getAttribute("width")) * s.scaleFactor, d.sHeight = d.xml && Number(null === (n = d.xml) || void 0 === n ? void 0 : n.getAttribute("height")) * s.scaleFactor, d.offsetX = d.xml && Number(null === (o = d.xml) || void 0 === o ? void 0 : o.getAttribute("left")) * s.scaleFactor, d.offsetY = d.xml && Number(null === (r = d.xml) || void 0 === r ? void 0 : r.getAttribute("top")) * s.scaleFactor, d.zIndex = d.xml && Number(null === (c = d.xml) || void 0 === c ? void 0 : c.getAttribute("zindex"));
            var m = null === (u = d.xml) || void 0 === u ? void 0 : u.getElementsByTagName("options");
            if (m) for (var h = 0, g = Array.from(m); h < g.length; h++) for (var v = g[h].children, x = 0, b = Array.from(v); x < b.length; x++) {
              var w = b[x];
              d.options[w.nodeName.toLowerCase()] = w.textContent;
            }
            var I = document.getElementById(d.containerName),
              E = document.getElementById("".concat(d.layout.containerName));
            null === I && ((I = document.createElement("div")).id = d.containerName), E && E.appendChild(I), I.style.cssText = "\n            width: ".concat(d.sWidth, "px;\n            height: ").concat(d.sHeight, "px;\n            position: absolute;\n            left: ").concat(d.offsetX, "px;\n            top: ").concat(d.offsetY, "px;\n            z-index: ").concat(Math.round(d.zIndex), ";\n        "), I.className = "region--item";
            var k = Array.from(d.xml.getElementsByTagName("media"));
            d.totalMediaObjects = k.length, Array.from(k).forEach(function (t, e) {
              var n = j(d, (null == t ? void 0 : t.getAttribute("id")) || "", t, p, i);
              n.index = e, d.mediaObjects.push(n);
            }), d.prepareMediaObjects();
          }, l.finished = function () {
            var t = l;
            console.log("Region::finished called . . . ", t.id), t.complete = !0, t.layout.regions[l.index] = l, t.layout.regionExpired();
          }, l.prepareMediaObjects = function () {
            var t,
              e = l;
            if (e.mediaObjects.length > 0) {
              e.curMedia ? e.oldMedia = e.curMedia : e.oldMedia = void 0, e.currentMediaIndex >= e.mediaObjects.length && (e.currentMediaIndex = 0), e.curMedia = e.mediaObjects[e.currentMediaIndex], ((t = e.currentMediaIndex + 1) >= e.mediaObjects.length || !Boolean(e.mediaObjects[t]) && 1 === e.mediaObjects.length) && (t = 0), Boolean(e.mediaObjects[t]) && (e.nxtMedia = e.mediaObjects[t]);
              var n = document.getElementById("".concat(e.containerName));
              e.curMedia && n && n.insertBefore(e.curMedia.html, n.lastElementChild), e.nxtMedia && n && n.insertBefore(e.nxtMedia.html, n.lastElementChild);
            }
          }, l.run = function () {
            console.log("Called Region::run > ", l.id), l.curMedia && l.transitionNodes(l.oldMedia, l.curMedia);
          }, l.transitionNodes = function (t, e) {
            var n = l,
              o = 1,
              r = "E";
            if (e) {
              t && Boolean(t.options.transoutduration) && (o = Number(t.options.transoutduration)), t && Boolean(t.options.transoutdirection) && (r = t.options.transoutdirection);
              var i,
                a = {
                  duration: o
                },
                c = S("defaultOut", {
                  duration: a.duration
                });
              t && Boolean(t.options.transout) && ("fly" === (i = t.options.transout) && (i = "".concat(i, "Out"), a.keyframes = C({
                trans: "out",
                direction: r,
                height: t.divHeight,
                width: t.divWidth
              })), c = S(i, a));
              var u = new Promise(function (e) {
                if (t) {
                  var r = document.getElementById(m(t));
                  if (r) {
                    var a,
                      l = function l() {
                        r.style.setProperty("display", "none"), r.remove();
                      };
                    Boolean(t.options.transout) && (a = r.animate(c.keyframes, c.timing)), Boolean(t.options.transout) && n.totalMediaObjects > 1 ? "flyOut" === i ? a && a.finished.then(function () {
                      var t;
                      e(!0), null === (t = a) || void 0 === t || null === (t = t.effect) || void 0 === t || t.updateTiming({
                        fill: "none"
                      }), l();
                    }) : (setTimeout(l, o / 2), e(!0)) : (l(), e(!0));
                  }
                }
              });
              t ? u.then(function (t) {
                t && e.run();
              }) : e.run();
            }
          }, l.playNextMedia = function () {
            var t,
              e,
              n,
              o,
              r = l;
            r.ended || r.currentMediaIndex === r.mediaObjects.length - 1 && (r.finished(), r.layout.allEnded) || r.complete && "html" === (null === (t = r.curMedia) || void 0 === t ? void 0 : t.render) || (!r.complete || 1 !== r.mediaObjects.length || "html" === (null === (e = r.curMedia) || void 0 === e ? void 0 : e.render) || "image" !== (null === (n = r.curMedia) || void 0 === n ? void 0 : n.mediaType) || null !== (o = r.curMedia) && void 0 !== o && o.loop) && (r.currentMediaIndex = r.currentMediaIndex + 1, r.prepareMediaObjects(), r.transitionNodes(r.oldMedia, r.curMedia));
          }, l.end = function () {
            var t = l;
            t.ending = !0, t.layout.regions[t.index] = t, console.log("Calling Region::end ", t), t.exitTransition();
          }, l.exitTransition = function () {
            var t = l,
              e = document.getElementById("".concat(t.containerName));
            e && (e.style.display = "none"), console.log("Called Region::exitTransition ", t.id), t.exitTransitionComplete();
          }, l.exitTransitionComplete = function () {
            var t = l;
            console.log("Called Region::exitTransitionComplete ", t.id), t.ended = !0, t.layout.regions[t.index] = t, t.layout.regionEnded();
          }, l.on = function (t, e) {
            return c.on(t, e);
          }, l.emitter = c, l.prepareRegion(), l;
        }(d, t, (null == t ? void 0 : t.getAttribute("id")) || "", h, r);
        o.index = n, d.regions.push(o);
      });
    }, u.prepareLayout = function () {
      u.parseXlf();
    }, u.regionExpired = function () {
      var t = u;
      t.allExpired = !0;
      var e,
        n = d(t.regions);
      try {
        for (n.s(); !(e = n.n()).done;) {
          e.value.complete || (t.allExpired = !1);
        }
      } catch (t) {
        n.e(t);
      } finally {
        n.f();
      }
      t.allExpired && t.end();
    }, u.regionEnded = function () {
      var t = u;
      t.allEnded = !0;
      for (var e = 0; e < t.regions.length; e++) t.regions[e].ended || (t.allEnded = !1);
      t.allEnded && t.stopAllMedia().then(function () {
        var e;
        if (console.log("starting to end layout . . ."), "CMS" === r.config.platform) {
          var n = document.getElementById("play_ended"),
            o = document.getElementById("screen_container");
          if (o) {
            for (; o.firstChild;) o.removeChild(o.firstChild);
            o.style.display = "none";
          }
          n && (n.style.display = "block");
        }
        null === (e = t.emitter) || void 0 === e || e.emit("end", t);
      });
    }, u.end = function () {
      console.log("Executing Layout::end and Calling Region::end ", u);
      var t,
        e = d(u.regions);
      try {
        for (e.s(); !(t = e.n()).done;) {
          t.value.end();
        }
      } catch (t) {
        e.e(t);
      } finally {
        e.f();
      }
    }, u.stopAllMedia = function () {
      return console.log("Stopping all media . . ."), new Promise(function () {
        var t = i(n().mark(function t(e) {
          var o, r, i, a;
          return n().wrap(function (t) {
            for (;;) switch (t.prev = t.next) {
              case 0:
                o = 0;
              case 1:
                if (!(o < u.regions.length)) {
                  t.next = 14;
                  break;
                }
                r = u.regions[o], i = 0;
              case 4:
                if (!(i < r.mediaObjects.length)) {
                  t.next = 11;
                  break;
                }
                return a = r.mediaObjects[i], t.next = 8, a.stop();
              case 8:
                i++, t.next = 4;
                break;
              case 11:
                o++, t.next = 1;
                break;
              case 14:
                e();
              case 15:
              case "end":
                return t.stop();
            }
          }, t);
        }));
        return function (e) {
          return t.apply(this, arguments);
        };
      }());
    }, u.prepareLayout(), u;
  }
  !function (t) {
    t[t.CURRENT = 0] = "CURRENT", t[t.NEXT = 1] = "NEXT";
  }(B || (B = {}));
  var H = {
    inputLayouts: [],
    config: f,
    layouts: [],
    currentLayoutIndex: 0,
    currentLayoutId: null,
    currentLayout: void 0,
    nextLayout: void 0,
    bootstrap: function bootstrap() {},
    init: function init() {
      return Promise.resolve({});
    },
    playSchedules: function playSchedules() {},
    prepareLayoutXlf: function prepareLayoutXlf(t) {
      return Promise.resolve({});
    },
    prepareLayouts: function prepareLayouts() {
      return Promise.resolve({});
    }
  };
  return function (t, o) {
    var r = {
        inputLayouts: t,
        options: o
      },
      a = e(e({}, H), {}, {
        bootstrap: function bootstrap() {
          this.inputLayouts = Array.isArray(r.inputLayouts) ? r.inputLayouts : [r.inputLayouts], this.config = JSON.parse(JSON.stringify(e(e({}, f), r.options)));
        },
        init: function init() {
          var t = this;
          return new Promise(function (e) {
            var n,
              o,
              r,
              i,
              a,
              c = t,
              l = document.querySelector(".preview-canvas");
            n = l, o = document.createElement("div"), r = document.createElement("div"), i = document.createElement("div"), a = document.createElement("a"), o.className = "player-preview", o.id = "player_container", r.className = "screen-preview", r.id = "screen_container", i.className = "preview-ended", i.id = "play_ended", i.style.display = "none", a.id = "play_back_preview", a.className = "play-back-preview", a.style.cssText = "text-decoration: none; color: #ffffff;", a.innerHTML = "Play again?", a.removeEventListener("click", A), a.addEventListener("click", A), n || (n = document.body), n && null === n.querySelector("#player_container") && (n.insertBefore(o, n.firstChild), null === o.querySelector("#screen_container") && o.appendChild(r), null === o.querySelector("#play_ended") && (o.appendChild(i), null === i.querySelector("a") && i.appendChild(a))), c.prepareLayouts().then(function (t) {
              e(t);
            });
          });
        },
        playSchedules: function playSchedules(t) {
          var e;
          void 0 !== t.currentLayout && (null === (e = t.currentLayout.emitter) || void 0 === e || e.emit("start", t.currentLayout), t.currentLayout.run());
        },
        prepareLayoutXlf: function prepareLayoutXlf(t) {
          var o = this;
          return i(n().mark(function i() {
            var a, c, l, u, d;
            return n().wrap(function (n) {
              for (;;) switch (n.prev = n.next) {
                case 0:
                  if (a = o, c = e(e({}, c = Object.assign({}, f)), r.options), "CMS" === a.config.platform && t && Boolean(t.layoutId) ? c.xlfUrl = c.xlfUrl.replace(":layoutId", String(t.layoutId)) : "chromeOS" === a.config.platform && (c.xlfUrl = t.path), !t || null !== t.layoutNode) {
                    n.next = 12;
                    break;
                  }
                  return n.next = 7, P(c);
                case 7:
                  l = n.sent, d = new window.DOMParser(), u = d.parseFromString(l, "text/xml"), n.next = 13;
                  break;
                case 12:
                  u = t && t.layoutNode;
                case 13:
                  return n.abrupt("return", new Promise(function (e) {
                    var n = p;
                    n.id = Number(t.layoutId), n.layoutId = Number(t.layoutId), n.options = c, e(U(u, c, a, n));
                  }));
                case 14:
                case "end":
                  return n.stop();
              }
            }, i);
          }))();
        },
        prepareLayouts: function prepareLayouts() {
          var t = this;
          return i(n().mark(function e() {
            var o, r, i, a, l;
            return n().wrap(function (e) {
              for (;;) switch (e.prev = e.next) {
                case 0:
                  return i = _({
                    xlr: r = t
                  }), r.currentLayoutId = null === (o = i.current) || void 0 === o ? void 0 : o.layoutId, a = function a() {
                    var t,
                      e,
                      n = [];
                    return n.push(i.current), (null === (t = i.current) || void 0 === t ? void 0 : t.layoutId) !== (null === (e = i.next) || void 0 === e ? void 0 : e.layoutId) && n.push(i.next), n.reduce(function (t, e) {
                      return [].concat(c(t), [r.prepareLayoutXlf(e)]);
                    }, []);
                  }, e.next = 6, Promise.all(a());
                case 6:
                  return l = e.sent, e.abrupt("return", new Promise(function (t) {
                    r.layouts = l, r.currentLayout = r.layouts[0], Boolean(r.layouts[1]) ? r.nextLayout = r.layouts[1] : r.nextLayout = r.layouts[0], r.currentLayoutIndex = i.currentLayoutIndex, r.layouts[r.currentLayoutIndex] = r.currentLayout, t(r);
                  }));
                case 8:
                case "end":
                  return e.stop();
              }
            }, e);
          }))();
        }
      });
    return a.bootstrap(), a;
  };
}();
//# sourceMappingURL=xibo-layout-renderer.min.js.map
