function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }
function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }
function _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e6) { throw _e6; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e7) { didErr = true; err = _e7; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function _regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == _typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
var XiboLayoutRenderer = function () {
  "use strict";

  var e = function e() {
    return {
      emit: function emit(e) {
        for (var t = arguments.length, o = new Array(t > 1 ? t - 1 : 0), n = 1; n < t; n++) o[n - 1] = arguments[n];
        for (var i = 0, a = this.events[e] || [], r = a.length; i < r; i++) a[i].apply(a, o);
      },
      events: {},
      on: function on(e, t) {
        var o,
          n = this;
        return ((o = this.events)[e] || (o[e] = [])).push(t), function () {
          var o;
          n.events[e] = null === (o = n.events[e]) || void 0 === o ? void 0 : o.filter(function (e) {
            return t !== e;
          });
        };
      }
    };
  };
  var t = {
      getResourceUrl: "/playlist/widget/resource/:regionId/:id",
      xlfUrl: "/layout/xlf/:layoutId",
      layoutBackgroundDownloadUrl: "/layout/background/:id",
      layoutPreviewUrl: "/layout/preview/[layoutCode]",
      libraryDownloadUrl: "/library/download/:id",
      loaderUrl: "/theme/default/img/loader.gif",
      idCounter: 0,
      inPreview: !0,
      appHost: null,
      platform: "CMS"
    },
    o = {
      id: null,
      layoutId: null,
      sw: 0,
      sh: 0,
      xw: 0,
      xh: 0,
      zIndex: 0,
      scaleFactor: 1,
      sWidth: 0,
      sHeight: 0,
      offsetX: 0,
      offsetY: 0,
      bgColor: "",
      bgImage: "",
      bgId: "",
      containerName: "",
      layoutNode: null,
      regionMaxZIndex: 0,
      ready: !1,
      regionObjects: [],
      drawer: [],
      allExpired: !1,
      regions: [],
      actions: [],
      options: t,
      done: !1,
      allEnded: !1,
      path: "",
      prepareLayout: function prepareLayout() {},
      parseXlf: function parseXlf() {},
      run: function run() {},
      on: function on(e, t) {
        return {};
      },
      regionExpired: function regionExpired() {},
      end: function end() {},
      regionEnded: function regionEnded() {},
      stopAllMedia: function stopAllMedia() {
        return Promise.resolve();
      }
    };
  function n(e) {
    return e.idCounter > 500 && (e.idCounter = 0), e.idCounter = e.idCounter + 1, e.idCounter;
  }
  var i = function i(_ref) {
      var e = _ref.mediaType,
        t = _ref.containerName;
      var o = t;
      return "video" === e ? o += "-vid" : "audio" === e && (o += "-aud"), o;
    },
    a = function a(e) {
      return null === e ? "" : String(e).charAt(0).toUpperCase() + String(e).substring(1);
    };
  function r(_x, _x2) {
    return _r.apply(this, arguments);
  }
  function _r() {
    _r = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee10(e, t) {
      var o, n, _t16;
      return _regeneratorRuntime().wrap(function _callee10$(_context10) {
        while (1) switch (_context10.prev = _context10.next) {
          case 0:
            _context10.next = 2;
            return fetch(e, {
              mode: "no-cors"
            });
          case 2:
            o = _context10.sent;
            n = new Blob();
            if (!("image" === t)) {
              _context10.next = 8;
              break;
            }
            n = new Blob();
            _context10.next = 19;
            break;
          case 8:
            if (!("video" === t)) {
              _context10.next = 14;
              break;
            }
            _context10.next = 11;
            return o.blob();
          case 11:
            n = _context10.sent;
            _context10.next = 19;
            break;
          case 14:
            if (!("audio" === t)) {
              _context10.next = 19;
              break;
            }
            _context10.next = 17;
            return o.arrayBuffer();
          case 17:
            _t16 = _context10.sent;
            n = new Blob([_t16], {
              type: d(l(e))
            });
          case 19:
            return _context10.abrupt("return", (console.log({
              blob: n
            }), URL.createObjectURL(n)));
          case 20:
          case "end":
            return _context10.stop();
        }
      }, _callee10);
    }));
    return _r.apply(this, arguments);
  }
  function l(e) {
    var t = String(e).split(".");
    return t[t.length - 1];
  }
  function d(e) {
    var t = {
      mp3: "audio/mp3",
      wav: "audio/wav",
      ogg: "audio/ogg"
    };
    if (Boolean(t[e])) return t[e];
  }
  var s = {
      layout: o,
      id: "",
      regionId: "",
      xml: null,
      mediaObjects: [],
      mediaObjectsActions: [],
      currentMedia: -1,
      complete: !1,
      containerName: "",
      ending: !1,
      ended: !1,
      oneMedia: !1,
      oldMedia: void 0,
      curMedia: void 0,
      nxtMedia: void 0,
      currentMediaIndex: 0,
      totalMediaObjects: 0,
      ready: !1,
      options: {},
      sWidth: 0,
      sHeight: 0,
      offsetX: 0,
      offsetY: 0,
      zIndex: 0,
      index: -1,
      prepareRegion: function prepareRegion() {},
      playNextMedia: function playNextMedia() {},
      transitionNodes: function transitionNodes() {},
      finished: function finished() {},
      run: function run() {},
      end: function end() {},
      exitTransition: function exitTransition() {},
      exitTransitionComplete: function exitTransitionComplete() {},
      on: function on(e, t) {
        return {};
      },
      prepareMediaObjects: function prepareMediaObjects() {}
    },
    u = {
      region: s,
      xml: null,
      id: "",
      index: 0,
      idCounter: 0,
      containerName: "",
      html: null,
      iframe: null,
      iframeName: "",
      mediaType: "",
      render: "html",
      attachedAudio: !1,
      singlePlay: !1,
      timeoutId: setTimeout(function () {}, 100),
      ready: !0,
      checkIframeStatus: !1,
      loadIframeOnRun: !1,
      tempSrc: "",
      finished: !1,
      schemaVersion: "1",
      type: "",
      duration: 0,
      useDuration: Boolean(0),
      fileId: "",
      uri: "",
      options: {},
      divWidth: 0,
      divHeight: 0,
      url: null,
      loop: !1,
      run: function run() {},
      init: function init() {},
      stop: function stop() {
        return Promise.resolve();
      },
      on: function on(e, t) {
        return {};
      }
    },
    c = function c(e, t) {
      return {
        keyframes: [{
          display: "in" === t ? "none" : "block"
        }, {
          display: "out" === t ? "none" : "block"
        }],
        timing: {
          duration: e
        }
      };
    },
    p = function p(e) {
      return {
        keyframes: [{
          opacity: 1
        }, {
          opacity: 0,
          zIndex: -1
        }],
        timing: {
          duration: e,
          fill: "forwards"
        }
      };
    },
    m = function m(e, t, o) {
      var n = [{
          opacity: 0
        }, {
          opacity: 1,
          zIndex: 1
        }],
        i = {
          duration: e,
          fill: "forwards"
        };
      return t && Boolean(t.from) && (n[0] = _objectSpread(_objectSpread({}, t.from), n[0])), t && Boolean(t.to) && (n[1] = _objectSpread(_objectSpread({}, t.to), n[1])), {
        keyframes: n,
        timing: i
      };
    },
    y = function y(e, t, o) {
      var n = [{
          opacity: 1
        }, {
          opacity: 0,
          zIndex: -1
        }],
        i = {
          duration: e,
          fill: "forwards"
        };
      return t && Boolean(t.from) && (n[0] = _objectSpread(_objectSpread({}, t.from), n[0])), t && Boolean(t.to) && (n[1] = _objectSpread(_objectSpread({}, t.to), n[1])), {
        keyframes: n,
        timing: i
      };
    },
    f = function f(e, t) {
      var o;
      return {
        fadeIn: (o = t.duration, {
          keyframes: [{
            opacity: 0
          }, {
            opacity: 1
          }],
          timing: {
            duration: o,
            fill: "forwards"
          }
        }),
        fadeOut: p(t.duration),
        flyIn: m(t.duration, t.keyframes, t.direction),
        flyOut: y(t.duration, t.keyframes, t.direction),
        defaultIn: c(t.duration, "in"),
        defaultOut: c(t.duration, "out")
      }[e];
    },
    g = function g(e) {
      var t = {
          from: {},
          to: {}
        },
        o = function o(t) {
          return "from" === t ? "in" === e.trans ? 0 : 1 : "out" === e.trans ? 1 : 0;
        };
      switch (e.direction) {
        case "N":
        default:
          t.from = {
            opacity: o("from"),
            top: "in" === e.trans ? "".concat(e.height, "px") : 0
          }, t.to = {
            opacity: o("to"),
            top: "in" === e.trans ? 0 : "-".concat(e.height, "px")
          };
          break;
        case "NE":
          t.from = {
            opacity: o("from"),
            top: "in" === e.trans ? "".concat(e.height, "px") : 0,
            left: "in" === e.trans ? "-".concat(e.width, "px") : 0
          }, t.to = {
            opacity: o("to"),
            top: "in" === e.trans ? 0 : "-".concat(e.height, "px"),
            left: "in" === e.trans ? 0 : "".concat(e.width, "px")
          };
          break;
        case "E":
          t.from = {
            opacity: o("from"),
            left: "in" === e.trans ? "-".concat(e.width, "px") : 0
          }, t.to = {
            opacity: o("to"),
            left: "in" === e.trans ? 0 : "".concat(e.width, "px")
          };
          break;
        case "SE":
          t.from = {
            opacity: o("from"),
            top: "in" === e.trans ? "-".concat(e.height, "px") : 0,
            left: "in" === e.trans ? "-".concat(e.width, "px") : 0
          }, t.to = {
            opacity: o("to"),
            top: "in" === e.trans ? 0 : "".concat(e.height, "px"),
            left: "in" === e.trans ? 0 : "".concat(e.width, "px")
          };
          break;
        case "S":
          t.from = {
            opacity: o("from"),
            top: "in" === e.trans ? "-".concat(e.height, "px") : 0
          }, t.to = {
            opacity: o("to"),
            top: "in" === e.trans ? 0 : "".concat(e.height, "px")
          };
          break;
        case "SW":
          t.from = {
            opacity: o("from"),
            top: "in" === e.trans ? "-".concat(e.height, "px") : 0,
            left: "in" === e.trans ? "".concat(e.width, "px") : 0
          }, t.to = {
            opacity: o("to"),
            top: "in" === e.trans ? 0 : "".concat(e.height, "px"),
            left: "in" === e.trans ? 0 : "-".concat(e.width, "px")
          };
          break;
        case "W":
          t.from = {
            opacity: o("from"),
            left: "in" === e.trans ? "".concat(e.width, "px") : 0
          }, t.to = {
            opacity: o("to"),
            left: "in" === e.trans ? 0 : "-".concat(e.width, "px")
          };
          break;
        case "NW":
          t.from = {
            opacity: o("from"),
            top: "in" === e.trans ? "".concat(e.height, "px") : 0,
            left: "in" === e.trans ? "".concat(e.width, "px") : 0
          }, t.to = {
            opacity: o("to"),
            top: "in" === e.trans ? 0 : "-".concat(e.height, "px"),
            left: "in" === e.trans ? 0 : "-".concat(e.width, "px")
          };
      }
      return t;
    };
  function h(t, o, l, d, s) {
    var c = {
      region: t,
      mediaId: o,
      xml: l,
      options: d
    };
    var p = null,
      m = 0;
    var y = e(),
      h = _objectSpread(_objectSpread({}, u), c),
      x = function x(e) {
        p = setInterval(function () {
          var _e$emitter;
          m++, m > e.duration && ((_e$emitter = e.emitter) === null || _e$emitter === void 0 ? void 0 : _e$emitter.emit("end", e));
        }, 1e3), console.log("Showing Media " + e.id + " for " + e.duration + "s of Region " + e.region.regionId);
      };
    return y.on("start", function (e) {
      "video" === e.mediaType ? (function (e) {
        return {
          init: function init() {
            var t = document.getElementById(i(e));
            t && (t.onloadstart = function () {
              console.log("".concat(a(e.mediaType), " for media > ").concat(e.id, " has started loading data . . ."));
            }, t.onloadeddata = function () {
              t.readyState >= 2 && console.log("".concat(a(e.mediaType), " data for media > ").concat(e.id, " has been fully loaded . . ."));
            }, t.oncanplay = function () {
              console.log("".concat(a(e.mediaType), " for media > ").concat(e.id, " can be played . . ."));
              var o = t.play();
              void 0 !== o && o.then(function () {
                console.log("autoplay started . . .");
              })["catch"](function (e) {
                t.muted = !0, t.play();
              });
            }, t.onplaying = function () {
              console.log("".concat(a(e.mediaType), " for media > ").concat(e.id, " is now playing . . ."));
            }, 0 === e.duration && (t.ondurationchange = function () {
              console.log("Showing Media " + e.id + " for " + t.duration + "s of Region " + e.region.regionId);
            }, t.onended = function () {
              var _e$emitter2;
              console.log("".concat(a(e.mediaType), " for media > ").concat(e.id, " has ended playing . . .")), (_e$emitter2 = e.emitter) === null || _e$emitter2 === void 0 ? void 0 : _e$emitter2.emit("end", e);
            }));
          }
        };
      }(e).init(), e.duration > 0 && x(e)) : "audio" === e.mediaType ? (function (e) {
        return {
          init: function init() {
            var t = document.getElementById(i(e));
            var o = null;
            if (t) {
              t.onloadstart = function () {
                console.log("".concat(a(e.mediaType), " for media > ").concat(e.id, " has started loading data . . ."));
              }, t.onloadeddata = function () {
                t.readyState >= 2 && console.log("".concat(a(e.mediaType), " data for media > ").concat(e.id, " has been fully loaded . . ."));
              }, t.oncanplay = function () {
                console.log("".concat(a(e.mediaType), " for media > ").concat(e.id, " can be played . . ."));
              }, t.onplaying = function () {
                console.log("".concat(a(e.mediaType), " for media > ").concat(e.id, " is now playing . . .")), null !== o && o.remove();
              };
              var _n = t.play();
              void 0 !== _n && _n.then(function () {
                console.log("autoplay started . . .");
              })["catch"](function (e) {
                var _t$parentNode;
                "NotAllowedError" === e.name && (o = document.createElement("button"), o.classList.add("play-audio-btn"), o.textContent = "Play Audio", o.addEventListener("click", function () {
                  t.muted = !1, t.play();
                }), (_t$parentNode = t.parentNode) === null || _t$parentNode === void 0 ? void 0 : _t$parentNode.insertBefore(o, t.nextSibling));
              }), 0 === e.duration && (t.ondurationchange = function () {
                console.log("Showing Media " + e.id + " for " + t.duration + "s of Region " + e.region.regionId);
              }, t.onended = function () {
                var _e$emitter3;
                console.log("".concat(a(e.mediaType), " for media > ").concat(e.id, " has ended playing . . .")), (_e$emitter3 = e.emitter) === null || _e$emitter3 === void 0 ? void 0 : _e$emitter3.emit("end", e);
              });
            }
          }
        };
      }(e).init(), e.duration > 0 && x(e)) : x(e);
    }), y.on("end", function (e) {
      p && (clearInterval(p), m = 0), e.region.playNextMedia();
    }), h.init = function () {
      var _e$xml, _e$xml2, _e$xml3, _e$xml4, _e$xml5;
      var e = h;
      e.id = c.mediaId, e.fileId = ((_e$xml = e.xml) === null || _e$xml === void 0 ? void 0 : _e$xml.getAttribute("fileId")) || "", e.idCounter = n(c.options), e.containerName = "M-".concat(e.id, "-").concat(e.idCounter), e.iframeName = "".concat(e.containerName, "-iframe"), e.mediaType = ((_e$xml2 = e.xml) === null || _e$xml2 === void 0 ? void 0 : _e$xml2.getAttribute("type")) || "", e.render = ((_e$xml3 = e.xml) === null || _e$xml3 === void 0 ? void 0 : _e$xml3.getAttribute("render")) || "", e.duration = parseInt((_e$xml4 = e.xml) === null || _e$xml4 === void 0 ? void 0 : _e$xml4.getAttribute("duration")) || 0, e.options = _objectSpread(_objectSpread({}, c.options), {}, {
        mediaId: o
      });
      var t = document.createElement("iframe"),
        a = (_e$xml5 = e.xml) === null || _e$xml5 === void 0 ? void 0 : _e$xml5.getElementsByTagName("options");
      if (a) for (var _i = 0, _Array$from = Array.from(a); _i < _Array$from.length; _i++) {
        var _t = _Array$from[_i];
        var _o = _t.children;
        for (var _i2 = 0, _Array$from2 = Array.from(_o); _i2 < _Array$from2.length; _i2++) {
          var _t2 = _Array$from2[_i2];
          e.options[_t2.nodeName.toLowerCase()] = _t2.textContent;
        }
      }
      Boolean(e.options.uri) && (e.uri = e.options.uri), "1" === e.options.showfullscreen ? (e.divWidth = e.region.layout.sWidth, e.divHeight = e.region.layout.sHeight) : (e.divWidth = e.region.sWidth, e.divHeight = e.region.sHeight), t.scrolling = "no", t.id = e.iframeName, t.width = "".concat(e.divWidth, "px"), t.height = "".concat(e.divHeight, "px"), t.style.cssText = "border: 0; visibility: hidden;";
      var r = i(e);
      var l = document.getElementById(r);
      null === l && (l = "video" === e.mediaType ? document.createElement("video") : "audio" === e.mediaType ? new Audio() : document.createElement("div"), l.id = r), l.className = "media--item", l.style.cssText = "\n            display: none;\n            width: ".concat(e.divWidth, "px;\n            height: ").concat(e.divHeight, "px;\n            position: absolute;\n            background-size: contain;\n            background-repeat: no-repeat;\n            background-position: center;\n        "), document.getElementById("".concat(e.region.containerName));
      var d = _objectSpread(_objectSpread({}, s.config.config), {}, {
        regionOptions: e.region.options,
        layoutId: e.region.layout.layoutId,
        regionId: e.region.id,
        mediaId: e.id,
        fileId: e.fileId,
        scaleFactor: e.region.layout.scaleFactor,
        uri: e.uri
      });
      "image" !== e.mediaType && "video" !== e.mediaType || (d.mediaType = e.mediaType);
      var u = function (e, t) {
        var o = t.regionOptions.getResourceUrl.replace(":regionId", t.regionId).replace(":id", t.mediaId) + "?preview=1&layoutPreview=1";
        return "chromeOS" === e ? o = t.cmsUrl + "/chromeOS/resource/" + t.fileId + "?saveAs=" + t.uri : Boolean(t.mediaType) || (o += "&scale_override=" + t.scaleFactor), o;
      }(s.config.platform, d);
      if (e.url = u, e.loop = "1" == e.options.loop || "1" == e.region.options.loop && 1 == e.region.totalMediaObjects, t.src = "".concat(u, "&width=").concat(e.divWidth, "&height=").concat(e.divHeight), "html" === e.render || "ticker" === e.mediaType || "webpage" === e.mediaType) e.checkIframeStatus = !0, e.iframe = t;else if ("image" === e.mediaType) {
        if ("stretch" === e.options.scaletype) l.style.cssText = l.style.cssText.concat("background-size: 100% 100%;");else if ("fit" === e.options.scaletype) l.style.cssText = l.style.cssText.concat("background-size: cover;");else {
          var _t3 = "" == e.options.align ? "center" : e.options.align,
            _o2 = "" == e.options.valign || "middle" == e.options.valign ? "center" : e.options.valign;
          l.style.cssText = l.style.cssText.concat("background-position: ".concat(_t3, " ").concat(_o2));
        }
      } else if ("video" === e.mediaType) {
        var _t4 = l;
        _t4.preload = "auto", _t4.textContent = "Unsupported Video", Boolean(e.options.mute) && (_t4.muted = "1" === e.options.mute), Boolean(e.options.scaletype) && "stretch" === e.options.scaletype && (_t4.style.objectFit = "fill"), _t4.playsInline = !0, e.loop && (_t4.loop = !0), l = _t4;
      } else if ("audio" === e.mediaType) {
        var _t5 = l;
        _t5.preload = "auto", _t5.textContent = "Unsupported Audio", _t5.autoplay = !0, e.loop && (_t5.loop = !0), l = _t5;
      }
      if (("html" === e.render || "ticker" === e.mediaType) && "1" === e.options.durationisperitem) {
        var _t6 = new RegExp("\x3c!-- NUMITEMS=(.*?) --\x3e");
        _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {
          var o, n;
          return _regeneratorRuntime().wrap(function _callee2$(_context2) {
            while (1) switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return function () {
                  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(e) {
                    return _regeneratorRuntime().wrap(function _callee$(_context) {
                      while (1) switch (_context.prev = _context.next) {
                        case 0:
                          return _context.abrupt("return", fetch(e).then(function (e) {
                            return e.json();
                          })["catch"](function (e) {
                            console.log(e);
                          }));
                        case 1:
                        case "end":
                          return _context.stop();
                      }
                    }, _callee);
                  }));
                  return function (_x3) {
                    return _ref3.apply(this, arguments);
                  };
                }()("".concat(u, "&width=").concat(e.divWidth, "&height=").concat(e.divHeight));
              case 2:
                o = _context2.sent;
                console.log({
                  html: o
                });
                n = _t6.exec(o);
                null !== n && (e.duration = parseInt(String(e.duration)) * parseInt(n[1]));
              case 6:
              case "end":
                return _context2.stop();
            }
          }, _callee2);
        }))();
      }
      if (Boolean(e.options.transin) && Boolean(e.options.transinduration)) {
        var _t7 = Number(e.options.transinduration),
          _o3 = f("fadeIn", {
            duration: _t7
          });
        l.animate(_o3.keyframes, _o3.timing);
      }
      e.html = l;
    }, h.run = function () {
      var e = h;
      var t = 1,
        o = "E";
      Boolean(e.options.transinduration) && (t = Number(e.options.transinduration)), Boolean(e.options.transindirection) && (o = e.options.transindirection);
      var n = {
          duration: t
        },
        a = f("defaultIn", {
          duration: n.duration
        });
      if (Boolean(e.options.transin)) {
        var _t8 = e.options.transin;
        "fly" === _t8 && (_t8 = "".concat(_t8, "In"), n.keyframes = g({
          trans: "in",
          direction: o,
          height: e.divHeight,
          width: e.divWidth
        })), a = f(_t8, n);
      }
      var l = function l() {
        var t = document.getElementById("".concat(e.region.containerName));
        return e.region.complete && !e.region.layout.allEnded ? (t && t.insertBefore(e.html, t.lastElementChild), e.html) : null;
      };
      _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {
        var _e$emitter4;
        var t, o, n;
        return _regeneratorRuntime().wrap(function _callee4$(_context4) {
          while (1) switch (_context4.prev = _context4.next) {
            case 0:
              t = i(e), o = document.getElementById(t);
              n = "CMS" === s.config.platform;
              null === o && (o = l());
              _context4.t0 = null !== o;
              if (!_context4.t0) {
                _context4.next = 35;
                break;
              }
              o.style.setProperty("display", "block");
              Boolean(e.options.transin) && o.animate(a.keyframes, a.timing);
              if (!("image" === e.mediaType && null !== e.url)) {
                _context4.next = 22;
                break;
              }
              _context4.t1 = o.style;
              _context4.t2 = "url(";
              if (!n) {
                _context4.next = 16;
                break;
              }
              _context4.next = 13;
              return function () {
                var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(e) {
                  return _regeneratorRuntime().wrap(function _callee3$(_context3) {
                    while (1) switch (_context3.prev = _context3.next) {
                      case 0:
                        return _context3.abrupt("return", fetch(e, {
                          mode: "no-cors"
                        }).then(function (e) {
                          return e.blob();
                        }).then(function (e) {
                          return new Promise(function (t, o) {
                            var n = new FileReader();
                            n.onloadend = function () {
                              return t(n.result);
                            }, n.onerror = o, n.readAsDataURL(e);
                          });
                        }));
                      case 1:
                      case "end":
                        return _context3.stop();
                    }
                  }, _callee3);
                }));
                return function (_x4) {
                  return _ref5.apply(this, arguments);
                };
              }()(e.url);
            case 13:
              _context4.t3 = _context4.sent;
              _context4.next = 17;
              break;
            case 16:
              _context4.t3 = e.url;
            case 17:
              _context4.t4 = _context4.t3;
              _context4.t5 = _context4.t2.concat.call(_context4.t2, _context4.t4);
              _context4.t1.setProperty.call(_context4.t1, "background-image", _context4.t5);
              _context4.next = 34;
              break;
            case 22:
              if (!("video" === e.mediaType && null !== e.url || "audio" === e.mediaType && null !== e.url)) {
                _context4.next = 33;
                break;
              }
              if (!n) {
                _context4.next = 29;
                break;
              }
              _context4.next = 26;
              return r(e.url, e.mediaType);
            case 26:
              _context4.t6 = _context4.sent;
              _context4.next = 30;
              break;
            case 29:
              _context4.t6 = e.url;
            case 30:
              o.src = _context4.t6;
              _context4.next = 34;
              break;
            case 33:
              ("html" === e.render || "webpage" === e.mediaType) && e.iframe && e.checkIframeStatus && (e.ready = !1, o.innerHTML = "", o.appendChild(e.iframe), e.iframe && e.iframe.addEventListener("load", function () {
                if (e.ready = !0, e.iframe) {
                  var _t9 = e.iframe.style.cssText;
                  e.iframe.style.cssText = _t9 === null || _t9 === void 0 ? void 0 : _t9.concat("visibility: visible;");
                }
              }));
            case 34:
              (_e$emitter4 = e.emitter) === null || _e$emitter4 === void 0 ? void 0 : _e$emitter4.emit("start", e);
            case 35:
            case "end":
              return _context4.stop();
          }
        }, _callee4);
      }))();
    }, h.stop = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {
      var e, t;
      return _regeneratorRuntime().wrap(function _callee5$(_context5) {
        while (1) switch (_context5.prev = _context5.next) {
          case 0:
            e = h, t = document.getElementById(i(e));
            t && (t.style.display = "none", t.remove());
          case 2:
          case "end":
            return _context5.stop();
        }
      }, _callee5);
    })), h.on = function (e, t) {
      return y.on(e, t);
    }, h.emitter = y, h.init(), h;
  }
  var x = function x(e) {
    e.preventDefault(), history.go(0);
  };
  function b(e) {
    var _t10;
    var t,
      n,
      _e$xlr = e.xlr,
      i = _e$xlr.inputLayouts,
      a = _e$xlr.currentLayout,
      r = _e$xlr.nextLayout,
      l = _e$xlr.currentLayoutIndex;
    var d = i.length > 0;
    var s = l,
      u = s + 1;
    if (void 0 === a && void 0 === r) {
      var _e;
      if (d) {
        var _a = _objectSpread({}, o);
        _e = i[s], t = _objectSpread(_objectSpread({}, o), _e), i.length > 1 ? (_a = _objectSpread(_objectSpread({}, _a), i[u]), n = _a) : n = t, t.id = _e.layoutId, _a && (n.id = _a.layoutId);
      }
    } else d && (t = r, s = function (e, t) {
      var o = e.reduce(function (e, t, o) {
        return e[Number(t.layoutId)] = _objectSpread(_objectSpread({}, t), {}, {
          index: o
        }), e;
      }, {});
      return null !== t && t ? o[t] : o;
    }(i, (_t10 = t) === null || _t10 === void 0 ? void 0 : _t10.layoutId).index, u = s + 1, i.length > 1 && u < i.length && (n = Boolean(e.xlr.layouts[u]) ? e.xlr.layouts[u] : _objectSpread(_objectSpread({}, o), i[u])), void 0 === n && (n = e.xlr.layouts[0]));
    return {
      currentLayoutIndex: s,
      inputLayouts: e.xlr.inputLayouts,
      current: t,
      next: n
    };
  }
  function I(a, r, l, d) {
    var u = {
        data: a,
        options: r,
        layout: d || o
      },
      c = e();
    c.on("start", function (e) {
      e.done = !1, console.log("Layout start emitted > Layout ID > ", e.id);
    }), c.on("end", function (e) {
      console.log("Ending layout with ID of > ", e.layoutId), e.done = !0;
      var t = document.getElementById(e.containerName);
      console.log({
        $layout: t
      }), null !== t && t.remove(), "CMS" !== l.config.platform && l.prepareLayouts().then(function (e) {
        l.playSchedules(e);
      });
    });
    var p = _objectSpread(_objectSpread({}, u.layout), {}, {
      options: u.options,
      emitter: c
    });
    return p.on = function (e, t) {
      return c.on(e, t);
    }, p.run = function () {
      var e = p,
        t = document.getElementById("".concat(e.containerName)),
        o = document.getElementById("splash_".concat(e.id));
      t && (t.style.display = "block"), o && (o.style.display = "none"), console.log("Layout running > Layout ID > ", e.id), console.log("Layout Regions > ", e.regions);
      for (var _t11 = 0; _t11 < e.regions.length; _t11++) e.regions[_t11].run();
    }, p.parseXlf = function () {
      var _o$layoutNode, _o$layoutNode2, _o$layoutNode3, _o$layoutNode4, _o$layoutNode5, _o$layoutNode6;
      var o = p,
        a = u.data,
        r = u.options;
      o.containerName = "L" + o.id + "-" + n(r), o.regions = [];
      var d = document.getElementById(o.containerName);
      null === d && (d = document.createElement("div"), d.id = o.containerName);
      var c = document.getElementById("screen_container");
      if (c && c.appendChild(d), d && (d.style.display = "none", d.style.outline = "red solid thin"), o.layoutNode = a, o.sw = (c === null || c === void 0 ? void 0 : c.offsetWidth) || 0, o.sh = (c === null || c === void 0 ? void 0 : c.offsetHeight) || 0, o.xw = Number((_o$layoutNode = o.layoutNode) === null || _o$layoutNode === void 0 || (_o$layoutNode = _o$layoutNode.firstElementChild) === null || _o$layoutNode === void 0 ? void 0 : _o$layoutNode.getAttribute("width")), o.xh = Number((_o$layoutNode2 = o.layoutNode) === null || _o$layoutNode2 === void 0 || (_o$layoutNode2 = _o$layoutNode2.firstElementChild) === null || _o$layoutNode2 === void 0 ? void 0 : _o$layoutNode2.getAttribute("height")), o.zIndex = Number((_o$layoutNode3 = o.layoutNode) === null || _o$layoutNode3 === void 0 || (_o$layoutNode3 = _o$layoutNode3.firstElementChild) === null || _o$layoutNode3 === void 0 ? void 0 : _o$layoutNode3.getAttribute("zindex")) || 0, o.scaleFactor = Math.min(o.sw / o.xw, o.sh / o.xh), o.sWidth = Math.round(o.xw * o.scaleFactor), o.sHeight = Math.round(o.xh * o.scaleFactor), o.offsetX = Math.abs(o.sw - o.sWidth) / 2, o.offsetY = Math.abs(o.sh - o.sHeight) / 2, d && (d.style.width = "".concat(o.sWidth, "px"), d.style.height = "".concat(o.sHeight, "px"), d.style.position = "absolute", d.style.left = "".concat(o.offsetX, "px"), d.style.top = "".concat(o.offsetY, "px")), d && null !== o.zIndex && (d.style.zIndex = "".concat(o.zIndex)), o.bgColor = ((_o$layoutNode4 = o.layoutNode) === null || _o$layoutNode4 === void 0 || (_o$layoutNode4 = _o$layoutNode4.firstElementChild) === null || _o$layoutNode4 === void 0 ? void 0 : _o$layoutNode4.getAttribute("bgcolor")) || "", o.bgImage = ((_o$layoutNode5 = o.layoutNode) === null || _o$layoutNode5 === void 0 || (_o$layoutNode5 = _o$layoutNode5.firstElementChild) === null || _o$layoutNode5 === void 0 ? void 0 : _o$layoutNode5.getAttribute("background")) || "", "" !== o.bgImage && void 0 !== o.bgImage) {
        o.bgId = o.bgImage.substring(0, o.bgImage.indexOf("."));
        var _e2 = function (e, t) {
          var o = t.layoutBackgroundDownloadUrl.replace(":id", t.layout.id) + "?preview=1&width=" + t.layout.sWidth + "&height=" + t.layout.sHeight + "&dynamic&proportional=0";
          return "chromeOS" === e && (o = t.cmsUrl + "/chromeOS/resource/" + t.layout.id + "?saveAs=" + t.layout.bgImage), o;
        }(l.config.platform, _objectSpread(_objectSpread({}, r), {}, {
          layout: o
        }));
        d && (d.style.backgroundImage = "url(\"".concat(_e2, "\")"), d.style.backgroundRepeat = "no-repeat", d.style.backgroundSize = "".concat(o.sWidth, "px ").concat(o.sHeight, "px"), d.style.backgroundPosition = "0px 0px");
      }
      d && o.bgColor && (d.style.backgroundColor = "".concat(o.bgColor)), d && void 0 !== l.currentLayoutId && l.currentLayoutId !== o.id && (d.style.display = "none");
      var m = Array.from((o === null || o === void 0 || (_o$layoutNode6 = o.layoutNode) === null || _o$layoutNode6 === void 0 ? void 0 : _o$layoutNode6.getElementsByTagName("region")) || []);
      Array.from(m).forEach(function (a, d) {
        var u = function (o, a, r, l, d) {
          var u = {
              layout: o,
              xml: a,
              regionId: r,
              options: l
            },
            c = e();
          var p = _objectSpread(_objectSpread({}, s), u);
          return p.prepareRegion = function () {
            var _e$xml6, _e$xml7, _e$xml8, _e$xml9, _e$xml10, _e$xml11;
            var e = p,
              o = e.layout,
              i = e.options;
            e.id = u.regionId, e.options = _objectSpread(_objectSpread({}, t), u.options), e.containerName = "R-".concat(e.id, "-").concat(n(e.options)), e.xml = u.xml, e.mediaObjects = [], e.sWidth = e.xml && Number((_e$xml6 = e.xml) === null || _e$xml6 === void 0 ? void 0 : _e$xml6.getAttribute("width")) * o.scaleFactor, e.sHeight = e.xml && Number((_e$xml7 = e.xml) === null || _e$xml7 === void 0 ? void 0 : _e$xml7.getAttribute("height")) * o.scaleFactor, e.offsetX = e.xml && Number((_e$xml8 = e.xml) === null || _e$xml8 === void 0 ? void 0 : _e$xml8.getAttribute("left")) * o.scaleFactor, e.offsetY = e.xml && Number((_e$xml9 = e.xml) === null || _e$xml9 === void 0 ? void 0 : _e$xml9.getAttribute("top")) * o.scaleFactor, e.zIndex = e.xml && Number((_e$xml10 = e.xml) === null || _e$xml10 === void 0 ? void 0 : _e$xml10.getAttribute("zindex"));
            var a = (_e$xml11 = e.xml) === null || _e$xml11 === void 0 ? void 0 : _e$xml11.getElementsByTagName("options");
            if (a) for (var _i3 = 0, _Array$from3 = Array.from(a); _i3 < _Array$from3.length; _i3++) {
              var _t12 = _Array$from3[_i3];
              var _o4 = _t12.children;
              for (var _i4 = 0, _Array$from4 = Array.from(_o4); _i4 < _Array$from4.length; _i4++) {
                var _t13 = _Array$from4[_i4];
                e.options[_t13.nodeName.toLowerCase()] = _t13.textContent;
              }
            }
            var r = document.getElementById(e.containerName);
            var l = document.getElementById("".concat(e.layout.containerName));
            null === r && (r = document.createElement("div"), r.id = e.containerName), l && l.appendChild(r), r.style.cssText = "\n            width: ".concat(e.sWidth, "px;\n            height: ").concat(e.sHeight, "px;\n            position: absolute;\n            left: ").concat(e.offsetX, "px;\n            top: ").concat(e.offsetY, "px;\n            z-index: ").concat(Math.round(e.zIndex), ";\n        "), r.className = "region--item";
            var s = Array.from(e.xml.getElementsByTagName("media"));
            e.totalMediaObjects = s.length, Array.from(s).forEach(function (t, o) {
              var n = h(e, (t === null || t === void 0 ? void 0 : t.getAttribute("id")) || "", t, i, d);
              n.index = o, e.mediaObjects.push(n);
            }), e.prepareMediaObjects();
          }, p.finished = function () {
            var e = p;
            console.log("Region::finished called . . . ", e.id), e.complete = !0, e.layout.regions[p.index] = p, e.layout.regionExpired();
          }, p.prepareMediaObjects = function () {
            var e = p;
            var t;
            if (e.mediaObjects.length > 0) {
              e.curMedia ? e.oldMedia = e.curMedia : e.oldMedia = void 0, e.currentMediaIndex >= e.mediaObjects.length && (e.currentMediaIndex = 0), e.curMedia = e.mediaObjects[e.currentMediaIndex], t = e.currentMediaIndex + 1, (t >= e.mediaObjects.length || !Boolean(e.mediaObjects[t]) && 1 === e.mediaObjects.length) && (t = 0), Boolean(e.mediaObjects[t]) && (e.nxtMedia = e.mediaObjects[t]);
              var _o5 = document.getElementById("".concat(e.containerName));
              e.curMedia && _o5 && _o5.insertBefore(e.curMedia.html, _o5.lastElementChild), e.nxtMedia && _o5 && _o5.insertBefore(e.nxtMedia.html, _o5.lastElementChild);
            }
          }, p.run = function () {
            console.log("Called Region::run > ", p.id), p.curMedia && p.transitionNodes(p.oldMedia, p.curMedia);
          }, p.transitionNodes = function (e, t) {
            var o = p;
            var n = 1,
              a = "E";
            if (t) {
              e && Boolean(e.options.transoutduration) && (n = Number(e.options.transoutduration)), e && Boolean(e.options.transoutdirection) && (a = e.options.transoutdirection);
              var _r2,
                _l = {
                  duration: n
                },
                _d = f("defaultOut", {
                  duration: _l.duration
                });
              e && Boolean(e.options.transout) && (_r2 = e.options.transout, "fly" === _r2 && (_r2 = "".concat(_r2, "Out"), _l.keyframes = g({
                trans: "out",
                direction: a,
                height: e.divHeight,
                width: e.divWidth
              })), _d = f(_r2, _l));
              var _s = new Promise(function (t) {
                if (e) {
                  var _a2 = document.getElementById(i(e));
                  if (_a2) {
                    var _i5 = function _i5() {
                      _a2.style.setProperty("display", "none"), _a2.remove();
                    };
                    var _l2;
                    Boolean(e.options.transout) && (_l2 = _a2.animate(_d.keyframes, _d.timing)), Boolean(e.options.transout) && o.totalMediaObjects > 1 ? "flyOut" === _r2 ? _l2 && _l2.finished.then(function () {
                      var _l3;
                      t(!0), (_l3 = _l2) !== null && _l3 !== void 0 && (_l3 = _l3.effect) !== null && _l3 !== void 0 && _l3.updateTiming({
                        fill: "none"
                      }), _i5();
                    }) : (setTimeout(_i5, n / 2), t(!0)) : (_i5(), t(!0));
                  }
                }
              });
              e ? _s.then(function (e) {
                e && t.run();
              }) : t.run();
            }
          }, p.playNextMedia = function () {
            var _e$curMedia, _e$curMedia2, _e$curMedia3, _e$curMedia4;
            var e = p;
            e.ended || e.currentMediaIndex === e.mediaObjects.length - 1 && (e.finished(), e.layout.allEnded) || e.complete && "html" === ((_e$curMedia = e.curMedia) === null || _e$curMedia === void 0 ? void 0 : _e$curMedia.render) || e.complete && 1 === e.mediaObjects.length && "html" !== ((_e$curMedia2 = e.curMedia) === null || _e$curMedia2 === void 0 ? void 0 : _e$curMedia2.render) && "image" === ((_e$curMedia3 = e.curMedia) === null || _e$curMedia3 === void 0 ? void 0 : _e$curMedia3.mediaType) && !((_e$curMedia4 = e.curMedia) !== null && _e$curMedia4 !== void 0 && _e$curMedia4.loop) || (e.currentMediaIndex = e.currentMediaIndex + 1, e.prepareMediaObjects(), e.transitionNodes(e.oldMedia, e.curMedia));
          }, p.end = function () {
            var e = p;
            e.ending = !0, e.layout.regions[e.index] = e, console.log("Calling Region::end ", e), e.exitTransition();
          }, p.exitTransition = function () {
            var e = p,
              t = document.getElementById("".concat(e.containerName));
            t && (t.style.display = "none"), console.log("Called Region::exitTransition ", e.id), e.exitTransitionComplete();
          }, p.exitTransitionComplete = function () {
            var e = p;
            console.log("Called Region::exitTransitionComplete ", e.id), e.ended = !0, e.layout.regions[e.index] = e, e.layout.regionEnded();
          }, p.on = function (e, t) {
            return c.on(e, t);
          }, p.emitter = c, p.prepareRegion(), p;
        }(o, a, (a === null || a === void 0 ? void 0 : a.getAttribute("id")) || "", r, l);
        u.index = d, o.regions.push(u);
      });
    }, p.prepareLayout = function () {
      p.parseXlf();
    }, p.regionExpired = function () {
      var e = p;
      e.allExpired = !0;
      var _iterator = _createForOfIteratorHelper(e.regions),
        _step;
      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var _t14 = _step.value;
          _t14.complete || (e.allExpired = !1);
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
      e.allExpired && e.end();
    }, p.regionEnded = function () {
      var e = p;
      e.allEnded = !0;
      for (var t = 0; t < e.regions.length; t++) e.regions[t].ended || (e.allEnded = !1);
      e.allEnded && e.stopAllMedia().then(function () {
        var _e$emitter5;
        if (console.log("starting to end layout . . ."), "CMS" === l.config.platform) {
          var _e3 = document.getElementById("play_ended"),
            _t15 = document.getElementById("screen_container");
          if (_t15) {
            for (; _t15.firstChild;) _t15.removeChild(_t15.firstChild);
            _t15.style.display = "none";
          }
          _e3 && (_e3.style.display = "block");
        }
        (_e$emitter5 = e.emitter) === null || _e$emitter5 === void 0 || _e$emitter5.emit("end", e);
      });
    }, p.end = function () {
      console.log("Executing Layout::end and Calling Region::end ", p);
      var _iterator2 = _createForOfIteratorHelper(p.regions),
        _step2;
      try {
        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
          var _e4 = _step2.value;
          _e4.end();
        }
      } catch (err) {
        _iterator2.e(err);
      } finally {
        _iterator2.f();
      }
    }, p.stopAllMedia = function () {
      return console.log("Stopping all media . . ."), new Promise( /*#__PURE__*/function () {
        var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6(e) {
          var t, o, n, i;
          return _regeneratorRuntime().wrap(function _callee6$(_context6) {
            while (1) switch (_context6.prev = _context6.next) {
              case 0:
                t = 0;
              case 1:
                if (!(t < p.regions.length)) {
                  _context6.next = 13;
                  break;
                }
                o = p.regions[t], n = 0;
              case 3:
                if (!(n < o.mediaObjects.length)) {
                  _context6.next = 10;
                  break;
                }
                i = o.mediaObjects[n];
                _context6.next = 7;
                return i.stop();
              case 7:
                n++;
                _context6.next = 3;
                break;
              case 10:
                t++;
                _context6.next = 1;
                break;
              case 13:
                e();
              case 14:
              case "end":
                return _context6.stop();
            }
          }, _callee6);
        }));
        return function (_x5) {
          return _ref7.apply(this, arguments);
        };
      }());
    }, p.prepareLayout(), p;
  }
  var v;
  !function (e) {
    e[e.CURRENT = 0] = "CURRENT", e[e.NEXT = 1] = "NEXT";
  }(v || (v = {}));
  var w = {
    inputLayouts: [],
    config: t,
    layouts: [],
    currentLayoutIndex: 0,
    currentLayoutId: null,
    currentLayout: void 0,
    nextLayout: void 0,
    bootstrap: function bootstrap() {},
    init: function init() {
      return Promise.resolve({});
    },
    playSchedules: function playSchedules() {},
    prepareLayoutXlf: function prepareLayoutXlf(e) {
      return Promise.resolve({});
    },
    prepareLayouts: function prepareLayouts() {
      return Promise.resolve({});
    }
  };
  return function (e, n) {
    var i = {
        inputLayouts: e,
        options: n
      },
      a = _objectSpread(_objectSpread({}, w), {}, {
        bootstrap: function bootstrap() {
          this.inputLayouts = Array.isArray(i.inputLayouts) ? i.inputLayouts : [i.inputLayouts], this.config = JSON.parse(JSON.stringify(_objectSpread(_objectSpread({}, t), i.options)));
        },
        init: function init() {
          var _this = this;
          return new Promise(function (e) {
            !function (e) {
              var t = e;
              var o = document.createElement("div"),
                n = document.createElement("div"),
                i = document.createElement("div"),
                a = document.createElement("a");
              o.className = "player-preview", o.id = "player_container", n.className = "screen-preview", n.id = "screen_container", i.className = "preview-ended", i.id = "play_ended", i.style.display = "none", a.id = "play_back_preview", a.className = "play-back-preview", a.style.cssText = "text-decoration: none; color: #ffffff;", a.innerHTML = "Play again?", a.removeEventListener("click", x), a.addEventListener("click", x), t || (t = document.body), t && null === t.querySelector("#player_container") && (t.insertBefore(o, t.firstChild), null === o.querySelector("#screen_container") && o.appendChild(n), null === o.querySelector("#play_ended") && (o.appendChild(i), null === i.querySelector("a") && i.appendChild(a)));
            }(document.querySelector(".preview-canvas")), _this.prepareLayouts().then(function (t) {
              e(t);
            });
          });
        },
        playSchedules: function playSchedules(e) {
          var _e$currentLayout$emit;
          void 0 !== e.currentLayout && ((_e$currentLayout$emit = e.currentLayout.emitter) !== null && _e$currentLayout$emit !== void 0 && _e$currentLayout$emit.emit("start", e.currentLayout), e.currentLayout.run());
        },
        prepareLayoutXlf: function prepareLayoutXlf(e) {
          var _this2 = this;
          return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee8() {
            var n, a, r, l, _e5;
            return _regeneratorRuntime().wrap(function _callee8$(_context8) {
              while (1) switch (_context8.prev = _context8.next) {
                case 0:
                  n = _this2;
                  l = Object.assign({}, t);
                  if (!(l = _objectSpread(_objectSpread({}, l), i.options), "CMS" === n.config.platform && e && Boolean(e.layoutId) ? l.xlfUrl = l.xlfUrl.replace(":layoutId", String(e.layoutId)) : "chromeOS" === n.config.platform && (l.xlfUrl = e.path), e && null === e.layoutNode)) {
                    _context8.next = 10;
                    break;
                  }
                  _context8.next = 5;
                  return function () {
                    var _ref8 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7(e) {
                      var t, o, n;
                      return _regeneratorRuntime().wrap(function _callee7$(_context7) {
                        while (1) switch (_context7.prev = _context7.next) {
                          case 0:
                            t = window.location.origin, o = t + e.xlfUrl;
                            "CMS" === e.platform ? o = t + e.xlfUrl : "chromeOS" === e.platform ? o = e.xlfUrl : "CMS" !== e.platform && null !== e.appHost && (o = e.appHost + e.xlfUrl);
                            _context7.next = 4;
                            return fetch(o);
                          case 4:
                            n = _context7.sent;
                            _context7.next = 7;
                            return n.text();
                          case 7:
                            return _context7.abrupt("return", _context7.sent);
                          case 8:
                          case "end":
                            return _context7.stop();
                        }
                      }, _callee7);
                    }));
                    return function (_x6) {
                      return _ref8.apply(this, arguments);
                    };
                  }()(l);
                case 5:
                  a = _context8.sent;
                  _e5 = new window.DOMParser();
                  r = _e5.parseFromString(a, "text/xml");
                  _context8.next = 11;
                  break;
                case 10:
                  r = e && e.layoutNode;
                case 11:
                  return _context8.abrupt("return", new Promise(function (t) {
                    var i = o;
                    i.id = Number(e.layoutId), i.layoutId = Number(e.layoutId), i.options = l, t(I(r, l, n, i));
                  }));
                case 12:
                case "end":
                  return _context8.stop();
              }
            }, _callee8);
          }))();
        },
        prepareLayouts: function prepareLayouts() {
          var _this3 = this;
          return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee9() {
            var _t$current;
            var e, t, o;
            return _regeneratorRuntime().wrap(function _callee9$(_context9) {
              while (1) switch (_context9.prev = _context9.next) {
                case 0:
                  e = _this3, t = b({
                    xlr: e
                  });
                  e.currentLayoutId = (_t$current = t.current) === null || _t$current === void 0 ? void 0 : _t$current.layoutId;
                  _context9.next = 4;
                  return Promise.all(function (_t$current2, _t$next) {
                    var o = [];
                    return o.push(t.current), ((_t$current2 = t.current) === null || _t$current2 === void 0 ? void 0 : _t$current2.layoutId) !== ((_t$next = t.next) === null || _t$next === void 0 ? void 0 : _t$next.layoutId) && o.push(t.next), o.reduce(function (t, o) {
                      return [].concat(_toConsumableArray(t), [e.prepareLayoutXlf(o)]);
                    }, []);
                  }());
                case 4:
                  o = _context9.sent;
                  return _context9.abrupt("return", new Promise(function (n) {
                    e.layouts = o, e.currentLayout = e.layouts[0], Boolean(e.layouts[1]) ? e.nextLayout = e.layouts[1] : e.nextLayout = e.layouts[0], e.currentLayoutIndex = t.currentLayoutIndex, e.layouts[e.currentLayoutIndex] = e.currentLayout, n(e);
                  }));
                case 6:
                case "end":
                  return _context9.stop();
              }
            }, _callee9);
          }))();
        }
      });
    return a.bootstrap(), a;
  };
}();
//# sourceMappingURL=xibo-layout-renderer.min.js.map
