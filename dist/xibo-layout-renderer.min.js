var XiboLayoutRenderer=function(e){"use strict";let t=()=>({emit(e,...t){for(let o=0,n=this.events[e]||[],i=n.length;o<i;o++)n[o](...t)},events:{},on(e,t){return(this.events[e]||=[]).push(t),()=>{this.events[e]=this.events[e]?.filter((e=>t!==e))}}});const o={getResourceUrl:"/playlist/widget/resource/:regionId/:id",xlfUrl:"/layout/xlf/:layoutId",layoutBackgroundDownloadUrl:"/layout/background/:id",layoutPreviewUrl:"/layout/preview/[layoutCode]",libraryDownloadUrl:"/library/download/:id",loaderUrl:"/theme/default/img/loader.gif",idCounter:0,inPreview:!0,appHost:null,platform:"CMS"},n={id:null,layoutId:null,sw:0,sh:0,xw:0,xh:0,zIndex:0,scaleFactor:1,sWidth:0,sHeight:0,offsetX:0,offsetY:0,bgColor:"",bgImage:"",bgId:"",containerName:"",layoutNode:null,regionMaxZIndex:0,ready:!1,regionObjects:[],drawer:[],allExpired:!1,regions:[],actions:[],options:o,done:!1,allEnded:!1,path:"",prepareLayout(){},parseXlf(){},run(){},on:(e,t)=>({}),regionExpired(){},end(){},regionEnded(){},stopAllMedia:()=>Promise.resolve()};function i(e){return e.idCounter>500&&(e.idCounter=0),e.idCounter=e.idCounter+1,e.idCounter}const a=({mediaType:e,containerName:t})=>{let o=t;return"video"===e?o+="-vid":"audio"===e&&(o+="-aud"),o},r=e=>null===e?"":String(e).charAt(0).toUpperCase()+String(e).substring(1);async function l(e,t){const o=await fetch(e,{mode:"no-cors"});let n=new Blob;if("image"===t)n=new Blob;else if("video"===t)n=await o.blob();else if("audio"===t){const t=await o.arrayBuffer();n=new Blob([t],{type:s(d(e))})}return console.log({blob:n}),URL.createObjectURL(n)}function d(e){const t=String(e).split(".");return t[t.length-1]}function s(e){const t={mp3:"audio/mp3",wav:"audio/wav",ogg:"audio/ogg"};if(Boolean(t[e]))return t[e]}const c={layout:n,id:"",regionId:"",xml:null,mediaObjects:[],mediaObjectsActions:[],currentMedia:-1,complete:!1,containerName:"",ending:!1,ended:!1,oneMedia:!1,oldMedia:void 0,curMedia:void 0,nxtMedia:void 0,currentMediaIndex:0,totalMediaObjects:0,ready:!1,options:{},sWidth:0,sHeight:0,offsetX:0,offsetY:0,zIndex:0,index:-1,prepareRegion(){},playNextMedia(){},transitionNodes(){},finished(){},run(){},end(){},exitTransition(){},exitTransitionComplete(){},on:(e,t)=>({}),prepareMediaObjects(){}},u={region:c,xml:null,id:"",index:0,idCounter:0,containerName:"",html:null,iframe:null,iframeName:"",mediaType:"",render:"html",attachedAudio:!1,singlePlay:!1,timeoutId:setTimeout((()=>{}),100),ready:!0,checkIframeStatus:!1,loadIframeOnRun:!1,tempSrc:"",finished:!1,schemaVersion:"1",type:"",duration:0,useDuration:Boolean(0),fileId:"",options:{},divWidth:0,divHeight:0,url:null,loop:!1,run(){},init(){},stop:()=>Promise.resolve(),on:(e,t)=>({})},p=(e,t)=>({keyframes:[{display:"in"===t?"none":"block"},{display:"out"===t?"none":"block"}],timing:{duration:e}}),m=e=>({keyframes:[{opacity:1},{opacity:0,zIndex:-1}],timing:{duration:e,fill:"forwards"}}),y=(e,t,o)=>{const n=[{opacity:0},{opacity:1,zIndex:1}],i={duration:e,fill:"forwards"};return t&&Boolean(t.from)&&(n[0]={...t.from,...n[0]}),t&&Boolean(t.to)&&(n[1]={...t.to,...n[1]}),{keyframes:n,timing:i}},g=(e,t,o)=>{const n=[{opacity:1},{opacity:0,zIndex:-1}],i={duration:e,fill:"forwards"};return t&&Boolean(t.from)&&(n[0]={...t.from,...n[0]}),t&&Boolean(t.to)&&(n[1]={...t.to,...n[1]}),{keyframes:n,timing:i}},f=(e,t)=>{var o;return{fadeIn:(o=t.duration,{keyframes:[{opacity:0},{opacity:1}],timing:{duration:o,fill:"forwards"}}),fadeOut:m(t.duration),flyIn:y(t.duration,t.keyframes,t.direction),flyOut:g(t.duration,t.keyframes,t.direction),defaultIn:p(t.duration,"in"),defaultOut:p(t.duration,"out")}[e]},h=e=>{const t={from:{},to:{}},o=t=>"from"===t?"in"===e.trans?0:1:"out"===e.trans?1:0;switch(e.direction){case"N":default:t.from={opacity:o("from"),top:"in"===e.trans?`${e.height}px`:0},t.to={opacity:o("to"),top:"in"===e.trans?0:`-${e.height}px`};break;case"NE":t.from={opacity:o("from"),top:"in"===e.trans?`${e.height}px`:0,left:"in"===e.trans?`-${e.width}px`:0},t.to={opacity:o("to"),top:"in"===e.trans?0:`-${e.height}px`,left:"in"===e.trans?0:`${e.width}px`};break;case"E":t.from={opacity:o("from"),left:"in"===e.trans?`-${e.width}px`:0},t.to={opacity:o("to"),left:"in"===e.trans?0:`${e.width}px`};break;case"SE":t.from={opacity:o("from"),top:"in"===e.trans?`-${e.height}px`:0,left:"in"===e.trans?`-${e.width}px`:0},t.to={opacity:o("to"),top:"in"===e.trans?0:`${e.height}px`,left:"in"===e.trans?0:`${e.width}px`};break;case"S":t.from={opacity:o("from"),top:"in"===e.trans?`-${e.height}px`:0},t.to={opacity:o("to"),top:"in"===e.trans?0:`${e.height}px`};break;case"SW":t.from={opacity:o("from"),top:"in"===e.trans?`-${e.height}px`:0,left:"in"===e.trans?`${e.width}px`:0},t.to={opacity:o("to"),top:"in"===e.trans?0:`${e.height}px`,left:"in"===e.trans?0:`-${e.width}px`};break;case"W":t.from={opacity:o("from"),left:"in"===e.trans?`${e.width}px`:0},t.to={opacity:o("to"),left:"in"===e.trans?0:`-${e.width}px`};break;case"NW":t.from={opacity:o("from"),top:"in"===e.trans?`${e.height}px`:0,left:"in"===e.trans?`${e.width}px`:0},t.to={opacity:o("to"),top:"in"===e.trans?0:`-${e.height}px`,left:"in"===e.trans?0:`-${e.width}px`}}return t};function x(e,o,n,d,s){const c={region:e,mediaId:o,xml:n,options:d};let p=null,m=0;const y=t(),g={...u,...c},x=e=>{p=setInterval((()=>{m++,m>e.duration&&e.emitter?.emit("end",e)}),1e3),console.log("Showing Media "+e.id+" for "+e.duration+"s of Region "+e.region.regionId)};return y.on("start",(function(e){"video"===e.mediaType?(function(e){return{init(){const t=document.getElementById(a(e));t&&(t.onloadstart=()=>{console.log(`${r(e.mediaType)} for media > ${e.id} has started loading data . . .`)},t.onloadeddata=()=>{t.readyState>=2&&console.log(`${r(e.mediaType)} data for media > ${e.id} has been fully loaded . . .`)},t.oncanplay=()=>{console.log(`${r(e.mediaType)} for media > ${e.id} can be played . . .`);const o=t.play();void 0!==o&&o.then((()=>{console.log("autoplay started . . .")})).catch((e=>{t.muted=!0,t.play()}))},t.onplaying=()=>{console.log(`${r(e.mediaType)} for media > ${e.id} is now playing . . .`)},0===e.duration&&(t.ondurationchange=()=>{console.log("Showing Media "+e.id+" for "+t.duration+"s of Region "+e.region.regionId)},t.onended=()=>{console.log(`${r(e.mediaType)} for media > ${e.id} has ended playing . . .`),e.emitter?.emit("end",e)}))}}}(e).init(),e.duration>0&&x(e)):"audio"===e.mediaType?(function(e){return{init(){const t=document.getElementById(a(e));let o=null;if(t){t.onloadstart=()=>{console.log(`${r(e.mediaType)} for media > ${e.id} has started loading data . . .`)},t.onloadeddata=()=>{t.readyState>=2&&console.log(`${r(e.mediaType)} data for media > ${e.id} has been fully loaded . . .`)},t.oncanplay=()=>{console.log(`${r(e.mediaType)} for media > ${e.id} can be played . . .`)},t.onplaying=()=>{console.log(`${r(e.mediaType)} for media > ${e.id} is now playing . . .`),null!==o&&o.remove()};const n=t.play();void 0!==n&&n.then((()=>{console.log("autoplay started . . .")})).catch((e=>{"NotAllowedError"===e.name&&(o=document.createElement("button"),o.classList.add("play-audio-btn"),o.textContent="Play Audio",o.addEventListener("click",(()=>{t.muted=!1,t.play()})),t.parentNode?.insertBefore(o,t.nextSibling))})),0===e.duration&&(t.ondurationchange=()=>{console.log("Showing Media "+e.id+" for "+t.duration+"s of Region "+e.region.regionId)},t.onended=()=>{console.log(`${r(e.mediaType)} for media > ${e.id} has ended playing . . .`),e.emitter?.emit("end",e)})}}}}(e).init(),e.duration>0&&x(e)):x(e)})),y.on("end",(function(e){p&&(clearInterval(p),m=0),e.region.playNextMedia()})),g.init=function(){const e=g;e.id=c.mediaId,e.idCounter=i(c.options),e.containerName=`M-${e.id}-${e.idCounter}`,e.iframeName=`${e.containerName}-iframe`,e.mediaType=e.xml?.getAttribute("type")||"",e.render=e.xml?.getAttribute("render")||"",e.duration=parseInt(e.xml?.getAttribute("duration"))||0,e.options={...c.options,mediaId:o};const t=document.createElement("iframe"),n=e.xml?.getElementsByTagName("options");if(n)for(let t of Array.from(n)){const o=t.children;for(let t of Array.from(o))e.options[t.nodeName.toLowerCase()]=t.textContent}"1"===e.options.showfullscreen?(e.divWidth=e.region.layout.sWidth,e.divHeight=e.region.layout.sHeight):(e.divWidth=e.region.sWidth,e.divHeight=e.region.sHeight),t.scrolling="no",t.id=e.iframeName,t.width=`${e.divWidth}px`,t.height=`${e.divHeight}px`,t.style.cssText="border: 0; visibility: hidden;";const r=a(e);let l=document.getElementById(r);null===l&&(l="video"===e.mediaType?document.createElement("video"):"audio"===e.mediaType?new Audio:document.createElement("div"),l.id=r),l.className="media--item",l.style.cssText=`\n            display: none;\n            width: ${e.divWidth}px;\n            height: ${e.divHeight}px;\n            position: absolute;\n            background-size: contain;\n            background-repeat: no-repeat;\n            background-position: center;\n        `,document.getElementById(`${e.region.containerName}`);const d={...s.config.config,regionOptions:e.region.options,layoutId:e.region.layout.layoutId,regionId:e.region.id,mediaId:e.id,scaleFactor:e.region.layout.scaleFactor};"image"===e.mediaType&&(d.mediaType=e.mediaType);const u=function(e,t){let o=t.regionOptions.getResourceUrl.replace(":regionId",t.regionId).replace(":id",t.mediaId)+"?preview=1&layoutPreview=1&scale_override="+t.scaleFactor;return"chromeOS"===e&&(o=t.cmsUrl+o),o}(s.config.platform,d);if(e.url=u,e.loop="1"==e.options.loop||"1"==e.region.options.loop&&1==e.region.totalMediaObjects,t.src=`${u}&width=${e.divWidth}&height=${e.divHeight}`,"html"===e.render||"ticker"===e.mediaType)e.checkIframeStatus=!0,e.iframe=t;else if("image"===e.mediaType)if("stretch"===e.options.scaletype)l.style.cssText=l.style.cssText.concat("background-size: 100% 100%;");else if("fit"===e.options.scaletype)l.style.cssText=l.style.cssText.concat("background-size: cover;");else{const t=""==e.options.align?"center":e.options.align,o=""==e.options.valign||"middle"==e.options.valign?"center":e.options.valign;l.style.cssText=l.style.cssText.concat(`background-position: ${t} ${o}`)}else if("video"===e.mediaType){const t=l;t.preload="auto",t.textContent="Unsupported Video",Boolean(e.options.mute)&&(t.muted="1"===e.options.mute),Boolean(e.options.scaletype)&&"stretch"===e.options.scaletype&&(t.style.objectFit="fill"),t.playsInline=!0,e.loop&&(t.loop=!0),l=t}else if("audio"===e.mediaType){const t=l;t.preload="auto",t.textContent="Unsupported Audio",t.autoplay=!0,e.loop&&(t.loop=!0),l=t}if(("html"===e.render||"ticker"===e.mediaType)&&"1"===e.options.durationisperitem){const t=new RegExp("\x3c!-- NUMITEMS=(.*?) --\x3e");(async()=>{let o=await async function(e){return fetch(e).then((e=>e.json())).catch((e=>{console.log(e)}))}(`${u}&width=${e.divWidth}&height=${e.divHeight}`);console.log({html:o});const n=t.exec(o);null!==n&&(e.duration=parseInt(String(e.duration))*parseInt(n[1]))})()}if(Boolean(e.options.transin)&&Boolean(e.options.transinduration)){const t=Number(e.options.transinduration),o=f("fadeIn",{duration:t});l.animate(o.keyframes,o.timing)}e.html=l,e.iframe&&e.checkIframeStatus&&(e.ready=!1,l.innerHTML="",l.appendChild(e.iframe),e.iframe&&e.iframe.addEventListener("load",(function(){if(e.ready=!0,e.iframe){const t=e.iframe.style.cssText;e.iframe.style.cssText=t?.concat("visibility: visible;")}})))},g.run=function(){const e=g;let t=1,o="E";Boolean(e.options.transinduration)&&(t=Number(e.options.transinduration)),Boolean(e.options.transindirection)&&(o=e.options.transindirection);let n={duration:t},i=f("defaultIn",{duration:n.duration});if(Boolean(e.options.transin)){let t=e.options.transin;"fly"===t&&(t=`${t}In`,n.keyframes=h({trans:"in",direction:o,height:e.divHeight,width:e.divWidth})),i=f(t,n)}const r=()=>{const t=document.getElementById(`${e.region.containerName}`);return e.region.complete&&!e.region.layout.allEnded?(t&&t.insertBefore(e.html,t.lastElementChild),e.html):null};(async()=>{let t=a(e),o=document.getElementById(t);const n="CMS"===s.config.platform;null===o&&(o=r()),null!==o&&(o.style.setProperty("display","block"),Boolean(e.options.transin)&&o.animate(i.keyframes,i.timing),"image"===e.mediaType&&null!==e.url?o.style.setProperty("background-image",`url(${n?await async function(e){return fetch(e,{mode:"no-cors"}).then((e=>e.blob())).then((e=>new Promise(((t,o)=>{const n=new FileReader;n.onloadend=()=>t(n.result),n.onerror=o,n.readAsDataURL(e)}))))}(e.url):e.url}`):("video"===e.mediaType&&null!==e.url||"audio"===e.mediaType&&null!==e.url)&&(o.src=n?await l(e.url,e.mediaType):e.url),e.emitter?.emit("start",e))})()},g.stop=async function(){const e=g,t=document.getElementById(a(e));t&&(t.style.display="none",t.remove())},g.on=function(e,t){return y.on(e,t)},g.emitter=y,g.init(),g}const b=function(e){e.preventDefault(),history.go(0)};async function I(t){let o=window.location.origin,n=o+t.xlfUrl;return"CMS"===t.platform?n=o+t.xlfUrl:"chromeOS"===t.platform?n=t.xlfUrl:"CMS"!==t.platform&&null!==t.appHost&&(n=t.appHost+t.xlfUrl),await e.get(n).then((e=>e?.data)).catch((e=>function(e,t){throw console.error(e),500==e.response.status?new Error(e.response.data):new Error("Unknown Error")}(e)))}function v(e){let t,o,{inputLayouts:i,currentLayout:a,nextLayout:r,currentLayoutIndex:l}=e.xlr;const d=i.length>0;let s=l,c=s+1;if(void 0===a&&void 0===r){let e;if(d){let a={...n};e=i[s],t={...n,...e},i.length>1?(a={...a,...i[c]},o=a):o=t,t.id=e.layoutId,a&&(o.id=a.layoutId)}}else d&&(t=r,s=function(e,t){let o=e.reduce(((e,t,o)=>(e[Number(t.layoutId)]={...t,index:o},e)),{});return null!==t&&t?o[t]:o}(i,t?.layoutId).index,c=s+1,i.length>1&&c<i.length&&(o=Boolean(e.xlr.layouts[c])?e.xlr.layouts[c]:{...n,...i[c]}),void 0===o&&(o=e.xlr.layouts[0]));return{currentLayoutIndex:s,inputLayouts:e.xlr.inputLayouts,current:t,next:o}}function w(e,r,l,d){const s={data:e,options:r,layout:d||n},u=t();u.on("start",(e=>{e.done=!1,console.log("Layout start emitted > Layout ID > ",e.id)})),u.on("end",(e=>{console.log("Ending layout with ID of > ",e.layoutId),e.done=!0;const t=document.getElementById(e.containerName);console.log({$layout:t}),null!==t&&t.remove(),"CMS"!==l.config.platform&&l.prepareLayouts().then((e=>{l.playSchedules(e)}))}));const p={...s.layout,options:s.options,emitter:u};return p.on=function(e,t){return u.on(e,t)},p.run=function(){const e=p,t=document.getElementById(`${e.containerName}`),o=document.getElementById(`splash_${e.id}`);t&&(t.style.display="block"),o&&(o.style.display="none"),console.log("Layout running > Layout ID > ",e.id),console.log("Layout Regions > ",e.regions);for(let t=0;t<e.regions.length;t++)e.regions[t].run()},p.parseXlf=function(){const e=p,{data:n,options:r}=s;e.containerName="L"+e.id+"-"+i(r),e.regions=[];let d=document.getElementById(e.containerName);null===d&&(d=document.createElement("div"),d.id=e.containerName);let u=document.getElementById("screen_container");u&&u.appendChild(d),d&&(d.style.display="none",d.style.outline="red solid thin"),e.layoutNode=n,e.sw=u?.offsetWidth||0,e.sh=u?.offsetHeight||0,e.xw=Number(e.layoutNode?.firstElementChild?.getAttribute("width")),e.xh=Number(e.layoutNode?.firstElementChild?.getAttribute("height")),e.zIndex=Number(e.layoutNode?.firstElementChild?.getAttribute("zindex"))||0,e.scaleFactor=Math.min(e.sw/e.xw,e.sh/e.xh),e.sWidth=Math.round(e.xw*e.scaleFactor),e.sHeight=Math.round(e.xh*e.scaleFactor),e.offsetX=Math.abs(e.sw-e.sWidth)/2,e.offsetY=Math.abs(e.sh-e.sHeight)/2;const m=`\n            width: ${e.sWidth}px;\n            height: ${e.sHeight}px;\n            position: absolute;\n            left: ${e.offsetX}px;\n            top: ${e.offsetY}px;\n        `;if(d&&(d.style.cssText=m),d&&null!==e.zIndex&&(d.style.cssText=m.concat(`z-index: ${e.zIndex};`)),e.bgColor=e.layoutNode?.firstElementChild?.getAttribute("bgcolor")||"",e.bgImage=e.layoutNode?.firstElementChild?.getAttribute("background")||"",""!==e.bgImage&&void 0!==e.bgImage){e.bgId=e.bgImage.substring(0,e.bgImage.indexOf("."));let t=r.layoutBackgroundDownloadUrl.replace(":id",e.id)+"?preview=1";d&&(d.style.cssText=m.concat(`\n                    background: url('${t}&width=${e.sWidth}&height=${e.sHeight}&dynamic&proportional=0');\n                    backgroundRepeat: "no-repeat";\n                    backgroundSize: ${e.sWidth}px ${e.sHeight}px;\n                    backgroundPosition: "0px 0px";\n                `))}d&&(d.style.cssText=m.concat("background-color: layout.bgColor;")),d&&void 0!==l.currentLayoutId&&l.currentLayoutId!==e.id&&(d.style.cssText=d.style.cssText.concat("display: none;"));const y=Array.from(e?.layoutNode?.getElementsByTagName("region")||[]);Array.from(y).forEach(((n,d)=>{const s=function(e,n,r,l,d){const s={layout:e,xml:n,regionId:r,options:l},u=t();let p={...c,...s};return p.prepareRegion=function(){const e=p,{layout:t,options:n}=e;e.id=s.regionId,e.options={...o,...s.options},e.containerName=`R-${e.id}-${i(e.options)}`,e.xml=s.xml,e.mediaObjects=[],e.sWidth=e.xml&&Number(e.xml?.getAttribute("width"))*t.scaleFactor,e.sHeight=e.xml&&Number(e.xml?.getAttribute("height"))*t.scaleFactor,e.offsetX=e.xml&&Number(e.xml?.getAttribute("left"))*t.scaleFactor,e.offsetY=e.xml&&Number(e.xml?.getAttribute("top"))*t.scaleFactor,e.zIndex=e.xml&&Number(e.xml?.getAttribute("zindex"))*t.scaleFactor;const a=e.xml?.getElementsByTagName("options");if(a)for(let t of Array.from(a)){const o=t.children;for(let t of Array.from(o))e.options[t.nodeName.toLowerCase()]=t.textContent}let r=document.getElementById(e.containerName);const l=document.getElementById(`${e.layout.containerName}`);null===r&&(r=document.createElement("div"),r.id=e.containerName),l&&l.appendChild(r),r.style.cssText=`\n            width: ${e.sWidth}px;\n            height: ${e.sHeight}px;\n            position: absolute;\n            left: ${e.offsetX}px;\n            top: ${e.offsetY}px;\n        `,r.className="region--item";const c=Array.from(e.xml.getElementsByTagName("media"));e.totalMediaObjects=c.length,Array.from(c).forEach(((t,o)=>{const i=x(e,t?.getAttribute("id")||"",t,n,d);i.index=o,e.mediaObjects.push(i)})),e.prepareMediaObjects()},p.finished=function(){const e=p;console.log("Region::finished called . . . ",e.id),e.complete=!0,e.layout.regions[p.index]=p,e.layout.regionExpired()},p.prepareMediaObjects=function(){const e=p;let t;if(e.mediaObjects.length>0){e.curMedia?e.oldMedia=e.curMedia:e.oldMedia=void 0,e.currentMediaIndex>=e.mediaObjects.length&&(e.currentMediaIndex=0),e.curMedia=e.mediaObjects[e.currentMediaIndex],t=e.currentMediaIndex+1,(t>=e.mediaObjects.length||!Boolean(e.mediaObjects[t])&&1===e.mediaObjects.length)&&(t=0),Boolean(e.mediaObjects[t])&&(e.nxtMedia=e.mediaObjects[t]);const o=document.getElementById(`${e.containerName}`);e.curMedia&&o&&o.insertBefore(e.curMedia.html,o.lastElementChild),e.nxtMedia&&o&&o.insertBefore(e.nxtMedia.html,o.lastElementChild)}},p.run=function(){console.log("Called Region::run > ",p.id),p.curMedia&&p.transitionNodes(p.oldMedia,p.curMedia)},p.transitionNodes=function(e,t){const o=p;let n=1,i="E";if(t){e&&Boolean(e.options.transoutduration)&&(n=Number(e.options.transoutduration)),e&&Boolean(e.options.transoutdirection)&&(i=e.options.transoutdirection);let r,l={duration:n},d=f("defaultOut",{duration:l.duration});e&&Boolean(e.options.transout)&&(r=e.options.transout,"fly"===r&&(r=`${r}Out`,l.keyframes=h({trans:"out",direction:i,height:e.divHeight,width:e.divWidth})),d=f(r,l));const s=new Promise((t=>{if(e){const i=document.getElementById(a(e));if(i){const a=()=>{i.style.setProperty("display","none"),i.remove()};let l;Boolean(e.options.transout)&&(l=i.animate(d.keyframes,d.timing)),Boolean(e.options.transout)&&o.totalMediaObjects>1?"flyOut"===r?l&&l.finished.then((()=>{t(!0),l?.effect?.updateTiming({fill:"none"}),a()})):(setTimeout(a,n/2),t(!0)):(a(),t(!0))}}}));e?s.then((e=>{e&&t.run()})):t.run()}},p.playNextMedia=function(){const e=p;e.ended||e.currentMediaIndex===e.mediaObjects.length-1&&(e.finished(),e.layout.allEnded)||e.complete&&"html"===e.curMedia?.render||e.complete&&1===e.mediaObjects.length&&"html"!==e.curMedia?.render&&"image"===e.curMedia?.mediaType&&!e.curMedia?.loop||(e.currentMediaIndex=e.currentMediaIndex+1,e.prepareMediaObjects(),e.transitionNodes(e.oldMedia,e.curMedia))},p.end=function(){const e=p;e.ending=!0,e.layout.regions[e.index]=e,console.log("Calling Region::end ",e),e.exitTransition()},p.exitTransition=function(){const e=p,t=document.getElementById(`${e.containerName}`);t&&(t.style.display="none"),console.log("Called Region::exitTransition ",e.id),e.exitTransitionComplete()},p.exitTransitionComplete=function(){const e=p;console.log("Called Region::exitTransitionComplete ",e.id),e.ended=!0,e.layout.regions[e.index]=e,e.layout.regionEnded()},p.on=function(e,t){return u.on(e,t)},p.emitter=u,p.prepareRegion(),p}(e,n,n?.getAttribute("id")||"",r,l);s.index=d,e.regions.push(s)}))},p.prepareLayout=function(){p.parseXlf()},p.regionExpired=function(){const e=p;e.allExpired=!0;for(let t of e.regions)t.complete||(e.allExpired=!1);e.allExpired&&e.end()},p.regionEnded=function(){const e=p;e.allEnded=!0;for(var t=0;t<e.regions.length;t++)e.regions[t].ended||(e.allEnded=!1);e.allEnded&&e.stopAllMedia().then((()=>{if(console.log("starting to end layout . . ."),"CMS"===l.config.platform){const e=document.getElementById("play_ended"),t=document.getElementById("screen_container");if(t){for(;t.firstChild;)t.removeChild(t.firstChild);t.style.display="none"}e&&(e.style.display="block")}e.emitter?.emit("end",e)}))},p.end=function(){console.log("Executing Layout::end and Calling Region::end ",p);for(let e of p.regions)e.end()},p.stopAllMedia=function(){return console.log("Stopping all media . . ."),new Promise((async e=>{for(var t=0;t<p.regions.length;t++)for(var o=p.regions[t],n=0;n<o.mediaObjects.length;n++){var i=o.mediaObjects[n];await i.stop()}e()}))},p.prepareLayout(),p}var $;!function(e){e[e.CURRENT=0]="CURRENT",e[e.NEXT=1]="NEXT"}($||($={}));const E={inputLayouts:[],config:o,layouts:[],currentLayoutIndex:0,currentLayoutId:null,currentLayout:void 0,nextLayout:void 0,bootstrap(){},init:()=>Promise.resolve({}),playSchedules(){},prepareLayoutXlf:(e,t)=>Promise.resolve({}),prepareLayouts:()=>Promise.resolve({})};return function(e,t){const i={inputLayouts:e,options:t},a={...E,bootstrap(){this.inputLayouts=Array.isArray(i.inputLayouts)?i.inputLayouts:[i.inputLayouts],this.config=JSON.parse(JSON.stringify({...o,...i.options}))},init(){return new Promise((e=>{!function(e){let t=e;const o=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div"),a=document.createElement("a");o.className="player-preview",o.id="player_container",n.className="screen-preview",n.id="screen_container",i.className="preview-ended",i.id="play_ended",i.style.display="none",a.id="play_back_preview",a.className="play-back-preview",a.style.cssText="text-decoration: none; color: #ffffff;",a.innerHTML="Play again?",a.removeEventListener("click",b),a.addEventListener("click",b),t||(t=document.body),t&&null===t.querySelector("#player_container")&&(t.insertBefore(o,t.firstChild),null===o.querySelector("#screen_container")&&o.appendChild(n),null===o.querySelector("#play_ended")&&(o.appendChild(i),null===i.querySelector("a")&&i.appendChild(a)))}(document.querySelector(".preview-canvas")),this.prepareLayouts().then((t=>{e(t)}))}))},playSchedules(e){void 0!==e.currentLayout&&(e.currentLayout.emitter?.emit("start",e.currentLayout),e.currentLayout.run())},async prepareLayoutXlf(e){const t=this;let a,r,l=Object.assign({},o);if(l={...l,...i.options},"CMS"===t.config.platform&&e&&Boolean(e.layoutId)?l.xlfUrl=l.xlfUrl.replace(":layoutId",String(e.layoutId)):"chromeOS"===t.config.platform&&(l.xlfUrl=e.path),e&&null===e.layoutNode){a=await I(l);const e=new window.DOMParser;r=e.parseFromString(a,"text/xml")}else r=e&&e.layoutNode;return new Promise((o=>{const i=n;i.id=Number(e.layoutId),i.layoutId=Number(e.layoutId),i.options=l,o(w(r,l,t,i))}))},async prepareLayouts(){const e=this,t=v({xlr:e});e.currentLayoutId=t.current?.layoutId;const o=await Promise.all([e.prepareLayoutXlf(t.current,$.CURRENT),e.prepareLayoutXlf(t.next,$.NEXT)]);return new Promise((n=>{e.layouts=o,e.currentLayout=e.layouts[0],e.nextLayout=e.layouts[1],e.currentLayoutIndex=t.currentLayoutIndex,e.layouts[e.currentLayoutIndex]=e.currentLayout,n(e)}))}};return a.bootstrap(),a}}(axios);
//# sourceMappingURL=xibo-layout-renderer.min.js.map
