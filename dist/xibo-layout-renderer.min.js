var XiboLayoutRenderer=function(){"use strict";const e={getResourceUrl:"/playlist/widget/resource/:regionId/:id",xlfUrl:"/layout/xlf/:layoutId",layoutBackgroundDownloadUrl:"/layout/background/:id",layoutPreviewUrl:"/layout/preview/[layoutCode]",libraryDownloadUrl:"/library/download/:id",loaderUrl:"/theme/default/img/loader.gif",idCounter:0,inPreview:!0,appHost:null},t={id:"",layoutId:"",sw:0,sh:0,xw:0,xh:0,zIndex:0,scaleFactor:1,sWidth:0,sHeight:0,offsetX:0,offsetY:0,bgColor:"",bgImage:"",bgId:"",containerName:"",layoutNode:null,regionMaxZIndex:0,ready:!1,regionObjects:[],drawer:[],allExpired:!1,regions:[],actions:[],options:e,done:!1,allEnded:!1,prepareLayout(){},parseXlf(){},run(){},on:(e,t)=>({}),regionExpired(){},end(){},regionEnded(){},stopAllMedia:()=>Promise.resolve()};let o=()=>({emit(e,...t){for(let o=0,n=this.events[e]||[],i=n.length;o<i;o++)n[o](...t)},events:{},on(e,t){return(this.events[e]||=[]).push(t),()=>{this.events[e]=this.events[e]?.filter((e=>t!==e))}}});function n(e){return e.idCounter>500&&(e.idCounter=0),e.idCounter=e.idCounter+1,e.idCounter}const i=({mediaType:e,containerName:t})=>{let o=t;return"video"===e?o+="-vid":"audio"===e&&(o+="-aud"),o},a=e=>null===e?"":String(e).charAt(0).toUpperCase()+String(e).substring(1);async function r(e,t){const o=await fetch(e);let n=new Blob;if("video"===t)n=await o.blob();else if("audio"===t){const t=await o.arrayBuffer();n=new Blob([t],{type:l(d(e))})}return URL.createObjectURL(n)}function d(e){const t=String(e).split(".");return t[t.length-1]}function l(e){const t={mp3:"audio/mp3",wav:"audio/wav",ogg:"audio/ogg"};if(Boolean(t[e]))return t[e]}const s={layout:t,id:"",regionId:"",xml:null,mediaObjects:[],mediaObjectsActions:[],currentMedia:-1,complete:!1,containerName:"",ending:!1,ended:!1,oneMedia:!1,oldMedia:void 0,curMedia:void 0,nxtMedia:void 0,currentMediaIndex:0,totalMediaObjects:0,ready:!1,options:{},sWidth:0,sHeight:0,offsetX:0,offsetY:0,zIndex:0,index:-1,prepareRegion(){},playNextMedia(){},transitionNodes(){},finished(){},run(){},end(){},exitTransition(){},exitTransitionComplete(){},on:(e,t)=>({}),prepareMediaObjects(){}},c={region:s,xml:null,id:"",index:0,idCounter:0,containerName:"",html:null,iframe:null,iframeName:"",mediaType:"",render:"html",attachedAudio:!1,singlePlay:!1,timeoutId:setTimeout((()=>{}),100),ready:!0,checkIframeStatus:!1,loadIframeOnRun:!1,tempSrc:"",finished:!1,schemaVersion:"1",type:"",duration:0,useDuration:Boolean(0),fileId:"",options:{},divWidth:0,divHeight:0,url:null,loop:!1,run(){},init(){},stop:()=>Promise.resolve(),on:(e,t)=>({})},u=(e,t)=>({keyframes:[{display:"in"===t?"none":"block"},{display:"out"===t?"none":"block"}],timing:{duration:e}}),p=e=>({keyframes:[{opacity:1},{opacity:0,zIndex:-1}],timing:{duration:e,fill:"forwards"}}),m=(e,t,o)=>{const n=[{opacity:0},{opacity:1,zIndex:1}],i={duration:e,fill:"forwards"};return t&&Boolean(t.from)&&(n[0]={...t.from,...n[0]}),t&&Boolean(t.to)&&(n[1]={...t.to,...n[1]}),{keyframes:n,timing:i}},y=(e,t,o)=>{const n=[{opacity:1},{opacity:0,zIndex:-1}],i={duration:e,fill:"forwards"};return t&&Boolean(t.from)&&(n[0]={...t.from,...n[0]}),t&&Boolean(t.to)&&(n[1]={...t.to,...n[1]}),{keyframes:n,timing:i}},g=(e,t)=>{var o;return{fadeIn:(o=t.duration,{keyframes:[{opacity:0},{opacity:1}],timing:{duration:o,fill:"forwards"}}),fadeOut:p(t.duration),flyIn:m(t.duration,t.keyframes,t.direction),flyOut:y(t.duration,t.keyframes,t.direction),defaultIn:u(t.duration,"in"),defaultOut:u(t.duration,"out")}[e]},f=e=>{const t={from:{},to:{}},o=t=>"from"===t?"in"===e.trans?0:1:"out"===e.trans?1:0;switch(e.direction){case"N":default:t.from={opacity:o("from"),top:"in"===e.trans?`${e.height}px`:0},t.to={opacity:o("to"),top:"in"===e.trans?0:`-${e.height}px`};break;case"NE":t.from={opacity:o("from"),top:"in"===e.trans?`${e.height}px`:0,left:"in"===e.trans?`-${e.width}px`:0},t.to={opacity:o("to"),top:"in"===e.trans?0:`-${e.height}px`,left:"in"===e.trans?0:`${e.width}px`};break;case"E":t.from={opacity:o("from"),left:"in"===e.trans?`-${e.width}px`:0},t.to={opacity:o("to"),left:"in"===e.trans?0:`${e.width}px`};break;case"SE":t.from={opacity:o("from"),top:"in"===e.trans?`-${e.height}px`:0,left:"in"===e.trans?`-${e.width}px`:0},t.to={opacity:o("to"),top:"in"===e.trans?0:`${e.height}px`,left:"in"===e.trans?0:`${e.width}px`};break;case"S":t.from={opacity:o("from"),top:"in"===e.trans?`-${e.height}px`:0},t.to={opacity:o("to"),top:"in"===e.trans?0:`${e.height}px`};break;case"SW":t.from={opacity:o("from"),top:"in"===e.trans?`-${e.height}px`:0,left:"in"===e.trans?`${e.width}px`:0},t.to={opacity:o("to"),top:"in"===e.trans?0:`${e.height}px`,left:"in"===e.trans?0:`-${e.width}px`};break;case"W":t.from={opacity:o("from"),left:"in"===e.trans?`${e.width}px`:0},t.to={opacity:o("to"),left:"in"===e.trans?0:`-${e.width}px`};break;case"NW":t.from={opacity:o("from"),top:"in"===e.trans?`${e.height}px`:0,left:"in"===e.trans?`${e.width}px`:0},t.to={opacity:o("to"),top:"in"===e.trans?0:`-${e.height}px`,left:"in"===e.trans?0:`-${e.width}px`}}return t};function h(e,t,d,l){const s={region:e,mediaId:t,xml:d,options:l};let u=null,p=0;const m=o(),y={...c,...s},h=e=>{u=setInterval((()=>{p++,p>e.duration&&e.emitter?.emit("end",e)}),1e3),console.log("Showing Media "+e.id+" for "+e.duration+"s of Region "+e.region.regionId)};return m.on("start",(function(e){"video"===e.mediaType?(function(e){return{init(){const t=document.getElementById(i(e));t&&(t.onloadstart=()=>{console.log(`${a(e.mediaType)} for media > ${e.id} has started loading data . . .`)},t.onloadeddata=()=>{t.readyState>=2&&console.log(`${a(e.mediaType)} data for media > ${e.id} has been fully loaded . . .`)},t.oncanplay=()=>{console.log(`${a(e.mediaType)} for media > ${e.id} can be played . . .`);const o=t.play();void 0!==o&&o.then((()=>{console.log("autoplay started . . .")})).catch((e=>{t.muted=!0,t.play()}))},t.onplaying=()=>{console.log(`${a(e.mediaType)} for media > ${e.id} is now playing . . .`)},0===e.duration&&(t.ondurationchange=()=>{console.log("Showing Media "+e.id+" for "+t.duration+"s of Region "+e.region.regionId)},t.onended=()=>{console.log(`${a(e.mediaType)} for media > ${e.id} has ended playing . . .`),e.emitter?.emit("end",e)}))}}}(e).init(),e.duration>0&&h(e)):"audio"===e.mediaType?(function(e){return{init(){const t=document.getElementById(i(e));let o=null;if(t){t.onloadstart=()=>{console.log(`${a(e.mediaType)} for media > ${e.id} has started loading data . . .`)},t.onloadeddata=()=>{t.readyState>=2&&console.log(`${a(e.mediaType)} data for media > ${e.id} has been fully loaded . . .`)},t.oncanplay=()=>{console.log(`${a(e.mediaType)} for media > ${e.id} can be played . . .`)},t.onplaying=()=>{console.log(`${a(e.mediaType)} for media > ${e.id} is now playing . . .`),null!==o&&o.remove()};const n=t.play();void 0!==n&&n.then((()=>{console.log("autoplay started . . .")})).catch((e=>{"NotAllowedError"===e.name&&(o=document.createElement("button"),o.classList.add("play-audio-btn"),o.textContent="Play Audio",o.addEventListener("click",(()=>{t.muted=!1,t.play()})),t.parentNode?.insertBefore(o,t.nextSibling))})),0===e.duration&&(t.ondurationchange=()=>{console.log("Showing Media "+e.id+" for "+t.duration+"s of Region "+e.region.regionId)},t.onended=()=>{console.log(`${a(e.mediaType)} for media > ${e.id} has ended playing . . .`),e.emitter?.emit("end",e)})}}}}(e).init(),e.duration>0&&h(e)):h(e)})),m.on("end",(function(e){u&&(clearInterval(u),p=0),e.region.playNextMedia()})),y.init=function(){const e=y;e.id=s.mediaId,e.idCounter=n(s.options),e.containerName=`M-${e.id}-${e.idCounter}`,e.iframeName=`${e.containerName}-iframe`,e.mediaType=e.xml?.getAttribute("type")||"",e.render=e.xml?.getAttribute("render")||"",e.duration=parseInt(e.xml?.getAttribute("duration"))||0,e.options={...s.options,mediaId:t};const o=document.createElement("iframe"),a=e.xml?.getElementsByTagName("options");if(a)for(let t of Array.from(a)){const o=t.children;for(let t of Array.from(o))e.options[t.nodeName.toLowerCase()]=t.textContent}"1"===e.options.showfullscreen?(e.divWidth=e.region.layout.sWidth,e.divHeight=e.region.layout.sHeight):(e.divWidth=e.region.sWidth,e.divHeight=e.region.sHeight),o.scrolling="no",o.id=e.iframeName,o.width=`${e.divWidth}px`,o.height=`${e.divHeight}px`,o.style.cssText="border: 0; visibility: hidden;";const r=i(e);let d=document.getElementById(r);null===d&&(d="video"===e.mediaType?document.createElement("video"):"audio"===e.mediaType?new Audio:document.createElement("div"),d.id=r),d.className="media--item",d.style.cssText=`\n            display: none;\n            width: ${e.divWidth}px;\n            height: ${e.divHeight}px;\n            position: absolute;\n            background-size: contain;\n            background-repeat: no-repeat;\n            background-position: center;\n        `,document.getElementById(`${e.region.containerName}`);const l=e.region.options.getResourceUrl.replace(":regionId",e.region.id).replace(":id",e.id)+"?preview=1&layoutPreview=1&scale_override="+e.region.layout.scaleFactor;if(e.url=l,e.loop="1"==e.options.loop||"1"==e.region.options.loop&&1==e.region.totalMediaObjects,o.src=`${l}&width=${e.divWidth}&height=${e.divHeight}`,"html"===e.render||"ticker"===e.mediaType)e.checkIframeStatus=!0,e.iframe=o;else if("image"===e.mediaType)if(d.style.cssText=d.style.cssText.concat(`background-image: url('${l}');`),"stretch"===e.options.scaletype)d.style.cssText=d.style.cssText.concat("background-size: 100% 100%;");else if("fit"===e.options.scaletype)d.style.cssText=d.style.cssText.concat("background-size: cover;");else{const t=""==e.options.align?"center":e.options.align,o=""==e.options.valign||"middle"==e.options.valign?"center":e.options.valign;d.style.cssText=d.style.cssText.concat(`background-position: ${t} ${o}`)}else if("video"===e.mediaType){const t=d;t.preload="auto",t.textContent="Unsupported Video",Boolean(e.options.mute)&&(t.muted="1"===e.options.mute),Boolean(e.options.scaletype)&&"stretch"===e.options.scaletype&&(t.style.objectFit="fill"),t.playsInline=!0,e.loop&&(t.loop=!0),d=t}else if("audio"===e.mediaType){const t=d;t.preload="auto",t.textContent="Unsupported Audio",t.autoplay=!0,e.loop&&(t.loop=!0),d=t}if(("html"===e.render||"ticker"===e.mediaType)&&"1"===e.options.durationisperitem){const t=new RegExp("\x3c!-- NUMITEMS=(.*?) --\x3e");(async()=>{let o=await(n=`${l}&width=${e.divWidth}&height=${e.divHeight}`,fetch(n).then((e=>e.json())).catch((e=>{console.log(e)})));var n;console.log({html:o});const i=t.exec(o);null!==i&&(e.duration=parseInt(String(e.duration))*parseInt(i[1]))})()}if(Boolean(e.options.transin)&&Boolean(e.options.transinduration)){const t=Number(e.options.transinduration),o=g("fadeIn",{duration:t});d.animate(o.keyframes,o.timing)}e.html=d,e.iframe&&e.checkIframeStatus&&(e.ready=!1,d.innerHTML="",d.appendChild(e.iframe),e.iframe&&e.iframe.addEventListener("load",(function(){if(e.ready=!0,e.iframe){const t=e.iframe.style.cssText;e.iframe.style.cssText=t?.concat("visibility: visible;")}})))},y.run=function(){const e=y;let t=1,o="E";Boolean(e.options.transinduration)&&(t=Number(e.options.transinduration)),Boolean(e.options.transindirection)&&(o=e.options.transindirection);let n={duration:t},a=g("defaultIn",{duration:n.duration});if(Boolean(e.options.transin)){let t=e.options.transin;"fly"===t&&(t=`${t}In`,n.keyframes=f({trans:"in",direction:o,height:e.divHeight,width:e.divWidth})),a=g(t,n)}const d=()=>{const t=document.getElementById(`${e.region.containerName}`);return e.region.complete&&!e.region.layout.allEnded?(t&&t.insertBefore(e.html,t.lastElementChild),e.html):null};(async()=>{let t=i(e),o=document.getElementById(t);null===o&&(o=d()),null!==o&&(o.style.setProperty("display","block"),Boolean(e.options.transin)&&o.animate(a.keyframes,a.timing),("video"===e.mediaType&&null!==e.url||"audio"===e.mediaType&&null!==e.url)&&(o.src=await r(e.url,e.mediaType)),e.emitter?.emit("start",e))})()},y.stop=async function(){const e=y,t=document.getElementById(i(e));t&&(t.style.display="none",t.remove())},y.on=function(e,t){return m.on(e,t)},y.emitter=m,y.init(),y}const x=function(e){e.preventDefault(),history.go(0)};function b(a,r,d,l){const c={data:a,options:r,layout:l||t},u=o();u.on("start",(e=>{e.done=!1,console.log("Layout start emitted > Layout ID > ",e.id)})),u.on("end",(e=>{console.log("Ending layout with ID of > ",e.layoutId),e.done=!0;const t=document.getElementById(e.containerName);console.log({$layout:t}),null!==t&&t.remove(),d.config.inPreview||d.prepareLayouts().then((e=>{d.playSchedules(e)}))}));const p={...c.layout,options:c.options,emitter:u};return p.on=function(e,t){return u.on(e,t)},p.run=function(){const e=p,t=document.getElementById(`${e.containerName}`),o=document.getElementById(`splash_${e.id}`);t&&(t.style.display="block"),o&&(o.style.display="none"),console.log("Layout running > Layout ID > ",e.id),console.log("Layout Regions > ",e.regions);for(let t=0;t<e.regions.length;t++)e.regions[t].run()},p.parseXlf=function(){const t=p,{data:a,options:r}=c;t.containerName="L"+t.id+"-"+n(r),t.regions=[];let l=document.getElementById(t.containerName);null===l&&(l=document.createElement("div"),l.id=t.containerName);let u=document.getElementById("screen_container");u&&u.appendChild(l),l&&(l.style.display="none",l.style.outline="red solid thin"),t.layoutNode=a,t.sw=u?.offsetWidth||0,t.sh=u?.offsetHeight||0,t.xw=Number(t.layoutNode?.firstElementChild?.getAttribute("width")),t.xh=Number(t.layoutNode?.firstElementChild?.getAttribute("height")),t.zIndex=Number(t.layoutNode?.firstElementChild?.getAttribute("zindex"))||0,t.scaleFactor=Math.min(t.sw/t.xw,t.sh/t.xh),t.sWidth=Math.round(t.xw*t.scaleFactor),t.sHeight=Math.round(t.xh*t.scaleFactor),t.offsetX=Math.abs(t.sw-t.sWidth)/2,t.offsetY=Math.abs(t.sh-t.sHeight)/2;const m=`\n            width: ${t.sWidth}px;\n            height: ${t.sHeight}px;\n            position: absolute;\n            left: ${t.offsetX}px;\n            top: ${t.offsetY}px;\n        `;if(l&&(l.style.cssText=m),l&&null!==t.zIndex&&(l.style.cssText=m.concat(`z-index: ${t.zIndex};`)),t.bgColor=t.layoutNode?.firstElementChild?.getAttribute("bgcolor")||"",t.bgImage=t.layoutNode?.firstElementChild?.getAttribute("background")||"",""!==t.bgImage&&void 0!==t.bgImage){t.bgId=t.bgImage.substring(0,t.bgImage.indexOf("."));let e=r.layoutBackgroundDownloadUrl.replace(":id",t.id)+"?preview=1";l&&(l.style.cssText=m.concat(`\n                    background: url('${e}&width=${t.sWidth}&height=${t.sHeight}&dynamic&proportional=0');\n                    backgroundRepeat: "no-repeat";\n                    backgroundSize: ${t.sWidth}px ${t.sHeight}px;\n                    backgroundPosition: "0px 0px";\n                `))}l&&(l.style.cssText=m.concat("background-color: layout.bgColor;")),l&&void 0!==d.currentLayoutId&&d.currentLayoutId!==t.id&&(l.style.cssText=l.style.cssText.concat("display: none;"));const y=Array.from(t?.layoutNode?.getElementsByTagName("region")||[]);Array.from(y).forEach(((a,d)=>{const l=function(t,a,r,d){const l={layout:t,xml:a,regionId:r,options:d},c=o();let u={...s,...l};return u.prepareRegion=function(){const t=u,{layout:o,options:i}=t;t.id=l.regionId,t.options={...e,...l.options},t.containerName=`R-${t.id}-${n(t.options)}`,t.xml=l.xml,t.mediaObjects=[],t.sWidth=t.xml&&Number(t.xml?.getAttribute("width"))*o.scaleFactor,t.sHeight=t.xml&&Number(t.xml?.getAttribute("height"))*o.scaleFactor,t.offsetX=t.xml&&Number(t.xml?.getAttribute("left"))*o.scaleFactor,t.offsetY=t.xml&&Number(t.xml?.getAttribute("top"))*o.scaleFactor,t.zIndex=t.xml&&Number(t.xml?.getAttribute("zindex"))*o.scaleFactor;const a=t.xml?.getElementsByTagName("options");if(a)for(let e of Array.from(a)){const o=e.children;for(let e of Array.from(o))t.options[e.nodeName.toLowerCase()]=e.textContent}let r=document.getElementById(t.containerName);const d=document.getElementById(`${t.layout.containerName}`);null===r&&(r=document.createElement("div"),r.id=t.containerName),d&&d.appendChild(r),r.style.cssText=`\n            width: ${t.sWidth}px;\n            height: ${t.sHeight}px;\n            position: absolute;\n            left: ${t.offsetX}px;\n            top: ${t.offsetY}px;\n        `,r.className="region--item";const s=Array.from(t.xml.getElementsByTagName("media"));t.totalMediaObjects=s.length,Array.from(s).forEach(((e,o)=>{const n=h(t,e?.getAttribute("id")||"",e,i);n.index=o,t.mediaObjects.push(n)})),t.prepareMediaObjects()},u.finished=function(){const e=u;console.log("Region::finished called . . . ",e.id),e.complete=!0,e.layout.regions[u.index]=u,e.layout.regionExpired()},u.prepareMediaObjects=function(){const e=u;let t;if(e.mediaObjects.length>0){e.curMedia?e.oldMedia=e.curMedia:e.oldMedia=void 0,e.currentMediaIndex>=e.mediaObjects.length&&(e.currentMediaIndex=0),e.curMedia=e.mediaObjects[e.currentMediaIndex],t=e.currentMediaIndex+1,(t>=e.mediaObjects.length||!Boolean(e.mediaObjects[t])&&1===e.mediaObjects.length)&&(t=0),Boolean(e.mediaObjects[t])&&(e.nxtMedia=e.mediaObjects[t]);const o=document.getElementById(`${e.containerName}`);e.curMedia&&o&&o.insertBefore(e.curMedia.html,o.lastElementChild),e.nxtMedia&&o&&o.insertBefore(e.nxtMedia.html,o.lastElementChild)}},u.run=function(){console.log("Called Region::run > ",u.id),u.curMedia&&u.transitionNodes(u.oldMedia,u.curMedia)},u.transitionNodes=function(e,t){const o=u;let n=1,a="E";if(t){e&&Boolean(e.options.transoutduration)&&(n=Number(e.options.transoutduration)),e&&Boolean(e.options.transoutdirection)&&(a=e.options.transoutdirection);let r,d={duration:n},l=g("defaultOut",{duration:d.duration});e&&Boolean(e.options.transout)&&(r=e.options.transout,"fly"===r&&(r=`${r}Out`,d.keyframes=f({trans:"out",direction:a,height:e.divHeight,width:e.divWidth})),l=g(r,d));const s=new Promise((t=>{if(e){const a=document.getElementById(i(e));if(a){const i=()=>{a.style.setProperty("display","none"),a.remove()};let d=null;Boolean(e.options.transout)&&(d=a.animate(l.keyframes,l.timing)),Boolean(e.options.transout)&&o.totalMediaObjects>1?"flyOut"===r?d?.finished.then((()=>{t(!0),d?.effect?.updateTiming({fill:"none"}),i()})):(setTimeout(i,n/2),t(!0)):(i(),t(!0))}}}));e?s.then((e=>{e&&t.run()})):t.run()}},u.playNextMedia=function(){const e=u;e.ended||e.currentMediaIndex===e.mediaObjects.length-1&&(e.finished(),e.layout.allEnded)||e.complete&&"html"===e.curMedia?.render||e.complete&&1===e.mediaObjects.length&&"html"!==e.curMedia?.render&&"image"===e.curMedia?.mediaType&&!e.curMedia?.loop||(e.currentMediaIndex=e.currentMediaIndex+1,e.prepareMediaObjects(),e.transitionNodes(e.oldMedia,e.curMedia))},u.end=function(){const e=u;e.ending=!0,e.layout.regions[e.index]=e,console.log("Calling Region::end ",e),e.exitTransition()},u.exitTransition=function(){const e=u,t=document.getElementById(`${e.containerName}`);t&&(t.style.display="none"),console.log("Called Region::exitTransition ",e.id),e.exitTransitionComplete()},u.exitTransitionComplete=function(){const e=u;console.log("Called Region::exitTransitionComplete ",e.id),e.ended=!0,e.layout.regions[e.index]=e,e.layout.regionEnded()},u.on=function(e,t){return c.on(e,t)},u.emitter=c,u.prepareRegion(),u}(t,a,a?.getAttribute("id")||"",r);l.index=d,t.regions.push(l)}))},p.prepareLayout=function(){p.parseXlf()},p.regionExpired=function(){const e=p;e.allExpired=!0;for(let t of e.regions)t.complete||(e.allExpired=!1);e.allExpired&&e.end()},p.regionEnded=function(){const e=p;e.allEnded=!0;for(var t=0;t<e.regions.length;t++)e.regions[t].ended||(e.allEnded=!1);e.allEnded&&e.stopAllMedia().then((()=>{if(console.log("starting to end layout . . ."),d.config.inPreview){const e=document.getElementById("play_ended"),t=document.getElementById("screen_container");if(t){for(;t.firstChild;)t.removeChild(t.firstChild);t.style.display="none"}e&&(e.style.display="block")}e.emitter?.emit("end",e)}))},p.end=function(){console.log("Executing Layout::end and Calling Region::end ",p);for(let e of p.regions)e.end()},p.stopAllMedia=function(){return console.log("Stopping all media . . ."),new Promise((async e=>{for(var t=0;t<p.regions.length;t++)for(var o=p.regions[t],n=0;n<o.mediaObjects.length;n++){var i=o.mediaObjects[n];await i.stop()}e()}))},p.prepareLayout(),p}var I;!function(e){e[e.CURRENT=0]="CURRENT",e[e.NEXT=1]="NEXT"}(I||(I={}));const v={inputLayouts:[],config:e,layouts:[],currentLayoutIndex:0,currentLayoutId:void 0,currentLayout:void 0,nextLayout:void 0,bootstrap(){},init(){},playSchedules(){},prepareLayoutXlf:(e,t)=>Promise.resolve({}),prepareLayouts:()=>Promise.resolve({})};return function(o,n){const i={inputLayouts:o,options:n},a={...v,bootstrap(){this.inputLayouts=Array.isArray(i.inputLayouts)?i.inputLayouts:[i.inputLayouts],this.config=JSON.parse(JSON.stringify({...e,...i.options}))},init(){return new Promise((e=>{!function(e){let t=e;const o=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div"),a=document.createElement("a");o.className="player-preview",o.id="player_container",n.className="screen-preview",n.id="screen_container",i.className="preview-ended",i.id="play_ended",i.style.display="none",a.id="play_back_preview",a.className="play-back-preview",a.style.cssText="text-decoration: none; color: #ffffff;",a.innerHTML="Play again?",a.removeEventListener("click",x),a.addEventListener("click",x),t||(t=document.body),t&&null===t.querySelector("#player_container")&&(t.insertBefore(o,t.firstChild),null===o.querySelector("#screen_container")&&o.appendChild(n),null===o.querySelector("#play_ended")&&(o.appendChild(i),null===i.querySelector("a")&&i.appendChild(a)))}(document.querySelector(".preview-canvas")),this.prepareLayouts().then((t=>{e(t)}))}))},playSchedules(e){void 0!==e.currentLayout&&(e.currentLayout.emitter?.emit("start",e.currentLayout),e.currentLayout.run())},async prepareLayoutXlf(o,n){const a=this;let r,d,l=Object.assign({},e);if(l={...l,...i.options},o&&Boolean(o.layoutId)&&(l.xlfUrl=l.xlfUrl.replace(":layoutId",o.layoutId)),o&&null===o.layoutNode){r=await async function(e){let t=window.location.origin;!e.inPreview&&e.appHost&&(t=e.appHost);const o=await fetch(t+e.xlfUrl,{mode:"no-cors"});return await o.text()}(l);const e=new window.DOMParser;d=e.parseFromString(r,"text/xml")}else d=o&&o.layoutNode;return new Promise((e=>{const n=t;n.id=o.layoutId,n.layoutId=o.layoutId,n.options=l,e(b(d,l,a,n))}))},async prepareLayouts(){const e=this,o=function(e){let o,n,{inputLayouts:i,currentLayout:a,nextLayout:r,currentLayoutIndex:d}=e.xlr;const l=i.length>0,s=d+1;if(void 0===a&&void 0===r){let e;l&&(e=i[d],o={...t},i.length>1?(e=i[s],n={...t}):n=o,o.id=e.layoutId,o.layoutId=e.layoutId,n.id=e.layoutId,n.layoutId=e.layoutId)}else l&&(o=r,i.length>1&&s<i.length&&(n=Boolean(e.xlr.layouts[s])?e.xlr.layouts[s]:{...t,...i[s]}),void 0===n&&(n=e.xlr.layouts[0]));return{currentLayoutIndex:d,inputLayouts:e.xlr.inputLayouts,current:o,next:n}}({xlr:e});e.currentLayoutId=o.current?.layoutId;const n=await Promise.all([e.prepareLayoutXlf(o.current,I.CURRENT),e.prepareLayoutXlf(o.next,I.NEXT)]);return new Promise((t=>{e.currentLayout=n[0],e.nextLayout=n[1],e.currentLayoutIndex=o.currentLayoutIndex,e.layouts[e.currentLayoutIndex]=e.currentLayout,t(e)}))}};return a.bootstrap(),a}}();
//# sourceMappingURL=xibo-layout-renderer.min.js.map
